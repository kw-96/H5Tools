<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>渠道美术-H5延展工具</title>
  <style>

    
    /* 通知样式 */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      background-color: #333;
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      z-index: 9999;
      font-size: 14px;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    
    .notification.success {
      background-color: #34c759;
    }
    
    .notification.error {
      background-color: #ff3b30;
    }
    
    .notification.warning {
      background-color: #ff9500;
    }
    
    .notification.info {
      background-color: #0071e3;
    }
    
    /* 基础样式和布局 */
    * {
      scrollbar-width: none;
      -ms-overflow-style: none;
      box-sizing: border-box;
    }
    
    ::-webkit-scrollbar {
      width: 0;
      height: 0;
      background: transparent;
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      color: #1d1d1f;
      background-color: #ffffff;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
      overflow-x: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding-top: 46px;
      padding-bottom: 40px;
    }
    
    /* 标签页和导航 */
    .tab-container {
      display: flex;
      width: 100%;
      justify-content: space-between;
      background-color: rgba(255, 255, 255, 0.72);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      padding: 8px 0;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }
    
    .tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      width: 25%;
      padding: 8px 4px;
      border-radius: 8px;
      transition: all 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);
      cursor: pointer;
      color: #86868b;
    }
    
    .tab svg {
      width: 20px;
      height: 20px;
      margin-bottom: 4px;
    }
    
    .tab-label {
      font-size: 11px;
      font-weight: 500;
      margin-top: 2px;
      opacity: 0.8;
    }
    
    .tab.active {
      color: #0071e3;
    }
    
    .tab:hover {
      color: #0071e3;
      background-color: rgba(0, 113, 227, 0.05);
    }
    
    /* 内容区域 */
    .tab-content {
      display: none;
      padding: 0 16px;
      margin: 30px auto 0px;
      width: 100%;
      background-color: #ffffff;
      overflow-y: auto;
      overflow-x: hidden;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
      position: relative;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* 表单控件 */
    .form-group {
      margin-bottom: 14px;
    }
    
    .row-layout {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }
    
    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #1d1d1f;
    }
    
    .row-layout label {
      flex: 0 0 auto;
      margin: 0 16px 0 0;
      min-width: 70px;
      width: 25%;
      max-width: 90px;
    }
    
    .non-interactive-label {
      pointer-events: none;
      cursor: default;
    }
    
    /* 输入控件 */
    input[type="number"], 
    input[type="color"], 
    input[type="text"], 
    .text-input, 
    .text-area {
      width: 100%;
      padding: 10px 12px;
      font-size: 14px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      background-color: #ffffff;
      transition: all 0.2s;
      appearance: none;
      -webkit-appearance: none;
    }
    
    .text-area {
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
      line-height: 1.5;
    }
    
    input:focus, .text-input:focus, .text-area:focus {
      outline: none;
      border-color: #0071e3;
      box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.2);
    }
    
    /* 颜色选择器 */
    .color-input-group {
      display: flex;
      align-items: center;
      min-width: 120px;
      flex: 1;
    }
    
    input[type="color"] {
      width: 24px;
      height: 24px;
      padding: 0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    input.color-value {
      margin-left: 8px;
      font-size: 13px;
      color: #666;
      width: 80px;
      padding: 4px 8px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 4px;
      background-color: #ffffff;
    }
    
    /* 上传和预览组件 */
    .file-upload-btn, 
    .img-upload-wrapper {
      flex: 1;
      width: 100%;
    }
    
    .upload-btn {
      width: 100%;
      height: 60px;
      padding: 0;
      background-color: #f5f5f7;
      border: 1px dashed rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      color: #666;
      cursor: pointer;
      font-size: 14px;
      text-align: center;
      transition: all 0.2s;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .upload-btn:hover {
      background-color: #efefef;
      border-color: rgba(0, 0, 0, 0.2);
    }
    
    .upload-btn .img-preview-inline {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #fafafa;
    }
    
    body.dark-theme .upload-btn .img-preview-inline {
      background-color: #1c1c1e;
    }
    
    .upload-btn .img-preview-inline img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }
    
    .upload-btn .img-preview-inline .upload-icon-inline {
      font-size: 20px;
      color: #86868b;
    }
    
    /* 折叠内容区域 */
    .version-content {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
      padding-left: 24px;
    }

    .version-content.active {
      max-height: 800px;
      opacity: 1;
      padding-bottom: 15px;
    }
    
    .collapsible-content {
      max-height: 1000px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .collapsible-content.collapsed {
      max-height: 0;
    }
    
    /* 板块和模块样式 */
    .form-section, .module {
      width: 100%;
      padding: 16px 0;
      margin-bottom: 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    /* 模块管理相关样式 */
    .module-management {
      margin-bottom: 20px;
    }
    
    /* 模块列表头部样式 */
    .module-list-header {
      display: flex;                                /* 使用弹性布局 */
      justify-content: space-between;                /* 两端对齐 */
      align-items: center;                           /* 垂直居中对齐 */
      margin: 24px 0 12px 0;                         /* 设置上下外边距 */
      padding-bottom: 8px;                           /* 底部内边距 */
      font-weight: 600;                              /* 字体加粗 */
    }
    
    .module-count {
      font-size: 14px;
      color: #86868b;
      font-weight: normal;
    }
    

    
    .module-action-row {
      justify-content: center;
      margin-top: 10px;
    }
    
    .action-btn {
      background-color: #0071e3;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    
    .action-btn:hover {
      background-color: #0077ed;
      transform: translateY(-1px);
    }
    
    .add-module-btn {
      min-width: 150px;
    }
    
    .empty-modules-message {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      text-align: center;
      color: #86868b;
      border: 2px dashed rgba(0,0,0,0.1);
      border-radius: 10px;
      margin: 20px 0;
    }
    
    .empty-modules-message svg {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .empty-modules-message p {
      margin: 5px 0;
      font-size: 16px;
    }
    
    .empty-modules-message .hint-text {
      font-size: 14px;
      opacity: 0.7;
    }
    
    /* 模块相关样式 */
    .module {
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 10px;
      margin-bottom: 16px;
      background-color: #ffffff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .module-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px;
      background-color: #f5f5f7;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .module-title {
      font-weight: 600;
      font-size: 16px;
      color: #1d1d1f;
    }
    
    .module-controls {
      display: flex;
      gap: 8px;
    }
    
    .module-content {
      padding: 16px;
      transition: max-height 0.3s ease, opacity 0.2s ease;
    }
    
    .module-collapsed .module-content {
      max-height: 0;
      opacity: 0;
      padding: 0 16px;
      overflow: hidden;
    }
    
    .module-collapsed .collapse-btn i {
      transform: rotate(180deg);
    }
    
    /* 深色主题适配 - 模块管理 */
    body.dark-theme .module {
      background-color: #1d1d1f;
      border-color: rgba(255,255,255,0.1);
    }
    
    body.dark-theme .module-header {
      background-color: #2c2c2e;
      border-color: rgba(255,255,255,0.05);
    }
    
    body.dark-theme .module-title {
      color: #f5f5f7;
    }
    
    body.dark-theme .empty-modules-message {
      border-color: rgba(255,255,255,0.1);
      color: #a1a1a6;
    }
    
    .form-section:last-child {
      border-bottom: none;
    }
    
    .form-section .form-group:last-child {
      margin-bottom: 0;
    }
    
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0 0 16px 0;
      font-size: 14px;
      font-weight: 600;
      color: #1d1d1f;
    }
    
    .section-title {
      color: inherit;
    }
    
    /* 图片预览 */
    .img-preview-inline, 
    .preview-container {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .img-preview-inline {
      pointer-events: none;
      border-radius: 8px;
    }
    
    .img-preview-inline img, 
    .preview-container img, 
    .img-preview-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }
    
    .img-preview-btn {
      width: 100%;
      cursor: pointer;
      display: flex;
      justify-content: flex-start;
    }
    
    .img-preview-container {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f5f5f7;
      border: 1px dashed rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
      transition: all 0.2s;
    }
    
    .img-preview-container:hover {
      background-color: #efefef;
      border-color: rgba(0, 0, 0, 0.3);
    }
    
    /* 按钮和控件 */
    .control-btn {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 1px solid #e5e5e5;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      font-size: 14px;
      color: #86868b;
      cursor: pointer;
      transition: all 0.2s;
      background-color: transparent;
    }
    
    .control-btn:hover {
      background-color: #f5f5f7;
    }
    
    .collapse-btn {
      transition: transform 0.3s ease, background-color 0.2s, border-color 0.2s, color 0.2s;
    }
    
    .collapse-btn svg, .chevron-icon {
      color: inherit;
      fill: currentColor;
      stroke: currentColor;
      transition: transform 0.3s ease;
    }
    
    .collapse-btn.collapsed svg,
    .collapse-btn.collapsed .chevron-icon {
      transform: rotate(180deg);
    }
    
    .module-collapsed .collapse-btn svg,
    .module-collapsed .collapse-btn .chevron-icon {
      transform: rotate(180deg);
    }
    
    .collapse-btn.collapsed {
      transform: rotate(180deg);
    }
    
    .add-btn {
      margin-right: 6px;
      font-size: 14px;
      font-weight: 500;
      line-height: 1;
    }
    
    .add-btn:hover {
      background-color: rgba(0, 113, 227, 0.1);
      border-color: #0071e3;
      color: #0071e3;
    }
    
    .add-btn[onclick*="removeModule"]:hover {
      background-color: rgba(255, 59, 48, 0.1);
      border-color: #ff3b30;
      color: #ff3b30;
    }
    
    .option-controls {
      display: flex;
      align-items: center;
    }
    
    /* 模块标题和内容 */
    .module-title {
      font-size: 14px;
      font-weight: 600;
      color: #1d1d1f;
      margin-right: 4px;
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* 折叠内容区域 */
    .version-content {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
      padding-left: 24px;
    }

    .version-content.active {
      max-height: 800px;
      opacity: 1;
      padding-bottom: 15px;
    }
    
    .collapsible-content {
      max-height: 1000px;
      opacity: 1;
      overflow: hidden;
      transition: max-height 0.3s ease, opacity 0.3s ease;
    }
    
    .collapsible-content.collapsed {
      max-height: 0;
      opacity: 0;
    }

    .dropdown-selector-wide {
      position: relative;
      min-width: 180px;
      max-width: 200px;
      z-index: 10;
    }

    .wide-btn {
      width: 100% !important;
      min-width: 150px;
    }
    
    /* 下拉选择器 */
    .dropdown-selector {
      position: relative;
      min-width: 120px;
      max-width: 140px;
      z-index: 10;
    }
    
    .dropdown-selector-wide {
      flex: 1;
      min-width: 200px;
      max-width: 100%;
    }
    
    .dropdown-selector-wide .section-dropdown {
      width: 100%;
    }
    
    .section-dropdown {
      appearance: none;
      -webkit-appearance: none;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      color: #1d1d1f;
      background-color: #ffffff;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: none;
      min-height: 44px;
      box-sizing: border-box;
    }
    
    .section-dropdown:focus {
      outline: none;
      border-color: #0071e3;
      box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.2);
    }
    
    .section-dropdown:hover {
      border-color: rgba(0, 0, 0, 0.2);
    }
    
    /* 主题切换和页脚 */
    .theme-switcher {
      margin-bottom: 20px;
    }
    
    .theme-buttons {
      display: flex;
      gap: 8px;
    }
    
    .theme-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 16px;
      background-color: #f0f0f0;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 6px;
      color: #333;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .theme-btn.active {
      background-color: #0071e3;
      color: white;
      border-color: #0071e3;
    }
    
    .theme-btn:hover:not(.active) {
      background-color: #e5e5e5;
    }
    
    .page-footer {
      width: 100%;
      padding: 10px;
      background-color: rgba(255, 255, 255, 0.72);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      position: fixed;
      bottom: 0;
      left: 0;
      z-index: 100;
    }
    
    .version-info {
      display: flex;
      justify-content: space-between;
      width: 100%;
      color: #86868b;
      font-size: 13px;
    }
    
    /* 奖品网格 */
    .prize-grid {
      display: flex;          /* 使用弹性布局 */
      flex-wrap: wrap;        /* 允许项目换行 */
      justify-content: space-between; /* 项目之间平均分配空间 */
      gap: 8px;               /* 设置网格项之间的间隙 */
      margin-top: 10px;       /* 顶部外边距 */
    }
    
    /* 奖品网格 */
    .prize-grid {
      display: flex;          /* 使用弹性布局 */
      flex-wrap: wrap;        /* 允许项目换行 */
      justify-content: space-between; /* 项目之间平均分配空间 */
      gap: 8px;               /* 设置网格项之间的间隙 */
      margin-top: 10px;       /* 顶部外边距 */
    }
    
    /* 自定义奖品网格布局 */
    .prize-grid-custom {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
      width: 100%;
      max-width: 100%;
      overflow: hidden;
    }
    
    .prize-row {
      display: flex;
      align-items: center;
      width: 100%;
      max-width: 100%;
    }
    
    .prize-row.top-row {
      /* 第一行：3个奖品，均匀分布 */
      justify-content: space-between;
    }
    
    .prize-row.middle-row {
      /* 第二行：2个奖品，左右对齐 */
      justify-content: space-between;
    }
    
    .prize-row.bottom-row {
      /* 第三行：3个项目，均匀分布 */
      justify-content: space-between;
    }
    
    /* 网格项样式 */
    .grid-item {
      flex: 0 0 calc(33.333% - 6px); /* 设置网格项宽度为33.333%（减去间隙），不允许伸缩 */
    }
    
    /* 自定义布局下的网格项 */
    .prize-grid-custom .grid-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    /* 第一行和第三行的项目：每个占33.33%宽度 */
    .prize-row.top-row .grid-item,
    .prize-row.bottom-row .grid-item {
      flex: 0 0 calc(33.333% - 4px);
      max-width: calc(33.333% - 4px);
    }
    
    /* 第二行的项目：每个也占33.33%宽度，但只有两个 */
    .prize-row.middle-row .grid-item {
      flex: 0 0 calc(33.333% - 4px);
      max-width: calc(33.333% - 4px);
    }
    
    /* 图片上传容器 */
    .img-upload-container {
      display: flex;          /* 使用弹性布局 */
      flex-direction: column; /* 设置主轴方向为垂直 */
      align-items: center;    /* 在交叉轴上居中对齐项目 */
      width: 100%;           /* 确保容器占满父元素宽度 */
    }
    
    /* 网格按钮样式 */
    .grid-btn {
      width: 100%;                          /* 设置宽度为100% */
      aspect-ratio: 1/1;                    /* 设置宽高比为1:1，保持正方形 */
      display: flex;                        /* 使用弹性布局 */
      align-items: center;                  /* 垂直居中对齐 */
      justify-content: center;              /* 水平居中对齐 */
      background-color: #f5f5f7;            /* 设置背景颜色 */
      border: 1px dashed rgba(0, 0, 0, 0.2);/* 设置虚线边框 */
      border-radius: 6px;                   /* 设置圆角 */
      cursor: pointer;                      /* 鼠标悬停时显示手型光标 */
      position: relative;                   /* 设置相对定位 */
      overflow: hidden;                     /* 隐藏溢出内容 */
      padding: 0;                           /* 移除内边距 */
      transition: all 0.2s;                 /* 添加过渡效果 */
      box-sizing: border-box;               /* 包含边框在内的盒模型 */
    }
    
    /* 自定义布局下的网格按钮 */
    .prize-grid-custom .grid-btn {
      width: 100%;
      height: auto;
      aspect-ratio: 1/1;
      max-width: 100%;
      max-height: none;
      min-height: 50px;
    }
    
    .grid-btn:hover {
      background-color: #efefef;
      border-color: rgba(0, 0, 0, 0.3);
    }
    
    .upload-icon, .upload-icon-text, .upload-icon-inline {
      font-size: 20px;
      color: #86868b;
    }
    
    .upload-icon {
      position: absolute;
      z-index: 1;
    }
    
    .upload-icon-text, .upload-icon-inline {
      font-size: 24px;
    }
    
    .prize-label {
      margin-top: 4px;
      font-size: 11px;
      color: #86868b;
      text-align: center;
      width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.2;
    }
    
    /* 创建按钮 */
    .create-btn-container {
      display: flex;
      justify-content: center;
      padding: 0 0 24px 0;
      width: 100%;
      margin: 0 auto;
    }
    
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      justify-content: center;
      width: 100%;
      max-width: 320px;
    }
    
    button {
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 500;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    button#create {
      background-color: #0071e3;
      color: white;
      min-width: 120px;
    }
    
    button#create:hover {
      background-color: #0077ed;
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0, 113, 227, 0.2);
    }
    
    button#reset {
      background-color: #f5f5f7;
      color: #1d1d1f;
      min-width: 120px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    button#reset:hover {
      background-color: #e8e8ed;
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    button#cancel {
      background-color: #f5f5f7;
      color: #1d1d1f;
    }
    
    button#cancel:hover {
      background-color: #e8e8ed;
    }
    
    /* 深色主题适配 */
    body.dark-theme {
      color: #f5f5f7;
      background-color: #1d1d1f;
    }
    
    body.dark-theme .tab-container {
      background-color: rgba(30, 30, 32, 0.72);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    
    body.dark-theme .tab:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    body.dark-theme .tab-content {
      background-color: #1d1d1f;
    }
    
    body.dark-theme .form-section,
    body.dark-theme .module {
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    
    body.dark-theme .section-header,
    body.dark-theme .section-title,
    body.dark-theme label,
    body.dark-theme .module-title {
      color: #f5f5f7;
    }
    
    body.dark-theme input[type="number"],
    body.dark-theme input[type="text"],
    body.dark-theme .text-input,
    body.dark-theme .text-area {
      background-color: #2c2c2e;
      border-color: rgba(255, 255, 255, 0.1);
      color: #f5f5f7;
    }
    
    body.dark-theme input:focus,
    body.dark-theme .text-input:focus,
    body.dark-theme .text-area:focus {
      border-color: #0071e3;
      box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.15);
    }
    
    body.dark-theme .upload-btn,
    body.dark-theme .grid-btn,
    body.dark-theme .img-preview-container,
    body.dark-theme .add-btn,
    body.dark-theme .theme-btn:not(.active),
    body.dark-theme button#cancel {
      background-color: #2c2c2e;
      border-color: rgba(255, 255, 255, 0.1);
      color: #f5f5f7;
    }
    
    body.dark-theme .upload-btn:hover,
    body.dark-theme .grid-btn:hover,
    body.dark-theme .img-preview-container:hover,
    body.dark-theme .theme-btn:hover:not(.active),
    body.dark-theme button#cancel:hover {
      background-color: #3a3a3c;
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    body.dark-theme .upload-btn .img-preview-inline .upload-icon-inline {
      color: #a1a1a6;
    }
    
    body.dark-theme .control-btn {
      border-color: #3a3a3c;
      color: #a1a1a6;
    }
    
    body.dark-theme .control-btn:hover {
      background-color: #2c2c2e;
    }
    
    body.dark-theme .add-btn:hover {
      background-color: rgba(0, 113, 227, 0.2);
      border-color: #0071e3;
      color: #0071e3;
    }
    
    body.dark-theme .add-btn[onclick*="removeModule"]:hover {
      background-color: rgba(255, 69, 58, 0.1);
      border-color: #ff453a;
      color: #ff453a;
    }
    
    body.dark-theme button#reset {
      background-color: #2c2c2e;
      border-color: rgba(255, 255, 255, 0.1);
      color: #f5f5f7;
    }
    
    body.dark-theme button#reset:hover {
      background-color: #3a3a3c;
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    body.dark-theme .section-dropdown {
      background-color: #2c2c2e;
      border-color: rgba(255, 255, 255, 0.1);
      color: #f5f5f7;
    }
    
    body.dark-theme .section-dropdown:focus {
      border-color: #0071e3;
      box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.15);
    }
    
    body.dark-theme .section-dropdown:hover {
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    body.dark-theme .page-footer {
      background-color: rgba(30, 30, 32, 0.72);
      border-top-color: rgba(255, 255, 255, 0.1);
    }
    
    body.dark-theme .prize-label,
    body.dark-theme .upload-icon,
    body.dark-theme .upload-icon-text,
    body.dark-theme .upload-icon-inline {
      color: #a1a1a6;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .empty-state h3 {
      margin-bottom: 10px;
      color: #333;
    }

    .empty-state p {
      margin: 8px 0;
      line-height: 1.5;
    }

    .gray-text {
      color: #999;
      font-size: 14px;
    }

    /* 深色主题适配 - 空状态样式 */
    body.dark-theme .empty-state {
      color: #a1a1a6;
    }

    body.dark-theme .empty-state h3 {
      color: #f5f5f7;
    }

    body.dark-theme .gray-text {
      color: #86868b;
    }

    /* 渠道容器样式 */
    .channels-container {
      padding: 16 0;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .channel-section {
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      padding: 16px;
      background-color: #ffffff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    .channel-section:hover {
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .channel-title {
      margin: 0 0 16px 0;
      font-size: 16px;
      font-weight: 600;
      color: #1d1d1f;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 8px;
    }

    .channel-content {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .channel-preview-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .channel-preview-area {
      width: 100%;
      height: 140px;
      border: 2px dashed rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f5f5f7;
      position: relative;
      transition: all 0.2s;
    }

    .channel-preview-area:hover {
      border-color: rgba(0, 0, 0, 0.2);
      background-color: #efefef;
    }

    .channel-preview-placeholder {
      color: #86868b;
      font-size: 14px;
      text-align: center;
      font-weight: 500;
    }

    .channel-preview-btn {
      background-color: #f5f5f7;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #1d1d1f;
      transition: all 0.2s;
    }

    .channel-preview-btn:hover {
      background-color: #e8e8ed;
      border-color: rgba(0, 0, 0, 0.2);
    }

    .channel-generate-btn {
      background-color: #0071e3;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      min-width: 120px;
    }

    .channel-generate-btn:hover {
      background-color: #0077ed;
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0, 113, 227, 0.2);
    }

    .channel-generate-btn:disabled {
      background-color: #86868b;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* 深色主题适配 - 渠道样式 */
    body.dark-theme .channel-section {
      background-color: #1d1d1f;
      border-color: rgba(255, 255, 255, 0.1);
    }

    body.dark-theme .channel-title {
      color: #f5f5f7;
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    body.dark-theme .channel-preview-area {
      background-color: #2c2c2e;
      border-color: rgba(255, 255, 255, 0.1);
    }

    body.dark-theme .channel-preview-area:hover {
      background-color: #3a3a3c;
      border-color: rgba(255, 255, 255, 0.2);
    }

    body.dark-theme .channel-preview-placeholder {
      color: #a1a1a6;
    }

    body.dark-theme .channel-preview-btn {
      background-color: #2c2c2e;
      border-color: rgba(255, 255, 255, 0.1);
      color: #f5f5f7;
    }

    body.dark-theme .channel-preview-btn:hover {
      background-color: #3a3a3c;
      border-color: rgba(255, 255, 255, 0.2);
    }

    body.dark-theme .channel-generate-btn:disabled {
      background-color: #48484a;
      color: #a1a1a6;
    }

  </style>
</head>
<body>
  <!-- 主容器 -->
  <div class="container">
    <!-- 标签页容器 -->
    <div class="tab-container">
      <!-- 创建原型标签页 -->
      <div class="tab active" data-tab="prototype">
        <!-- SVG图标：创建原型 -->
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M9.4375 8C10.3004 8 11 8.69956 11 9.5625V18.4375C11 19.3004 10.3004 20 9.4375 20H1.5625C0.699555 20 0 19.3004 0 18.4375V9.5625C0 8.69956 0.699555 8 1.5625 8H9.4375Z" />
          <path d="M18.4375 8C19.3004 8 20 8.69956 20 9.5625V18.4375C20 19.3004 19.3004 20 18.4375 20H14.5625C13.6996 20 13 19.3004 13 18.4375V9.5625C13 8.69956 13.6996 8 14.5625 8H18.4375Z" />
          <path d="M18.4375 0C19.3004 0 20 0.699555 20 1.5625V4.6875C20 5.55044 19.3004 6.25 18.4375 6.25H1.5625C0.699555 6.25 0 5.55044 0 4.6875V1.5625C0 0.699555 0.699555 0 1.5625 0H18.4375Z" />
        </svg>
        <span class="tab-label">创建原型</span>
      </div>
      <!-- 延展渠道标签页 -->
      <div class="tab" data-tab="extension">
        <!-- SVG图标：延展渠道 -->
        <svg width="20" height="20" viewBox="0 0 18 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.6875 3.09375V7.25175H0V3.09375C0 2.27324 0.325948 1.48633 0.906138 0.906138C1.48633 0.325948 2.27324 0 3.09375 0H7.25175V1.6875H3.09375C2.3175 1.6875 1.6875 2.3175 1.6875 3.09375ZM16.3125 3.09375V7.25175H18V3.09375C18 2.27324 17.6741 1.48633 17.0939 0.906138C16.5137 0.325948 15.7268 0 14.9063 0H10.7483V1.6875H14.9063C14.9738 1.6875 15.0413 1.692 15.1054 1.701L11.3175 5.49113L12.51 6.68363L16.3001 2.89462C16.3091 2.95988 16.3136 3.02625 16.3136 3.09375H16.3125ZM7.26638 11.9273L2.89462 16.299C2.95875 16.308 3.02625 16.3136 3.09375 16.3136H7.25175V18H3.09375C2.27324 18 1.48633 17.6741 0.906138 17.0939C0.325948 16.5137 0 15.7268 0 14.9063V10.7471H1.6875V14.9063C1.6875 14.9738 1.692 15.039 1.701 15.1043L6.07275 10.7325L7.26525 11.925L7.26638 11.9273ZM16.3125 14.9063C16.3125 15.6836 15.6825 16.3125 14.9063 16.3125H10.7483V18H14.9063C15.7268 18 16.5137 17.6741 17.0939 17.0939C17.6741 16.5137 18 15.7268 18 14.9063V10.7483H16.3125V14.9074V14.9063Z" />
        </svg>
        <span class="tab-label">延展渠道</span>
      </div>
      <!-- 工具集标签页 -->
      <div class="tab" data-tab="tools">
        <!-- SVG图标：工具集 -->
        <svg width="20" height="20" viewBox="0 0 18 21" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M9.0211 0.000215872C8.85591 -0.00344549 8.69292 0.0395296 8.55 0.124432L0.450001 4.91307C0.313036 4.99406 0.199328 5.11059 0.120328 5.25091C0.0413283 5.39123 -0.000174042 5.5504 5.4908e-07 5.71237V15.2896C-0.000174121 15.4516 0.0413281 15.6108 0.120328 15.7511C0.199328 15.8914 0.313036 16.008 0.450001 16.0889L8.54121 20.8722C8.54449 20.8742 8.54669 20.8774 8.55 20.8794C8.55608 20.8831 8.56315 20.8848 8.56934 20.8884C8.62739 20.9204 8.68869 20.9457 8.75215 20.964C8.76179 20.9667 8.77056 20.9707 8.78027 20.973C8.85101 20.9909 8.92361 21 8.99649 21H9H9.00352C9.07521 20.9997 9.14662 20.9906 9.21621 20.973C9.22527 20.9709 9.23358 20.9682 9.24258 20.9658H9.2461C9.31219 20.9463 9.37589 20.9191 9.43594 20.8848C9.44029 20.8822 9.4457 20.882 9.45 20.8794L17.55 16.0871C17.829 15.9212 18 15.6158 18 15.2932V5.70877V5.70697C17.9994 5.62978 17.9894 5.55297 17.9701 5.47834C17.9695 5.47594 17.969 5.47354 17.9684 5.47114C17.9677 5.46876 17.9673 5.46632 17.9666 5.46394C17.9469 5.39105 17.9186 5.32091 17.8822 5.25511L17.8805 5.25331L17.8787 5.24971C17.7998 5.10996 17.6865 4.99387 17.55 4.91307L9.45 0.124432C9.31946 0.0468548 9.17197 0.00413969 9.0211 0.000215872ZM9 1.98588L15.3 5.71237L8.55 9.6999C8.271 9.86581 8.1 10.1692 8.1 10.501V18.4833L1.8 14.7586V6.24344L9 1.98588ZM16 8.5V15L11.5 17.5V11L16 8.5Z" />
        </svg>
        <span class="tab-label">工具集</span>
      </div>
      <!-- 设置标签页 -->
      <div class="tab" data-tab="settings">
        <!-- SVG图标：设置 -->
        <svg width="20" height="20" viewBox="0 0 18 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M9 5.375C9.96141 5.375 10.8837 5.7567 11.5635 6.43652C12.2433 7.11634 12.625 8.03859 12.625 9C12.625 9.96141 12.2433 10.8837 11.5635 11.5635C10.8837 12.2433 9.96141 12.625 9 12.625C8.52396 12.625 8.05211 12.5308 7.6123 12.3486C7.17272 12.1665 6.77299 11.8999 6.43652 11.5635C6.10005 11.227 5.83354 10.8273 5.65137 10.3877C5.46919 9.94789 5.375 9.47604 5.375 9C5.375 8.52396 5.46919 8.05211 5.65137 7.6123C5.83354 7.17272 6.10005 6.773 6.43652 6.43652C6.77299 6.10005 7.17272 5.83354 7.6123 5.65137C8.05211 5.46919 8.52396 5.375 9 5.375ZM9 6.625C8.37011 6.625 7.76571 6.87491 7.32031 7.32031C6.87491 7.76571 6.625 8.37011 6.625 9C6.625 9.62989 6.87491 10.2343 7.32031 10.6797C7.76571 11.1251 8.37011 11.375 9 11.375C9.31189 11.375 9.62103 11.3137 9.90918 11.1943C10.1972 11.075 10.4592 10.9002 10.6797 10.6797C10.9002 10.4592 11.075 10.1972 11.1943 9.90918C11.3137 9.62103 11.375 9.31189 11.375 9C11.375 8.68811 11.3137 8.37897 11.1943 8.09082C11.075 7.80276 10.9002 7.5408 10.6797 7.32031C10.4592 7.09983 10.1972 6.92502 9.90918 6.80566C9.62103 6.68631 9.31189 6.625 9 6.625Z" />
          <path fill-rule="evenodd" clip-rule="evenodd" d="M11.9033 0.875C13.0982 0.875123 14.1924 1.5455 14.7363 2.6084L17.2627 7.55176C17.7277 8.46176 17.7277 9.53924 17.2627 10.4482L14.7363 15.3916C14.4696 15.9134 14.0634 16.3514 13.5635 16.6572C13.0637 16.963 12.4892 17.1251 11.9033 17.125H6.15039C5.56895 17.1249 4.99815 16.9655 4.50098 16.6641C4.00384 16.3626 3.59895 15.9305 3.33008 15.415L0.75 10.4717C0.512884 10.0173 0.388672 9.5125 0.388672 9C0.388672 8.4875 0.512884 7.98266 0.75 7.52832L3.33008 2.58398C3.59902 2.06878 4.00399 1.63721 4.50098 1.33594C4.99814 1.03464 5.56905 0.874986 6.15039 0.875H11.9033ZM6.15039 2.125C5.43044 2.125 4.7705 2.52516 4.43848 3.16309L1.8584 8.10645C1.71432 8.38235 1.63867 8.68874 1.63867 9C1.63867 9.31126 1.71432 9.61765 1.8584 9.89355L4.43848 14.8369C4.60171 15.1498 4.84762 15.4117 5.14941 15.5947C5.45122 15.7777 5.79746 15.875 6.15039 15.875H11.9033C12.6291 15.8749 13.2931 15.469 13.623 14.8232L16.1504 9.87891C16.2894 9.60685 16.3613 9.30553 16.3613 9C16.3613 8.69447 16.2894 8.39315 16.1504 8.12109L13.623 3.17676C13.4611 2.86011 13.2145 2.59478 12.9111 2.40918C12.6077 2.2236 12.259 2.12494 11.9033 2.125H6.15039Z" />
        </svg>
        <span class="tab-label">设置</span>
      </div>
    </div>

    <!-- 创建原型内容 -->
    <div class="tab-content active" id="prototype-content">
      <!-- 页面基础设置板块 -->
      <div class="form-section">
        <div class="form-group row-layout">
          <label class="non-interactive-label">页面底色</label>
          <div class="color-input-group">
            <input type="color" id="pageColor" value="#FFFFFF">
            <input type="text" class="color-value" value="#FFFFFF" maxlength="7">
          </div>
        </div>
        
        <div class="form-group row-layout">
          <label class="non-interactive-label">页面背景</label>
          <div class="file-upload-btn">
            <input type="file" id="pageBackground" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
            <button class="upload-btn" onclick="document.getElementById('pageBackground').click()">
              <div class="img-preview-inline">
                <span class="upload-icon-inline">+</span>
              </div>
            </button>
          </div>
        </div>
      </div>
      
      <!-- 头图板块 -->
      <div class="form-section">
        <!-- 头图 -->
        <div class="form-group row-layout">
          <label class="non-interactive-label">头图</label>
          <div class="file-upload-btn">
            <input type="file" id="headerImage" accept="image/*" style="display:none">
            <button class="upload-btn" onclick="document.getElementById('headerImage').click()">
              <div class="img-preview-inline">
                <span class="upload-icon-inline">+</span>
              </div>
            </button>
          </div>
        </div>
    
        <!-- 标题 -->
        <div class="form-group row-layout">
          <label class="non-interactive-label">标题</label>
          <div class="file-upload-btn">
            <input type="file" id="titleUpload" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
            <button class="upload-btn" onclick="document.getElementById('titleUpload').click()">
              <div class="img-preview-inline">
                <span class="upload-icon-inline">+</span>
              </div>
            </button>
          </div>
        </div>
      </div>
      
      <!-- 游戏信息板块 -->
      <div class="form-section">
        <!-- 游戏信息板块标题 -->
        <div class="section-header">
          <div class="dropdown-selector">
            <select id="buttonVersionSelect" class="section-dropdown">
              <option value="imageButton">游戏信息-带icon版</option>
              <option value="singleButton">游戏信息-单按钮版</option>
              <option value="doubleButton">游戏信息-双按钮版</option>
            </select>
          </div>
          <div class="option-controls">
            <button class="control-btn collapse-btn" data-target="buttonVersionContent">
              <svg width="12" height="7" viewBox="0 0 16 11" class="chevron-icon">
                <path d="M0.130121 2.33086L7.44223 9.90667C7.67195 10.1374 8.03601 10.151 8.28153 9.94739L8.32611 9.90667L15.8682 2.3312C15.8992 2.29996 15.9167 2.25768 15.9167 2.21361V0.910808C15.9167 0.81876 15.8421 0.744141 15.75 0.744141C15.7057 0.744141 15.6632 0.7618 15.6319 0.793213L7.90908 8.54978L0.369491 0.801243C0.3053 0.735272 0.199782 0.73383 0.133811 0.798022C0.101565 0.829398 0.083374 0.87248 0.083374 0.917472V2.21512C0.083374 2.2583 0.100133 2.29979 0.130121 2.33086Z"/>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- 按钮内容容器 -->
        <div id="buttonVersionContent" class="collapsible-content">
          <!-- 游戏icon版内容 (默认显示) -->
          <div class="version-content active" id="imageButtonContent">
            <div class="form-group row-layout">
              <label class="non-interactive-label">游戏icon</label>
              <div class="img-upload-wrapper">
                <input type="file" id="gameIconUpload" accept="image/*" class="game-icon-upload" style="display:none">
                <div class="img-preview-btn" onclick="document.getElementById('gameIconUpload').click()">
                  <div class="img-preview-container" id="gameIconPreview">
                    <span class="upload-icon-text">+</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group row-layout">
              <label for="gameNameInput">游戏名称</label>
              <input type="text" id="gameNameInput" class="text-input" placeholder="请输入游戏名称">
            </div>

            <div class="form-group row-layout">
              <label for="gameCopyInput">游戏描述</label>
              <textarea id="gameCopyInput" class="text-area" placeholder="请输入游戏宣传文案"></textarea>
            </div>
            
            <div class="form-group row-layout">
              <label class="non-interactive-label">文案颜色</label>
              <div class="color-input-group">
                <input type="color" id="gameCopyTextColor" value="#FFFFFF">
                <input type="text" class="color-value" value="#FFFFFF" maxlength="7">
              </div>
            </div>

            <div class="form-group row-layout">
              <label for="iconButtonText">按钮文本</label>
              <input type="text" id="iconButtonText" class="text-input" placeholder="请输入按钮文案" value="立即下载">
            </div>

            <div class="form-group row-layout">
              <label class="non-interactive-label">文本颜色</label>
              <div class="color-input-group">
                <input type="color" id="iconButtonTextColor" value="#FFFFFF">
                <input type="text" class="color-value" value="#FFFFFF" maxlength="7">
              </div>
            </div>

            <div class="form-group row-layout">
              <label class="non-interactive-label">按钮底</label>
              <div class="file-upload-btn">
                <input type="file" id="iconButtonBgUpload" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
                <button class="upload-btn" onclick="document.getElementById('iconButtonBgUpload').click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>

          </div>
          
          <!-- 单按钮版内容 -->
          <div class="version-content" id="singleButtonContent">

            <div class="form-group row-layout">
              <label for="singleButtonText">按钮文本</label>
              <input type="text" id="singleButtonText" class="text-input" placeholder="请输入按钮文案" value="立即下载">
            </div>

            <div class="form-group row-layout">
              <label class="non-interactive-label">文本颜色</label>
              <div class="color-input-group">
                <input type="color" id="singleButtonTextColor" value="#FFFFFF">
                <input type="text" class="color-value" value="#FFFFFF" maxlength="7">
              </div>
            </div>

            <div class="form-group row-layout">
              <label class="non-interactive-label">按钮底</label>
              <div class="file-upload-btn">
                <input type="file" id="singleButtonBgUpload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="document.getElementById('singleButtonBgUpload').click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
          </div>
          
          <!-- 双按钮版内容 -->
          <div class="version-content" id="doubleButtonContent">

            <div class="form-group row-layout">
              <label for="leftButtonText">左侧按钮文本</label>
              <input type="text" id="leftButtonText" class="text-input" placeholder="请输入按钮文案" value="左侧按钮">
            </div>

            <div class="form-group row-layout">
              <label class="non-interactive-label">文本颜色</label>
              <div class="color-input-group">
                <input type="color" id="leftButtonTextColor" value="#FFFFFF">
                <input type="text" class="color-value" value="#FFFFFF" maxlength="7">
              </div>
            </div>

            <div class="form-group row-layout">
              <label class="non-interactive-label">左侧按钮底</label>
              <div class="file-upload-btn">
                <input type="file" id="leftButtonBgUpload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="document.getElementById('leftButtonBgUpload').click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>

            <div class="form-group row-layout">
              <label for="rightButtonText">右侧按钮文本</label>
              <input type="text" id="rightButtonText" class="text-input" placeholder="请输入按钮文案" value="右侧按钮">
            </div>

            <div class="form-group row-layout">
              <label class="non-interactive-label">文本颜色</label>
              <div class="color-input-group">
                <input type="color" id="rightButtonTextColor" value="#FFFFFF">
                <input type="text" class="color-value" value="#FFFFFF" maxlength="7">
              </div>
            </div>
            
            <div class="form-group row-layout">
              <label class="non-interactive-label">右侧按钮底</label>
              <div class="file-upload-btn">
                <input type="file" id="rightButtonBgUpload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="document.getElementById('rightButtonBgUpload').click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <div class="form-group row-layout">
              <label for="btnSpacing">按钮间距</label>
              <input type="number" id="btnSpacing" value="10" min="0" max="50" class="number-input">
            </div>
          </div>
          
        </div>
      </div>

      <!-- 模块管理区域 -->
      <div class="form-section module-management">
        <!-- 模块选择和添加区域 -->
        <div class="section-header">
          <span class="section-title">自定义模块</span>
        </div>
        <div class="module-selection-content">
          <div class="form-group row-layout">
            <label for="moduleTypeSelect">模块类型</label>
            <div class="dropdown-selector-wide">
            <select id="moduleTypeSelect" class="section-dropdown">
              <option value="">请选择模块类型</option>
              <option value="lotteryModule">九宫格抽奖</option>
              <option value="signInModule">签到模块</option>
              <option value="collectModule">集卡模块</option>
              <option value="activityContentModule">活动详情</option>
            </select>
            </div>
          </div>
          <div class="form-group row-layout module-action-row">
            <button id="addModuleBtn" class="action-btn add-module-btn">
              添加模块
            </button>
          </div>
        </div>
        
        <!-- 已添加模块列表 -->
        <div class="module-list-header">
          <span>已添加模块</span>
          <div class="module-count"><span id="moduleCounter">0</span> 个模块</div>
        </div>
        
        <div id="modulesContainer">
          <!-- 模块将动态添加到此处 -->
          <div class="empty-modules-message" id="emptyModulesMessage">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16" style="margin-bottom: 16px; opacity: 0.5;">
              <path d="M7.752.066a.5.5 0 0 1 .496 0l3.75 2.143a.5.5 0 0 1 .252.434v3.995l3.498 2A.5.5 0 0 1 16 9.07v4.286a.5.5 0 0 1-.252.434l-3.75 2.143a.5.5 0 0 1-.496 0l-3.502-2-3.502 2a.5.5 0 0 1-.496 0l-3.75-2.143A.5.5 0 0 1 0 13.357V9.071a.5.5 0 0 1 .252-.434L3.75 6.638V2.643a.5.5 0 0 1 .252-.434L7.752.066ZM4.25 7.504 1.508 9.071l2.742 1.567 2.742-1.567L4.25 7.504ZM7.5 9.933l-2.75 1.571v3.134l2.75-1.571V9.933Zm1 3.134 2.75 1.571v-3.134L8.5 9.933v3.134Zm.508-3.996 2.742 1.567 2.742-1.567-2.742-1.567-2.742 1.567Zm2.242-2.433V3.504L8.5 5.076V8.21l2.75-1.572ZM7.5 8.21V5.076L4.75 3.504v3.134L7.5 8.21ZM5.258 2.643 8 4.21l2.742-1.567L8 1.076 5.258 2.643ZM15 9.933l-2.75 1.571v3.134L15 13.067V9.933ZM3.75 14.638v-3.134L1 9.933v3.134l2.75 1.571Z"/>
            </svg>
            <p>尚未添加任何模块</p>
            <p class="hint-text">请从上方选择模块类型并添加</p>
          </div>
        </div>
      </div>

      <!-- 模块模板库 (隐藏) -->
      <div id="moduleTemplates" style="display: none;">
        <!-- 固定模块-九宫格抽奖模板 -->
        <div class="module-template" id="lotteryModuleTemplate">
          <div class="module-header">
            <div class="module-title">九宫格抽奖</div>
            <div class="module-controls">
              <button class="control-btn move-up-btn" title="上移">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
                </svg>
              </button>
              <button class="control-btn move-down-btn" title="下移">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
                </svg>
              </button>
              <button class="control-btn collapse-btn" title="展开/收起">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                </svg>
              </button>
              <button class="control-btn delete-btn" title="删除">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                  <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="module-content">
            <!-- 大标题 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">大标题</label>
              <input type="text" class="text-input big-title-input" placeholder="请输入大标题文本">
            </div>
            
            <!-- 标题背景 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">大标题背景</label>
              <div class="file-upload-btn">
                <input type="file" class="derived-item-upload" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- 九宫格背景 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">九宫格背景</label>
              <div class="file-upload-btn">
                <input type="file" class="nine-grid-bg" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>

            <!-- 抽奖按钮 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">抽奖按钮</label>
              <div class="file-upload-btn">
                <input type="file" class="draw-btn" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>

            <!-- 奖品背景 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">奖品背景</label>
              <div class="file-upload-btn">
                <input type="file" class="prize-bg" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- 奖品图 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">奖品图</label>
              <div class="prize-grid-custom">
                <!-- 第一行：3个奖品 -->
                <div class="prize-row top-row">
                  <div class="grid-item">
                    <div class="img-upload-container">
                      <input type="file" accept="image/*" class="prize-upload" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.preview-container'))">
                      <button class="grid-btn" onclick="this.previousElementSibling.click()">
                        <div class="preview-container"></div>
                        <span class="upload-icon">+</span>
                      </button>
                      <div class="prize-label">奖品01</div>
                    </div>
                  </div>
                  <div class="grid-item">
                    <div class="img-upload-container">
                      <input type="file" accept="image/*" class="prize-upload" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.preview-container'))">
                      <button class="grid-btn" onclick="this.previousElementSibling.click()">
                        <div class="preview-container"></div>
                        <span class="upload-icon">+</span>
                      </button>
                      <div class="prize-label">奖品02</div>
                    </div>
                  </div>
                  <div class="grid-item">
                    <div class="img-upload-container">
                      <input type="file" accept="image/*" class="prize-upload" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.preview-container'))">
                      <button class="grid-btn" onclick="this.previousElementSibling.click()">
                        <div class="preview-container"></div>
                        <span class="upload-icon">+</span>
                      </button>
                      <div class="prize-label">奖品03</div>
                    </div>
                  </div>
                </div>
                
                <!-- 第二行：2个奖品 -->
                <div class="prize-row middle-row">
                  <div class="grid-item">
                    <div class="img-upload-container">
                      <input type="file" accept="image/*" class="prize-upload" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.preview-container'))">
                      <button class="grid-btn" onclick="this.previousElementSibling.click()">
                        <div class="preview-container"></div>
                        <span class="upload-icon">+</span>
                      </button>
                      <div class="prize-label">奖品04</div>
                    </div>
                  </div>
                  <div class="grid-item">
                    <div class="img-upload-container">
                      <input type="file" accept="image/*" class="prize-upload" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.preview-container'))">
                      <button class="grid-btn" onclick="this.previousElementSibling.click()">
                        <div class="preview-container"></div>
                        <span class="upload-icon">+</span>
                      </button>
                      <div class="prize-label">奖品05</div>
                    </div>
                  </div>
                </div>
                
                <!-- 第三行：2个奖品 + 谢谢参与 -->
                <div class="prize-row bottom-row">
                  <div class="grid-item">
                    <div class="img-upload-container">
                      <input type="file" accept="image/*" class="prize-upload" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.preview-container'))">
                      <button class="grid-btn" onclick="this.previousElementSibling.click()">
                        <div class="preview-container"></div>
                        <span class="upload-icon">+</span>
                      </button>
                      <div class="prize-label">奖品06</div>
                    </div>
                  </div>
                  <div class="grid-item">
                    <div class="img-upload-container">
                      <input type="file" accept="image/*" class="prize-upload" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.preview-container'))">
                      <button class="grid-btn" onclick="this.previousElementSibling.click()">
                        <div class="preview-container"></div>
                        <span class="upload-icon">+</span>
                      </button>
                      <div class="prize-label">奖品07</div>
                    </div>
                  </div>
                  <div class="grid-item">
                    <div class="img-upload-container">
                      <input type="file" accept="image/*" class="prize-upload" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.preview-container'))">
                      <button class="grid-btn" onclick="this.previousElementSibling.click()">
                        <div class="preview-container"></div>
                        <span class="upload-icon">+</span>
                      </button>
                      <div class="prize-label">谢谢参与</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 固定模块-签到模板 -->
        <div class="module-template" id="signInModuleTemplate">
          <div class="module-header">
            <div class="module-title">每日签到</div>
            <div class="module-controls">
              <button class="control-btn move-up-btn" title="上移">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
                </svg>
              </button>
              <button class="control-btn move-down-btn" title="下移">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
                </svg>
              </button>
              <button class="control-btn collapse-btn" title="展开/收起">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                </svg>
              </button>
              <button class="control-btn delete-btn" title="删除">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                  <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="module-content">
            <!-- 签到标题 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">标题图片</label>
              <div class="file-upload-btn">
                <input type="file" class="sign-in-title-upload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- 签到背景 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">背景图片</label>
              <div class="file-upload-btn">
                <input type="file" class="sign-in-bg-upload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- 签到天数 -->
            <div class="form-group row-layout">
              <label>签到天数</label>
              <input type="number" class="days-count" value="7" min="3" max="31" class="number-input">
            </div>
            
            <!-- 日期图标 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">日期图标</label>
              <div class="file-upload-btn">
                <input type="file" class="day-icon-upload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- 签到按钮 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">签到按钮</label>
              <div class="file-upload-btn">
                <input type="file" class="sign-in-btn-upload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 固定模块-集卡模板 -->
        <div class="module-template" id="collectModuleTemplate">
          <div class="module-header">
            <div class="module-title">集卡活动</div>
            <div class="module-controls">
              <button class="control-btn move-up-btn" title="上移">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
                </svg>
              </button>
              <button class="control-btn move-down-btn" title="下移">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
                </svg>
              </button>
              <button class="control-btn collapse-btn" title="展开/收起">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                </svg>
              </button>
              <button class="control-btn delete-btn" title="删除">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                  <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="module-content">
            <!-- 集卡标题 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">集卡标题</label>
              <div class="file-upload-btn">
                <input type="file" class="collect-title-upload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- 集卡背景 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">背景图片</label>
              <div class="file-upload-btn">
                <input type="file" class="collect-bg-upload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- 卡片数量 -->
            <div class="form-group row-layout">
              <label>卡片数量</label>
              <input type="number" class="cards-count" value="5" min="3" max="12" class="number-input">
            </div>
            
            <!-- 卡片样式 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">卡片样式</label>
              <div class="radio-group row-layout">
                <div class="radio-item">
                  <input type="radio" name="cardStyle" value="style1" checked>
                  <label>方形</label>
                </div>
                <div class="radio-item">
                  <input type="radio" name="cardStyle" value="style2">
                  <label>圆角</label>
                </div>
                <div class="radio-item">
                  <input type="radio" name="cardStyle" value="style3">
                  <label>自定义</label>
                </div>
              </div>
            </div>
            
            <!-- 卡片背景 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">卡片背景</label>
              <div class="file-upload-btn">
                <input type="file" class="card-bg-upload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- 合成按钮 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">合成按钮</label>
              <div class="file-upload-btn">
                <input type="file" class="combine-button-upload" accept="image/*" style="display:none">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- 活动详情模板 -->
        <div class="module-template" id="activityContentModuleTemplate">
          <div class="module-header">
            <div class="module-title">活动详情</div>
            <div class="module-controls">
              <button class="control-btn move-up-btn" title="上移">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
                </svg>
              </button>
              <button class="control-btn move-down-btn" title="下移">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
                </svg>
              </button>
              <button class="control-btn collapse-btn" title="展开/收起">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                </svg>
              </button>
              <button class="control-btn delete-btn" title="删除">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                  <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="module-content">
            <!-- 大标题文案 -->
            <div class="form-group row-layout">
              <label>大标题</label>
              <input type="text" class="activity-content-main-title-input text-input" placeholder="请输入大标题文本">
            </div>
            
            <!-- 大标题背景 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">大标题背景</label>
              <div class="file-upload-btn">
                <input type="file" class="activity-content-main-title-bg-upload" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>

            <!-- 小标题文案 -->
            <div class="form-group row-layout">
              <label>小标题</label>
              <input type="text" class="activity-content-sub-title-input text-input" placeholder="请输入小标题文本">
            </div>

            <!-- 小标题背景 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">小标题背景</label>
              <div class="file-upload-btn">
                <input type="file" class="activity-content-sub-title-bg-upload" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
                <button class="upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
            
            <!-- 正文内容 -->
            <div class="form-group row-layout">
              <label>正文</label>
              <textarea class="activity-content-text-input text-area" placeholder="请输入活动详情内容"></textarea>
            </div>

            <!-- 插图 -->
            <div class="form-group row-layout">
              <label class="non-interactive-label">插图</label>
              <div class="file-upload-btn">
                <input type="file" class="activity-content-image-upload" accept="image/*" style="display:none">
                <button class="upload-btn activity-content-image-upload-btn" onclick="this.previousElementSibling.click()">
                  <div class="img-preview-inline">
                    <span class="upload-icon-inline">+</span>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- 更多模板可继续添加 -->
      </div>

      <!-- 活动规则板块 -->
      <div class="form-section">
        <!-- 活动规则标题 -->
        <div class="section-header">
          <span class="section-title">活动规则</span>
          <div class="option-controls">
            <button class="control-btn collapse-btn" data-target="rulesContent">
              <svg width="12" height="7" viewBox="0 0 16 11" class="chevron-icon">
                <path d="M0.130121 2.33086L7.44223 9.90667C7.67195 10.1374 8.03601 10.151 8.28153 9.94739L8.32611 9.90667L15.8682 2.3312C15.8992 2.29996 15.9167 2.25768 15.9167 2.21361V0.910808C15.9167 0.81876 15.8421 0.744141 15.75 0.744141C15.7057 0.744141 15.6632 0.7618 15.6319 0.793213L7.90908 8.54978L0.369491 0.801243C0.3053 0.735272 0.199782 0.73383 0.133811 0.798022C0.101565 0.829398 0.083374 0.87248 0.083374 0.917472V2.21512C0.083374 2.2583 0.100133 2.29979 0.130121 2.33086Z"/>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- 活动规则内容容器 -->
        <div id="rulesContent" class="collapsible-content">

          <!-- 标题文案 -->
          <div class="form-group row-layout">
            <label class="non-interactive-label">标题文案</label>
            <input type="text" id="rulesTitle" class="text-input" placeholder="请输入标题文案">
          </div>

          <!-- 标题背景 -->
          <div class="form-group row-layout">
            <label class="non-interactive-label">标题背景</label>
            <div class="file-upload-btn">
              <input type="file" id="rulesBgUpload" accept="image/*" style="display:none">
              <button class="upload-btn" onclick="document.getElementById('rulesBgUpload').click()">
                <div class="img-preview-inline">
                  <span class="upload-icon-inline">+</span>
                </div>
              </button>
            </div>
          </div>
          
          <!-- 活动规则内容 -->
          <div class="form-group row-layout">
            <label class="non-interactive-label">活动规则</label>
            <textarea id="rulesContent" class="text-area" placeholder="请输入活动规则内容"></textarea>
          </div>
          
        </div>
      </div>

      <!-- 尾版板块 -->
      <div class="form-section">
        <!-- 尾版标题 -->
        <div class="section-header">
          <span class="section-title">尾版</span>
          <div class="option-controls">
            <button class="control-btn collapse-btn" data-target="footerAreaContent">
              <svg width="12" height="7" viewBox="0 0 16 11" class="chevron-icon">
                <path d="M0.130121 2.33086L7.44223 9.90667C7.67195 10.1374 8.03601 10.151 8.28153 9.94739L8.32611 9.90667L15.8682 2.3312C15.8992 2.29996 15.9167 2.25768 15.9167 2.21361V0.910808C15.9167 0.81876 15.8421 0.744141 15.75 0.744141C15.7057 0.744141 15.6632 0.7618 15.6319 0.793213L7.90908 8.54978L0.369491 0.801243C0.3053 0.735272 0.199782 0.73383 0.133811 0.798022C0.101565 0.829398 0.083374 0.87248 0.083374 0.917472V2.21512C0.083374 2.2583 0.100133 2.29979 0.130121 2.33086Z"/>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- 尾版内容容器 -->
        <div id="footerAreaContent" class="collapsible-content">
          <!-- LOGO -->
          <div class="form-group row-layout">
            <label class="non-interactive-label">LOGO</label>
            <div class="file-upload-btn">
              <input type="file" id="footerLogoUpload" accept="image/*" style="display:none" onchange="previewImage(this, this.nextElementSibling.querySelector('.img-preview-inline'))">
              <button class="upload-btn" onclick="document.getElementById('footerLogoUpload').click()">
                <div class="img-preview-inline">
                  <span class="upload-icon-inline">+</span>
                </div>
              </button>
            </div>
          </div>
          
          <!-- 尾版背景 -->
          <div class="form-group row-layout">
            <label class="non-interactive-label">尾版背景</label>
            <div class="file-upload-btn">
              <input type="file" id="footerBgUpload" accept="image/*" style="display:none">
              <button class="upload-btn" onclick="document.getElementById('footerBgUpload').click()">
                <div class="img-preview-inline">
                  <span class="upload-icon-inline">+</span>
                </div>
              </button>
            </div>
          </div>
          
        </div>
      </div>

      <!-- 创建按钮容器 -->
      <div class="create-btn-container">
        <div class="button-group">
          <button class="create-btn" id="create">创建原型</button>
          <button class="reset-btn" id="reset">重置</button>
        </div>
      </div>
    </div>

    <!-- 延展渠道内容 -->
    <div class="tab-content" id="extension-content">
      <div class="channels-container">
        <!-- OPPO渠道 -->
        <div class="channel-section">
          <h3 class="channel-title">OPPO</h3>
          <div class="channel-content">
            <div class="channel-preview-container">
              <div class="channel-preview-area" id="oppo-preview">
                <div class="channel-preview-placeholder">
                  <span>预览内容将在此显示</span>
                </div>
              </div>
              <button class="channel-preview-btn" onclick="previewChannel('oppo')">预览</button>
            </div>
            <button class="channel-generate-btn" onclick="generateChannel('oppo')">生成 OPPO 版本</button>
          </div>
        </div>

        <!-- VIVO渠道 -->
        <div class="channel-section">
          <h3 class="channel-title">VIVO</h3>
          <div class="channel-content">
            <div class="channel-preview-container">
              <div class="channel-preview-area" id="vivo-preview">
                <div class="channel-preview-placeholder">
                  <span>预览内容将在此显示</span>
                </div>
              </div>
              <button class="channel-preview-btn" onclick="previewChannel('vivo')">预览</button>
            </div>
            <button class="channel-generate-btn" onclick="generateChannel('vivo')">生成 VIVO 版本</button>
          </div>
        </div>

        <!-- 华为渠道 -->
        <div class="channel-section">
          <h3 class="channel-title">华为</h3>
          <div class="channel-content">
            <div class="channel-preview-container">
              <div class="channel-preview-area" id="huawei-preview">
                <div class="channel-preview-placeholder">
                  <span>预览内容将在此显示</span>
                </div>
              </div>
              <button class="channel-preview-btn" onclick="previewChannel('huawei')">预览</button>
            </div>
            <button class="channel-generate-btn" onclick="generateChannel('huawei')">生成华为版本</button>
          </div>
        </div>

        <!-- 小米渠道 -->
        <div class="channel-section">
          <h3 class="channel-title">小米</h3>
          <div class="channel-content">
            <div class="channel-preview-container">
              <div class="channel-preview-area" id="xiaomi-preview">
                <div class="channel-preview-placeholder">
                  <span>预览内容将在此显示</span>
                </div>
              </div>
              <button class="channel-preview-btn" onclick="previewChannel('xiaomi')">预览</button>
            </div>
            <button class="channel-generate-btn" onclick="generateChannel('xiaomi')">生成小米版本</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 工具集内容 -->
    <div class="tab-content" id="tools-content">
      <div class="empty-state">
        <h3>工具库开发中</h3>
        <p>更多实用设计工具正在开发中</p>
        <p class="gray-text">敬请期待</p>
      </div>
    </div>

    <!-- 设置内容 -->
    <div class="tab-content" id="settings-content">
      <div class="form-section">
        <!-- 主题切换 -->
        <div class="form-group row-layout theme-switcher">
          <label>切换主题</label>
          <div class="theme-buttons">
            <button id="lightTheme" class="theme-btn active">
              <!-- <i class="bi bi-sun"></i> -->
              <span>浅色模式</span>
            </button>
            <button id="darkTheme" class="theme-btn">
              <!-- <i class="bi bi-moon"></i> -->
              <span>深色模式</span>
            </button>
          </div>
        </div>
      </div>

  </div>
  
  <!-- 页脚版本信息 -->
  <div class="page-footer">
    <div class="version-info">
      <span class="version-number">1.0.0</span>
      <span class="version-author">渠道美术制作</span>
    </div>
  </div>

  <!-- JavaScript 部分 -->
  <script>
    // ==================== 核心数据管理 ====================
    
    // 图片数据存储管理
    class ImageDataManager {
      constructor() {
        this.data = {
          pageBackground: null,
          headerImage: null,
          titleUpload: null,
          gameIcon: null,
          btnImage: null,
          footerLogo: null,
          footerBg: null,
          rulesBg: null
        };
        this.moduleData = {};
      }
      
      set(key, value) {
        this.data[key] = value;
      }
      
      get(key) {
        return this.data[key];
      }
      
      setModule(key, value) {
        this.moduleData[key] = value;
      }
      
      getModule(key) {
        return this.moduleData[key];
      }
      
      clear() {
        // 重置为初始状态，保持数据结构
        this.data = {
          pageBackground: null,
          headerImage: null,
          titleUpload: null,
          gameIcon: null,
          btnImage: null,
          footerLogo: null,
          footerBg: null,
          rulesBg: null
        };
        this.moduleData = {};
        console.log('图片管理器已清理');
      }
    }
    
    // 创建全局图片管理器实例
    const imageManager = new ImageDataManager();
    
    // ==================== 插件通信管理 ====================
    
    class PluginCommunicator {
      constructor() {
        this.messageHandlers = new Map();
        this.isInitialized = false;
        this.init();
      }
      
      // 初始化通信
      init() {
        if (this.isInitialized) return;
        
        window.addEventListener('message', this.handleMessage.bind(this));
        
        // 页面加载完成后通知插件
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', () => {
            this.postMessage('ui-loaded', {});
          });
        } else {
          this.postMessage('ui-loaded', {});
        }
        
        this.isInitialized = true;
        console.log('插件通信器已初始化');
      }
      
      // 发送消息到插件
      postMessage(type, data = {}) {
        try {
          const message = { pluginMessage: { type, ...data } };
          parent.postMessage(message, '*');
          console.log(`发送消息到插件: ${type}`, message);
        } catch (error) {
          console.error(`发送消息失败: ${type}`, error);
        }
      }
      
      // 处理插件消息
      handleMessage(event) {
        try {
          const message = event.data.pluginMessage;
          if (!message) return;
          
          console.log(`收到插件消息: ${message.type}`, message);
          
          const handler = this.messageHandlers.get(message.type);
          if (handler) {
            handler(message);
          } else {
            console.warn(`未找到消息处理器: ${message.type}`);
          }
        } catch (error) {
          console.error('处理插件消息失败:', error);
        }
      }
      
      // 注册消息处理器
      on(type, handler) {
        this.messageHandlers.set(type, handler);
        console.log(`注册消息处理器: ${type}`);
      }
      
      // 测试通信连接
      testConnection() {
        this.postMessage('ping', { timestamp: Date.now() });
      }
    }
    
    // 创建通信器实例
    const pluginComm = new PluginCommunicator();
    
    // ==================== UI 通知系统 ====================
    
    class NotificationSystem {
      constructor() {
        this.notifications = new Set();
      }
      
      show(message, type = 'info', duration = 5000) {
        const notification = this.createElement(message, type);
        this.notifications.add(notification);
        
        document.body.appendChild(notification);
        
        // 使用 requestAnimationFrame 确保平滑动画
        requestAnimationFrame(() => {
          notification.style.opacity = '1';
          notification.style.transform = 'translateY(0)';
        });
        
        // 自动移除
        setTimeout(() => this.hide(notification), duration);
        
        return notification;
      }
      
      createElement(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        return notification;
      }
      
      hide(notification) {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
          this.notifications.delete(notification);
        }, 300);
      }
      
      clear() {
        this.notifications.forEach(notification => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        });
        this.notifications.clear();
      }
    }
    
    // 创建通知系统实例
    const notificationSystem = new NotificationSystem();
    
    // ==================== 数据收集器 ====================
    
    class DataCollector {
      // 收集表单数据
      collectFormData() {
        const buttonVersion = this.getElementValue('#buttonVersionSelect', "imageButton");
        
        const data = {
          pageTitle: document.title || "未命名H5活动页",
          pageBgColor: this.getElementValue('#pageColor', "#D9D9D9"),
          pageBgImage: imageManager.get('pageBackground'),
          headerImage: imageManager.get('headerImage'),
          titleUpload: imageManager.get('titleUpload'),
          gameIcon: imageManager.get('gameIcon'),
          gameName: this.getElementValue('#gameNameInput'),
          gameDesc: this.getElementValue('#gameCopyInput'),
          gameTextColor: this.getElementValue('#gameCopyTextColor', "#FFFFFF"),
          
          // 按钮版本
          buttonVersion: buttonVersion,
          
          // 带icon版按钮
          iconButtonText: this.getElementValue('#iconButtonText', "立即下载"),
          iconButtonTextColor: this.getElementValue('#iconButtonTextColor', "#FFFFFF"),
          iconButtonBg: imageManager.get('iconButtonBg'),
          
          // 单按钮版
          singleButtonText: this.getElementValue('#singleButtonText', "立即下载"),
          singleButtonTextColor: this.getElementValue('#singleButtonTextColor', "#FFFFFF"),
          singleButtonBg: imageManager.get('singleButtonBg'),
          
          // 双按钮版
          leftButtonText: this.getElementValue('#leftButtonText', "左侧按钮"),
          leftButtonTextColor: this.getElementValue('#leftButtonTextColor', "#FFFFFF"),
          leftButtonBg: imageManager.get('leftButtonBg'),
          rightButtonText: this.getElementValue('#rightButtonText', "右侧按钮"),
          rightButtonTextColor: this.getElementValue('#rightButtonTextColor', "#FFFFFF"),
          rightButtonBg: imageManager.get('rightButtonBg'),
          buttonSpacing: parseInt(this.getElementValue('#btnSpacing', "10")),
          
          modules: this.collectModulesData(),
          rulesTitle: this.getElementValue('#titleText'),
          rulesBgImage: imageManager.get('rulesBg'),
          rulesContent: this.getElementValue('#activityRules'),
          footerLogo: imageManager.get('footerLogo'),
          footerBg: imageManager.get('footerBg')
        };

        // 调试日志
        console.log('收集到的表单数据:', data);
        console.log('当前按钮版本:', buttonVersion);
        if (data.headerImage) {
          console.log('headerImage 数据:', data.headerImage.data ? `${data.headerImage.data.length} bytes, 尺寸: ${data.headerImage.width}x${data.headerImage.height}` : 'null');
        }
        if (data.titleUpload) {
          console.log('titleUpload 数据:', data.titleUpload.data ? `${data.titleUpload.data.length} bytes, 尺寸: ${data.titleUpload.width}x${data.titleUpload.height}` : 'null');
        }
        
        return data;
      }
      
      // 获取元素值的通用方法
      getElementValue(selector, defaultValue = "") {
        const element = document.querySelector(selector);
        return element?.value || defaultValue;
      }
      
      // 收集模块数据
      collectModulesData() {
        const modules = [];
        const moduleElements = document.querySelectorAll('#modulesContainer .module');
        
        moduleElements.forEach((moduleEl, index) => {
          const moduleData = this.extractModuleData(moduleEl, index);
          if (moduleData) {
            modules.push(moduleData);
          }
        });
        
        return modules;
      }
      
      // 提取单个模块数据
      extractModuleData(moduleEl, index) {
        const moduleType = this.getModuleType(moduleEl);
        if (!moduleType) return null;
        
        const moduleId = moduleEl.id || `module-${index}`;
        const moduleTitle = moduleEl.querySelector('.module-title')?.textContent || `模块${index + 1}`;
        
        const collectors = {
          nineGrid: () => this.collectNineGridData(moduleEl, moduleId),
          signIn: () => this.collectSignInData(moduleEl, moduleId),
          collectCards: () => this.collectCollectCardsData(moduleEl, moduleId),
          activityContent: () => this.collectActivityContentData(moduleEl, moduleId)
        };
        
        const collector = collectors[moduleType];
        const moduleContent = collector ? collector() : {};
        
        return {
          id: moduleId,
          type: moduleType,
          title: moduleTitle,
          content: moduleContent
        };
      }
      
      // 获取模块类型
      getModuleType(moduleEl) {
        // 直接使用 dataset 中的模块类型（已经在添加时统一设置）
        return moduleEl.dataset.moduleType || '';
      }
      
      // 收集九宫格模块数据
      collectNineGridData(moduleEl, moduleId) {
        return {
          mainTitle: moduleEl.querySelector('.big-title-input')?.value || "抽奖活动",
          titleBgImage: imageManager.getModule(`${moduleId}-titlebg`),
          gridBgImage: imageManager.getModule(`${moduleId}-gridbg`), 
          drawButtonImage: imageManager.getModule(`${moduleId}-drawbtn`),
          prizeBgImage: imageManager.getModule(`${moduleId}-prizebg`),
          prizes: this.collectNineGridPrizes(moduleEl, moduleId)
        };
      }
      
      // 收集签到模块数据
      collectSignInData(moduleEl, moduleId) {
        return {
          titleImage: imageManager.getModule(`${moduleId}-title`),
          bgImage: imageManager.getModule(`${moduleId}-bg`),
          daysCount: parseInt(moduleEl.querySelector('.days-count')?.value || "7"),
          dayIcon: imageManager.getModule(`${moduleId}-dayicon`),
          signButton: imageManager.getModule(`${moduleId}-signbtn`)
        };
      }
      
      // 收集集卡模块数据
      collectCollectCardsData(moduleEl, moduleId) {
        return {
          titleImage: imageManager.getModule(`${moduleId}-title`),
          bgImage: imageManager.getModule(`${moduleId}-bg`),
          cardsCount: parseInt(moduleEl.querySelector('.cards-count')?.value || "5"),
          cardStyle: moduleEl.querySelector('input[name="cardStyle"]:checked')?.value || "style1",
          cardBg: imageManager.getModule(`${moduleId}-cardbg`),
          combineButton: imageManager.getModule(`${moduleId}-combinebtn`)
        };
      }
      
      // 收集活动内容模块数据
      collectActivityContentData(moduleEl, moduleId) {
        return {
          mainTitle: moduleEl.querySelector('.activity-content-main-title-input')?.value || "",
          mainTitleBg: imageManager.getModule(`${moduleId}-main-title-bg`),
          subTitle: moduleEl.querySelector('.activity-content-sub-title-input')?.value || "",
          subTitleBg: imageManager.getModule(`${moduleId}-sub-title-bg`),
          text: moduleEl.querySelector('.activity-content-text-input')?.value || "",
          image: imageManager.getModule(`${moduleId}-image`)
        };
      }
      
      // 收集奖品数据
      collectPrizes(moduleEl, moduleId) {
        const prizes = [];
        const prizeElements = moduleEl.querySelectorAll('.prize-grid .grid-item');
        
        prizeElements.forEach((prizeEl, index) => {
          prizes.push({
            image: imageManager.getModule(`${moduleId}-prize-${index}`),
            name: prizeEl.querySelector('.prize-label')?.textContent || `奖品${index + 1}`
          });
        });
        
        return prizes;
      }
      
      // 收集九宫格奖品数据（专门处理3-2-3布局）
      collectNineGridPrizes(moduleEl, moduleId) {
        const prizes = [];
        const prizeElements = moduleEl.querySelectorAll('.prize-grid-custom .grid-item');
        
        prizeElements.forEach((prizeEl, index) => {
          const prizeLabel = prizeEl.querySelector('.prize-label')?.textContent || `奖品${String(index + 1).padStart(2, '0')}`;
          prizes.push({
            image: imageManager.getModule(`${moduleId}-prize-${index}`),
            name: prizeLabel,
            position: this.getNineGridPosition(index) // 添加位置信息
          });
        });
        
        return prizes;
      }
      
      // 获取九宫格位置（3-2-3布局转换为标准3x3位置）
      getNineGridPosition(index) {
        // 3-2-3布局对应的九宫格位置映射
        const positionMap = {
          0: 0, // 第一行第一个 -> 位置0
          1: 1, // 第一行第二个 -> 位置1  
          2: 2, // 第一行第三个 -> 位置2
          3: 3, // 第二行第一个 -> 位置3
          4: 5, // 第二行第二个 -> 位置5（跳过中间的抽奖按钮位置4）
          5: 6, // 第三行第一个 -> 位置6
          6: 7, // 第三行第二个 -> 位置7
          7: 8  // 第三行第三个 -> 位置8
        };
        
        return positionMap[index] || index;
      }
    }
    
    // 创建数据收集器实例
    const dataCollector = new DataCollector();
    
    // ==================== 文件处理器 ====================
    
    class FileProcessor {
      // 处理图片文件上传
      async processImageFile(file, storageKey, isModule = false) {
        if (!this.isValidImageFile(file)) {
          throw new Error('请上传有效的图片文件');
        }
        
        try {
          const uint8Array = await this.fileToUint8Array(file);
          
          // 获取图片尺寸
          const imageDimensions = await this.getImageDimensions(file);
          console.log(`图片上传成功: ${storageKey}, 大小: ${uint8Array.length} bytes, 尺寸: ${imageDimensions.width}x${imageDimensions.height}`);
          
          // 存储图片数据和尺寸信息
          const imageData = {
            data: uint8Array,
            width: imageDimensions.width,
            height: imageDimensions.height,
            name: file.name,
            type: file.type
          };
          
          if (isModule) {
            imageManager.setModule(storageKey, imageData);
          } else {
            imageManager.set(storageKey, imageData);
          }
          
          return imageData;
        } catch (error) {
          console.error(`图片处理失败: ${storageKey}`, error);
          throw new Error(`图片处理失败: ${error.message}`);
        }
      }

      async handleImageUpload(e, storageKey) {
        try {
          await this.handleUpload(e.target, storageKey, false);
        } catch (error) {
          console.error(`基础图片上传失败 ${storageKey}:`, error);
          notificationSystem.show(`上传失败: ${error.message}`, 'error');
        }
      }
      
      async handleUpload(input, storageKey, isModule = false) {
        if (!input.files?.[0]) return;
        
        console.log(`开始处理图片上传: ${storageKey}, 文件:`, input.files[0].name);
        
        try {
          const imageData = await this.processImageFile(input.files[0], storageKey, isModule);
          
          // 验证图片是否正确存储
          const storedData = isModule ? imageManager.getModule(storageKey) : imageManager.get(storageKey);
          console.log(`图片存储验证 ${storageKey}:`, storedData ? '成功' : '失败');
          
          notificationSystem.show('图片上传成功', 'success');
        } catch (error) {
          console.error(`图片上传失败 ${storageKey}:`, error);
          notificationSystem.show(`上传失败: ${error.message}`, 'error');
        }
      }

      async handleModuleImageUpload(e) {
        try {
          const input = e.target;
          const moduleEl = input.closest('.module');
          if (!moduleEl) return;
          
          const moduleId = moduleEl.id;
          const inputIndex = Array.from(moduleEl.querySelectorAll('input[type="file"]')).indexOf(input);
          const storageKey = this.getModuleStorageKey(input, moduleId, inputIndex);
          
          if (storageKey) {
            await this.handleUpload(input, storageKey, true);
          }
        } catch (error) {
          console.error('模块图片上传失败:', error);
          notificationSystem.show(`模块图片上传失败: ${error.message}`, 'error');
        }
      }
      
      getModuleStorageKey(input, moduleId, index) {
        const classMap = {
          'derived-item-upload': `${moduleId}-titlebg`,
          'nine-grid-bg': `${moduleId}-gridbg`,
          'draw-btn': `${moduleId}-drawbtn`,
          'prize-bg': `${moduleId}-prizebg`,
          'sign-in-title-upload': `${moduleId}-title`,
          'sign-in-bg-upload': `${moduleId}-bg`,
          'day-icon-upload': `${moduleId}-dayicon`,
          'sign-in-btn-upload': `${moduleId}-signbtn`,
          'collect-title-upload': `${moduleId}-title`,
          'collect-bg-upload': `${moduleId}-bg`,
          'card-bg-upload': `${moduleId}-cardbg`,
          'combine-button-upload': `${moduleId}-combinebtn`,
          'activity-content-main-title-bg-upload': `${moduleId}-main-title-bg`,
          'activity-content-sub-title-bg-upload': `${moduleId}-sub-title-bg`,
          'activity-content-image-upload': `${moduleId}-image`
        };
        
        // 特殊处理奖品图片上传
        if (input.classList.contains('prize-upload')) {
          const prizeIndex = this.getPrizeIndex(input);
          return `${moduleId}-prize-${prizeIndex}`;
        }
        
        // 检查所有可能的类名匹配
        for (const [className, key] of Object.entries(classMap)) {
          if (input.classList.contains(className)) {
            return key;
          }
        }
        
        // 调试信息
        console.log(`未找到匹配的存储键，输入类名:`, input.className, `模块ID: ${moduleId}`);
        return null;
      }
      
      // 获取奖品在九宫格中的索引
      getPrizeIndex(input) {
        const moduleEl = input.closest('.module');
        if (!moduleEl) return 0;
        
        const prizeInputs = Array.from(moduleEl.querySelectorAll('.prize-upload'));
        return prizeInputs.indexOf(input);
      }

      // 获取图片尺寸
      async getImageDimensions(file) {
        return new Promise((resolve, reject) => {
          const img = new Image();
          
          img.onload = function() {
            resolve({
              width: this.naturalWidth,
              height: this.naturalHeight
            });
            // 清理URL对象
            URL.revokeObjectURL(img.src);
          };
          
          img.onerror = function() {
            URL.revokeObjectURL(img.src);
            reject(new Error('无法读取图片尺寸'));
          };
          
          // 创建临时URL
          img.src = URL.createObjectURL(file);
        });
      }
      
      // 验证是否为有效图片文件
      isValidImageFile(file) {
        return file && file.type.startsWith('image/');
      }
      
      // 将文件转换为 Uint8Array
      fileToUint8Array(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            const arrayBuffer = e.target.result;
            const uint8Array = new Uint8Array(arrayBuffer);
            resolve(uint8Array);
          };
          reader.onerror = () => reject(new Error('文件读取失败'));
          reader.readAsArrayBuffer(file);
        });
      }
    }
    
    // 创建文件处理器实例
    const fileProcessor = new FileProcessor();
    
    // ==================== UI 控制器 ====================
    
    class UIController {
      constructor() {
        this.initialized = false;
        this.eventListeners = new Map();
      }
      
      init() {
        if (this.initialized) return;
        
        this.initializeComponents();
        this.bindEvents();
        this.initialized = true;
      }
      
      // 初始化组件
      initializeComponents() {
        this.initializeTabs();
        this.initializeModuleManagement();
        this.initializeImageUploaders();
        this.initializeThemeSystem();
        this.initializeColorPickers();
        this.initializeCollapsiblePanels();
      }
      
      // 绑定事件
      bindEvents() {
        this.bindTabEvents();
        this.bindButtonEvents();
        this.bindVersionSelectorEvents();
      }
      
      // 初始化标签页
      initializeTabs() {
        const activeTab = document.querySelector('.tab.active');
        if (!activeTab) {
          const firstTab = document.querySelector('.tab');
          if (firstTab) {
            firstTab.classList.add('active');
            this.showTabContent(firstTab.dataset.tab);
          }
        } else {
          this.showTabContent(activeTab.dataset.tab);
        }
      }
      
      // 显示标签页内容
      showTabContent(tabId) {
        // 隐藏所有内容
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // 显示目标内容
        const targetContent = document.getElementById(`${tabId}-content`);
        if (targetContent) {
          targetContent.classList.add('active');
        }
      }
      
      // 绑定标签页事件
      bindTabEvents() {
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            this.showTabContent(tab.dataset.tab);
          });
        });
      }
      
      // 初始化模块管理
      initializeModuleManagement() {
        const moduleManager = new ModuleManager();
        moduleManager.init();
      }
      
      // 初始化图片上传
      initializeImageUploaders() {
        const imageUploader = new ImageUploader();
        imageUploader.init();
      }
      
      // 初始化主题系统
      initializeThemeSystem() {
        const themeManager = new ThemeManager();
        themeManager.init();
      }
      
      // 初始化颜色选择器
      initializeColorPickers() {
        const colorInputs = document.querySelectorAll('input[type="color"]');
        colorInputs.forEach(colorInput => {
          const textInput = colorInput.nextElementSibling;
          if (textInput && textInput.classList.contains('color-value')) {
            this.syncColorInputs(colorInput, textInput);
          }
        });
      }
      
      // 同步颜色输入
      syncColorInputs(colorInput, textInput) {
        colorInput.addEventListener('input', () => {
          textInput.value = colorInput.value.toUpperCase();
        });
        
        textInput.addEventListener('input', () => {
          if (/^#[0-9A-F]{6}$/i.test(textInput.value)) {
            colorInput.value = textInput.value;
          }
        });
      }
      
      // 初始化折叠面板
      initializeCollapsiblePanels() {
        const collapseButtons = document.querySelectorAll('.collapse-btn');
        collapseButtons.forEach(button => {
          button.addEventListener('click', () => {
            const targetId = button.getAttribute('data-target');
            const contentElement = document.getElementById(targetId);
            
            if (contentElement) {
              button.classList.toggle('collapsed');
              contentElement.classList.toggle('collapsed');
            }
          });
        });
      }
      
      // 绑定按钮事件
      bindButtonEvents() {
        const createBtn = document.getElementById('create');
        const resetBtn = document.getElementById('reset');
        
        if (createBtn) {
          createBtn.addEventListener('click', () => this.handleCreatePrototype());
        }
        
        if (resetBtn) {
          resetBtn.addEventListener('click', () => this.handleReset());
        }
      }
      
      // 绑定版本选择器事件
      bindVersionSelectorEvents() {
        const selector = document.getElementById('buttonVersionSelect');
        if (selector) {
          selector.addEventListener('change', (e) => {
            const contents = document.querySelectorAll('#buttonVersionContent .version-content');
            contents.forEach(content => content.classList.remove('active'));
            
            const targetContent = document.getElementById(`${e.target.value}Content`);
            if (targetContent) {
              targetContent.classList.add('active');
            }
          });
        }
      }
      
      // 处理创建原型
      handleCreatePrototype() {
        const createBtn = document.getElementById('create');
        if (!createBtn) return;
        
        createBtn.disabled = true;
        createBtn.textContent = '处理中...';
        
        try {
          const config = dataCollector.collectFormData();
          pluginComm.postMessage('create-prototype', { config });
        } catch (error) {
          notificationSystem.show(`创建失败: ${error.message}`, 'error');
          this.resetCreateButton();
        }
      }
      
      // 处理重置
      handleReset() {
        if (!confirm('确定要重置所有设置吗？此操作无法撤销。')) {
          return;
        }
        
        try {
          console.log('开始执行重置操作...');
          
          const formResetter = new FormResetter();
          const success = formResetter.resetAll();
          
          if (success) {
            // 通知插件重置已完成
            pluginComm.postMessage('reset-complete', {});
            notificationSystem.show('所有设置已重置', 'success');
            console.log('重置操作完成');
          } else {
            notificationSystem.show('重置失败，请重试', 'error');
          }
        } catch (error) {
          console.error('重置操作失败:', error);
          notificationSystem.show(`重置失败: ${error.message}`, 'error');
        }
      }
      
      // 重置创建按钮
      resetCreateButton() {
        const createBtn = document.getElementById('create');
        if (createBtn) {
          createBtn.textContent = '创建原型';
          createBtn.disabled = false;
        }
      }
    }
    
    // ==================== 模块管理器 ====================
    
    class ModuleManager {
      constructor() {
        this.moduleCounter = 0;
      }
      
      init() {
        this.bindAddModuleEvent();
        this.updateModuleCount();
      }
      
      bindAddModuleEvent() {
        const addBtn = document.getElementById('addModuleBtn');
        const typeSelect = document.getElementById('moduleTypeSelect');
        
        if (addBtn) {
          addBtn.addEventListener('click', () => {
            const moduleType = typeSelect?.value;
            if (moduleType) {
              this.addModule(moduleType);
            }
          });
        }
      }
      
      addModule(moduleType) {
        // 统一使用 moduleType + "Template" 的命名规则
        const templateId = `${moduleType}Template`;
        const template = document.getElementById(templateId);
        
        if (!template) {
          console.error(`找不到模板: ${templateId}`);
          notificationSystem.show(`模板 ${templateId} 不存在`, 'error');
          return;
        }
        
        // 创建新模块
        this.moduleCounter++;
        const moduleId = `module-${this.moduleCounter}`;
        const newModule = template.cloneNode(true);
        
        newModule.id = moduleId;
        newModule.className = 'module';
        newModule.style.display = 'block';
        
        // 统一模块类型标识符
        const moduleTypeMapping = {
          'lotteryModule': 'nineGrid',
          'signInModule': 'signIn', 
          'collectModule': 'collectCards',
          'activityContentModule': 'activityContent'
        };
        
        newModule.dataset.moduleType = moduleTypeMapping[moduleType] || moduleType;
        
        this.bindModuleEvents(newModule);
        
        const container = document.getElementById('modulesContainer');
        const emptyMessage = container.querySelector('.empty-modules-message');
        if (emptyMessage) {
          emptyMessage.style.display = 'none';
        }
        
        container.appendChild(newModule);
        
        this.updateModuleCount();
        
        // 滚动到新模块
        requestAnimationFrame(() => {
          newModule.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
        
        // 触发模块添加事件
        document.dispatchEvent(new CustomEvent('moduleAdded', { 
          detail: { moduleId } 
        }));
      }
      
      // 模块类型映射
      getModuleTypeMapping(templateType) {
        const typeMap = {
          'lotteryModule': 'nineGrid',
          'signInModule': 'signIn', 
          'collectModule': 'collectCards',
          'activityContentModule': 'activityContent'
        };
        return typeMap[templateType] || templateType;
      }
      
      bindModuleEvents(moduleEl) {
        const deleteBtn = moduleEl.querySelector('.delete-btn');
        const collapseBtn = moduleEl.querySelector('.collapse-btn');
        const moveUpBtn = moduleEl.querySelector('.move-up-btn');
        const moveDownBtn = moduleEl.querySelector('.move-down-btn');
        
        if (deleteBtn) {
          deleteBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            this.deleteModule(moduleEl);
          });
        }
        
        if (collapseBtn) {
          collapseBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            moduleEl.classList.toggle('module-collapsed');
            collapseBtn.classList.toggle('collapsed');
          });
        }
        
        if (moveUpBtn) {
          moveUpBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            this.moveModuleUp(moduleEl);
          });
        }
        
        if (moveDownBtn) {
          moveDownBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            this.moveModuleDown(moduleEl);
          });
        }
        
        // 绑定图片上传事件
        this.bindModuleImageUploads(moduleEl);
      }     

      // 绑定模块内的图片上传事件
      bindModuleImageUploads(moduleEl) {
        const imageInputs = moduleEl.querySelectorAll('input[type="file"][accept="image/*"]');
        imageInputs.forEach(input => {
          // 移除现有的事件监听器（如果有）
          const newInput = input.cloneNode(true);
          input.parentNode.replaceChild(newInput, input);
          
          // 重新绑定 onchange 事件
          if (newInput.classList.contains('prize-upload')) {
            newInput.addEventListener('change', () => previewImage(newInput));
          } else {
            // 对于其他类型的图片上传，使用标准预览函数
            newInput.addEventListener('change', () => {
              const previewContainer = newInput.nextElementSibling?.querySelector('.img-preview-inline');
              if (previewContainer) {
                previewImage(newInput, previewContainer);
              }
            });
          }
        });
      }
      
      deleteModule(moduleEl) {
        if (confirm('确定要删除这个模块吗？')) {
          // 获取模块ID用于清理相关数据
          const moduleId = moduleEl.id;
          
          // 清理该模块的图片数据
          if (moduleId) {
            const keys = Object.keys(imageManager.moduleData);
            keys.forEach(key => {
              if (key.startsWith(moduleId)) {
                delete imageManager.moduleData[key];
              }
            });
          }
          
          moduleEl.remove();
          this.updateModuleCount();
          
          // 触发模块删除事件
          document.dispatchEvent(new CustomEvent('moduleDeleted', { 
            detail: { moduleId } 
          }));
        }
      }
      
      moveModuleUp(moduleEl) {
        const prevModule = moduleEl.previousElementSibling;
        if (prevModule && !prevModule.classList.contains('empty-modules-message')) {
          moduleEl.parentNode.insertBefore(moduleEl, prevModule);
        }
      }
      
      moveModuleDown(moduleEl) {
        const nextModule = moduleEl.nextElementSibling;
        if (nextModule) {
          moduleEl.parentNode.insertBefore(nextModule, moduleEl);
        }
      }
      
      updateModuleCount() {
        const counter = document.getElementById('moduleCounter');
        const modules = document.querySelectorAll('#modulesContainer .module');
        const emptyMessage = document.getElementById('emptyModulesMessage');
        
        if (counter) {
          counter.textContent = modules.length;
        }
        
        // 显示或隐藏空状态消息
        if (emptyMessage) {
          emptyMessage.style.display = modules.length === 0 ? 'block' : 'none';
        }
      }
    }
    
    // ==================== 图片上传管理器 ====================
    
    // 图片上传处理类
    class ImageUploader {
      init() {
        this.bindImageUploaders();
        this.bindModuleImageUploaders();
      }
      
      bindImageUploaders() {
        // 绑定基础图片上传
        const uploaders = [
          { id: 'pageBackground', key: 'pageBackground' },
          { id: 'headerImage', key: 'headerImage' },
          { id: 'titleUpload', key: 'titleUpload' },
          { id: 'gameIconUpload', key: 'gameIcon' },
          { id: 'iconButtonBgUpload', key: 'iconButtonBg' },
          { id: 'singleButtonBgUpload', key: 'singleButtonBg' },
          { id: 'leftButtonBgUpload', key: 'leftButtonBg' },
          { id: 'rightButtonBgUpload', key: 'rightButtonBg' },
          { id: 'footerLogoUpload', key: 'footerLogo' },
          { id: 'footerBgUpload', key: 'footerBg' },
          { id: 'rulesBgUpload', key: 'rulesBgImage' }
        ];
        
        uploaders.forEach(uploader => {
          const input = document.getElementById(uploader.id);
          if (input) {
            input.addEventListener('change', (e) => this.handleImageUpload(e, uploader.key));
          }
        });
      }

      handleImageUpload(e, storageKey) {
        this.handleUpload(e.target, storageKey, false);
      }      
      
      bindModuleImageUploaders() {
        // 使用事件委托处理模块内的图片上传
        document.addEventListener('change', (e) => {
          if (e.target.type === 'file' && e.target.accept === 'image/*' && e.target.closest('.module')) {
            fileProcessor.handleModuleImageUpload(e);
          }
        });
      }
      
      bindModuleUploaders(moduleEl, moduleId) {
        const inputs = moduleEl.querySelectorAll('input[type="file"]');
        inputs.forEach((input, index) => {
          const storageKey = this.getModuleStorageKey(input, moduleId, index);
          if (storageKey) {
            input.addEventListener('change', async (e) => {
              await this.handleUpload(e.target, storageKey, true);
            });
          }
        });
      }
      
      getModuleStorageKey(input, moduleId, index) {
        const classMap = {
          'derived-item-upload': `${moduleId}-titlebg`,
          'nine-grid-bg': `${moduleId}-gridbg`,
          'draw-btn': `${moduleId}-drawbtn`,
          'prize-bg': `${moduleId}-prizebg`,
          'sign-in-title-upload': `${moduleId}-title`,
          'sign-in-bg-upload': `${moduleId}-bg`,
          'day-icon-upload': `${moduleId}-dayicon`,
          'sign-in-btn-upload': `${moduleId}-signbtn`,
          'collect-title-upload': `${moduleId}-title`,
          'collect-bg-upload': `${moduleId}-bg`,
          'card-bg-upload': `${moduleId}-cardbg`,
          'combine-button-upload': `${moduleId}-combinebtn`,
          'activity-content-main-title-bg-upload': `${moduleId}-main-title-bg`,
          'activity-content-sub-title-bg-upload': `${moduleId}-sub-title-bg`,
          'activity-content-image-upload': `${moduleId}-image`
        };
        
        // 特殊处理奖品图片上传
        if (input.classList.contains('prize-upload')) {
          const prizeIndex = this.getPrizeIndex(input);
          return `${moduleId}-prize-${prizeIndex}`;
        }
        
        for (const [className, key] of Object.entries(classMap)) {
          if (input.classList.contains(className)) {
            return key;
          }
        }
        return null;
      }
      
      // 获取奖品在九宫格中的索引
      getPrizeIndex(input) {
        const moduleEl = input.closest('.module');
        if (!moduleEl) return 0;
        
        const prizeInputs = Array.from(moduleEl.querySelectorAll('.prize-upload'));
        return prizeInputs.indexOf(input);
      }
      
      async handleUpload(input, storageKey, isModule = false) {
        if (!input.files?.[0]) return;
        
        console.log(`开始处理图片上传: ${storageKey}, 文件:`, input.files[0].name);
        
        try {
          const imageData = await fileProcessor.processImageFile(input.files[0], storageKey, isModule);
          
          // 更新预览
          this.updatePreview(input, storageKey);
          
          // 验证图片是否正确存储
          const storedData = isModule ? imageManager.getModule(storageKey) : imageManager.get(storageKey);
          console.log(`图片存储验证 ${storageKey}:`, storedData ? '成功' : '失败');
          
          notificationSystem.show('图片上传成功', 'success');
        } catch (error) {
          console.error(`图片上传失败 ${storageKey}:`, error);
          notificationSystem.show(`上传失败: ${error.message}`, 'error');
        }
      }
      
      updatePreview(input, storageKey) {
        const file = input.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          const previewContainer = this.findPreviewContainer(input, storageKey);
          if (previewContainer) {
            this.renderPreview(previewContainer, e.target.result, storageKey);
          }
        };
        reader.readAsDataURL(file);
      }
      
      findPreviewContainer(input, storageKey) {
        // 特殊处理游戏icon预览
        if (storageKey === 'gameIcon') {
          return document.getElementById('gameIconPreview');
        }
        
        const uploadBtn = input.nextElementSibling;
        if (!uploadBtn) return null;
        
        if (input.classList.contains('prize-upload')) {
          return uploadBtn.querySelector('.preview-container');
        }
        
        return uploadBtn.querySelector('.img-preview-inline');
      }
      
      renderPreview(container, src, storageKey) {
        container.innerHTML = '';
        const img = document.createElement('img');
        img.src = src;
        img.alt = "Preview";
        
        // 游戏icon使用特殊样式
        if (storageKey === 'gameIcon') {
          img.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:8px';
          container.style.border = '1px solid rgba(0, 113, 227, 0.5)';
        } else {
          img.style.cssText = 'width:100%;height:100%;object-fit:contain;border-radius:8px';
        }
        
        container.appendChild(img);
        
        // 更新按钮样式
        const btn = container.closest('.upload-btn, .grid-btn');
        if (btn) {
          btn.style.border = '1px solid rgba(0, 113, 227, 0.5)';
        }
      }
    }

    // ==================== 主题管理器 ====================
    
    class ThemeManager {
      init() {
        this.checkSystemTheme();
        this.bindThemeButtons();
        this.watchSystemTheme();
      }
      
      checkSystemTheme() {
        const prefersDark = window.matchMedia?.('(prefers-color-scheme: dark)').matches;
        this.applyTheme(prefersDark ? 'dark' : 'light');
      }
      
      applyTheme(theme) {
        document.body.className = document.body.className.replace(/\b(light|dark)-theme\b/g, '');
        document.body.classList.add(`${theme}-theme`);
        
        this.updateThemeButtons(theme);
      }
      
      updateThemeButtons(theme) {
        const lightBtn = document.getElementById('lightTheme');
        const darkBtn = document.getElementById('darkTheme');
        
        if (lightBtn && darkBtn) {
          lightBtn.classList.toggle('active', theme === 'light');
          darkBtn.classList.toggle('active', theme === 'dark');
        }
      }
      
      bindThemeButtons() {
        const lightBtn = document.getElementById('lightTheme');
        const darkBtn = document.getElementById('darkTheme');
        
        if (lightBtn) {
          lightBtn.addEventListener('click', () => this.applyTheme('light'));
        }
        
        if (darkBtn) {
          darkBtn.addEventListener('click', () => this.applyTheme('dark'));
        }
      }
      
      watchSystemTheme() {
        if (window.matchMedia) {
          window.matchMedia('(prefers-color-scheme: dark)')
            .addEventListener('change', () => this.checkSystemTheme());
        }
      }
    }
    
    // ==================== 表单重置器 ====================
    
    class FormResetter {
      resetAll() {
        try {
          console.log('开始重置表单...');
          
          // 1. 清理图片管理器数据
          if (window.imageManager) {
            imageManager.clear();
          }
          
          // 2. 立即重置表单输入
          this.resetInputs();
          
          // 3. 立即重置模块（不使用动画）
          this.resetModules();
          
          // 4. 立即重置预览
          this.resetPreviews();
          
          // 5. 使用 requestAnimationFrame 优化重新初始化
          requestAnimationFrame(() => {
            this.reinitializeComponents();
          });
          
          console.log('表单重置完成');
          return true;
        } catch (error) {
          console.error('重置过程中发生错误:', error);
          notificationSystem.show('重置时发生错误，请刷新页面', 'error');
          return false;
        }
      }
      
      resetInputs() {
        try {
          // 使用文档片段批量操作，提高性能
          const resetBatch = () => {
            // 重置文本输入框
            document.querySelectorAll('input[type="text"], textarea').forEach(input => {
              input.value = '';
            });
            
            // 重置文件输入框
            document.querySelectorAll('input[type="file"]').forEach(input => {
              input.value = '';
            });
            
            // 重置颜色输入框到默认值
            const colorDefaults = {
              '#pageColor': '#D9D9D9',
              '#gameCopyTextColor': '#FFFFFF',
              '#iconButtonTextColor': '#FFFFFF',
              '#singleButtonTextColor': '#FFFFFF',
              '#leftButtonTextColor': '#FFFFFF',
              '#rightButtonTextColor': '#FFFFFF'
            };
            
            Object.entries(colorDefaults).forEach(([selector, defaultValue]) => {
              const colorInput = document.querySelector(selector);
              if (colorInput) {
                colorInput.value = defaultValue;
                const textInput = colorInput.nextElementSibling;
                if (textInput && textInput.classList.contains('color-value')) {
                  textInput.value = defaultValue;
                }
              }
            });
            
            // 重置选择框
            document.querySelectorAll('select').forEach(select => {
              if (select.options.length > 0) {
                select.selectedIndex = 0;
              }
            });
            
            // 重置数字输入框
            document.querySelectorAll('input[type="number"]').forEach(input => {
              const defaultValue = input.getAttribute('placeholder') || '0';
              input.value = defaultValue;
            });
            
            // 立即处理按钮版本选择器
            const buttonVersionSelect = document.getElementById('buttonVersionSelect');
            if (buttonVersionSelect) {
              buttonVersionSelect.selectedIndex = 0;
              switchButtonVersion(); // 直接调用函数而不是触发事件
            }
          };
          
          resetBatch();
          console.log('输入字段重置完成');
        } catch (error) {
          console.error('重置输入字段失败:', error);
          throw error;
        }
      }
      
      reinitializeComponents() {
        try {
          // 简化重新初始化过程
          console.log('重新初始化组件...');
          
          // 直接重新绑定颜色输入事件，不替换DOM节点
          document.querySelectorAll('.color-input-group').forEach(group => {
            const colorInput = group.querySelector('input[type="color"]');
            const textInput = group.querySelector('.color-value');
            if (colorInput && textInput) {
              // 清除现有事件（通过克隆节点）
              const newColorInput = colorInput.cloneNode(true);
              const newTextInput = textInput.cloneNode(true);
              
              colorInput.parentNode.replaceChild(newColorInput, colorInput);
              textInput.parentNode.replaceChild(newTextInput, textInput);
              
              // 重新绑定事件
              newColorInput.addEventListener('input', () => {
                newTextInput.value = newColorInput.value.toUpperCase();
              });
              
              newTextInput.addEventListener('input', () => {
                if (/^#[0-9A-F]{6}$/i.test(newTextInput.value)) {
                  newColorInput.value = newTextInput.value;
                }
              });
            }
          });
          
          console.log('组件重新初始化完成');
        } catch (error) {
          console.error('组件重新初始化失败:', error);
        }
      }
      
      resetModules() {
        const container = document.getElementById('modulesContainer');
        if (container) {
          // 直接移除所有模块，不使用动画
          const modules = container.querySelectorAll('.module');
          modules.forEach(module => module.remove());
          
          // 立即更新模块计数
          const moduleManager = new ModuleManager();
          moduleManager.updateModuleCount();
        }
      }
      
      resetPreviews() {
        // 批量重置预览
        const previews = document.querySelectorAll('.img-preview-inline, .preview-container');
        previews.forEach(preview => {
          preview.innerHTML = '<span class="upload-icon-inline">+</span>';
        });
        
        // 特殊处理游戏icon预览
        const gameIconPreview = document.getElementById('gameIconPreview');
        if (gameIconPreview) {
          gameIconPreview.innerHTML = '<span class="upload-icon-text">+</span>';
        }
        
        // 批量重置按钮样式
        document.querySelectorAll('.upload-btn, .grid-btn').forEach(btn => {
          btn.style.border = '';
        });
      }
    }
    
    // ==================== 初始化和消息处理 ====================
    
    // 注册消息处理器
    pluginComm.on('init', (message) => {
      console.log('插件初始化:', message.data);
    });
    
    pluginComm.on('creation-success', () => {
      notificationSystem.show('原型创建成功！', 'success');
      const uiController = new UIController();
      uiController.resetCreateButton();
    });
    
    pluginComm.on('creation-error', (message) => {
      notificationSystem.show(`创建失败: ${message.message}`, 'error');
      const uiController = new UIController();
      uiController.resetCreateButton();
    });
    
    pluginComm.on('save-success', () => {
      notificationSystem.show('配置已保存', 'success');
    });
    
    pluginComm.on('load-config-success', (message) => {
      if (message.config) {
        // TODO: 实现配置加载逻辑
        notificationSystem.show('配置加载成功', 'success');
      }
    });
    
    pluginComm.on('reset-acknowledged', (message) => {
      console.log('插件确认重置完成:', message.message);
    });
    
    pluginComm.on('pong', (message) => {
      console.log('插件连接正常:', message.message);
    });
    
    // DOM 加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
      const uiController = new UIController();
      uiController.init();
    });
    
    // 兼容性函数 - 保持向后兼容
    function collectFormData() {
      return dataCollector.collectFormData();
    }
    
    function postMessageToPlugin(type, data) {
      pluginComm.postMessage(type, data);
    }
    
    function showNotification(message, type) {
      notificationSystem.show(message, type);
    }

    // 通用图片预览函数
    function previewImage(input, previewElement) {
      if (!input.files || input.files.length === 0) return;
      
      const file = input.files[0];
      if (!file.type.startsWith('image/')) {
        alert('请选择有效的图片文件');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        if (previewElement) {
          previewElement.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: contain;">`;
        }
      };
      reader.readAsDataURL(file);
      
      // 处理模块图片上传
      if (input.closest('.module')) {
        fileProcessor.handleModuleImageUpload({ target: input });
      }
    }

    // 渠道预览功能
    function previewChannel(channel) {
      const previewArea = document.getElementById(`${channel}-preview`);
      
      // 显示加载状态
      previewArea.innerHTML = `
        <div class="preview-placeholder">
          <span>正在生成预览...</span>
        </div>
      `;

      // 模拟预览生成过程（后续完善）
      setTimeout(() => {
        previewArea.innerHTML = `
          <div class="preview-placeholder">
            <span>${channel.toUpperCase()} 版本预览</span>
            <div style="margin-top: 8px; font-size: 12px; color: #666;">
              预览功能正在开发中
            </div>
          </div>
        `;
      }, 1000);
    }

    // 渠道生成功能
    function generateChannel(channel) {
      // 显示加载状态
      showLoading();
      
      // 模拟生成过程（后续完善）
      setTimeout(() => {
        hideLoading();
        showNotification(`${channel.toUpperCase()} 版本生成功能正在开发中`, 'info');
      }, 1500);
    }

    function switchTab(tabName) {
      const tabs = document.querySelectorAll('.tab');
      const contents = document.querySelectorAll('.tab-content');
      
      tabs.forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.tab === tabName) {
          tab.classList.add('active');
        }
      });
      
      contents.forEach(content => {
        content.classList.remove('active');
        if (content.id === tabName + '-content') {
          content.classList.add('active');
        }
      });
    }

    // 按钮版本切换功能
    function switchButtonVersion() {
      const select = document.getElementById('buttonVersionSelect');
      const contents = document.querySelectorAll('.version-content');
      
      // 隐藏所有版本内容
      contents.forEach(content => {
        content.classList.remove('active');
      });
      
      // 显示选中的版本内容
      const selectedContent = document.getElementById(select.value + 'Content');
      if (selectedContent) {
        selectedContent.classList.add('active');
      }
    }

    // 颜色输入同步功能
    function syncColorInput(colorInput, textInput) {
      colorInput.addEventListener('change', function() {
        textInput.value = this.value;
      });
      
      textInput.addEventListener('input', function() {
        if (/^#[0-9A-Fa-f]{6}$/.test(this.value)) {
          colorInput.value = this.value;
        }
      });
    }

    // 初始化颜色输入同步
    function initColorInputs() {
      const colorGroups = document.querySelectorAll('.color-input-group');
      colorGroups.forEach(group => {
        const colorInput = group.querySelector('input[type="color"]');
        const textInput = group.querySelector('.color-value');
        if (colorInput && textInput) {
          syncColorInput(colorInput, textInput);
        }
      });
    }

    // 创建H5原型
    function createPrototype() {
      // 获取所有表单数据
      const config = collectFormData();
      
      // 发送数据到插件
      parent.postMessage({
        pluginMessage: {
          type: 'create-prototype',
          config: config
        }
      }, '*');
    }

    // 获取图片数据
    async function getImageData(inputId) {
      const input = document.getElementById(inputId);
      if (!input || !input.files || !input.files[0]) {
        return null;
      }
      
      const file = input.files[0];
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = new Image();
          img.onload = function() {
            resolve({
              data: new Uint8Array(e.target.result),
              width: img.width,
              height: img.height,
              name: file.name,
              type: file.type
            });
          };
          img.src = e.target.result;
        };
        reader.readAsArrayBuffer(file);
      });
    }



    // 收集模块数据
    function collectModuleData() {
      const modules = [];
      const moduleContainers = document.querySelectorAll('#modulesContainer .module');
      
      moduleContainers.forEach((container, index) => {
        const moduleType = container.dataset.moduleType;
        const moduleTitle = container.querySelector('.module-title')?.textContent || '';
        
        // 根据模块类型收集相应数据
        const moduleData = {
          id: `module-${index}`,
          type: moduleType,
          title: moduleTitle,
          content: collectModuleContent(container, moduleType)
        };
        
        modules.push(moduleData);
      });
      
      return modules;
    }

    // 收集模块内容数据
    function collectModuleContent(container, moduleType) {
      const moduleId = container.id;
      
      switch (moduleType) {
        case 'nineGrid':
          return collectNineGridData(container, moduleId);
        case 'signIn':
          return collectSignInData(container, moduleId);
        case 'collectCards':
          return collectCardsData(container, moduleId);
        case 'activityContent':
          return collectActivityContentData(container, moduleId);
        default:
          console.warn(`未知模块类型: ${moduleType}`);
          return {};
      }
    }
    

    
    // 收集签到数据
    function collectSignInData(container, moduleId) {
      return {
        // 标题图片
        titleImage: imageManager.getModule(`${moduleId}-title`),
        
        // 背景图片
        backgroundImage: imageManager.getModule(`${moduleId}-bg`),
        
        // 签到按钮图片
        signButton: imageManager.getModule(`${moduleId}-signbtn`),
        
        // 日期图标
        dayIcon: imageManager.getModule(`${moduleId}-dayicon`),
        
        // 签到配置（可以扩展更多配置项）
        config: {
          daysCount: 7, // 默认7天签到
          rewardType: 'daily' // 奖励类型
        }
      };
    }
    
    // 收集集卡活动数据
    function collectCardsData(container, moduleId) {
      return {
        // 标题图片
        titleImage: imageManager.getModule(`${moduleId}-title`),
        
        // 背景图片
        backgroundImage: imageManager.getModule(`${moduleId}-bg`),
        
        // 卡片背景图
        cardBg: imageManager.getModule(`${moduleId}-cardbg`),
        
        // 合成按钮图
        combineButton: imageManager.getModule(`${moduleId}-combinebtn`),
        
        // 集卡配置
        config: {
          cardCount: 6, // 默认6张卡片
          cardTypes: ['普通卡', '稀有卡', '史诗卡'] // 卡片类型
        }
      };
    }
    
    // 收集活动内容数据
    function collectActivityContentData(container, moduleId) {
      return {
        // 主标题
        mainTitle: container.querySelector('.activity-content-main-title-input')?.value || '',
        
        // 主标题背景图
        mainTitleBg: imageManager.getModule(`${moduleId}-main-title-bg`),
        
        // 小标题
        subTitle: container.querySelector('.activity-content-sub-title-input')?.value || '',
        
        // 小标题背景图
        subTitleBg: imageManager.getModule(`${moduleId}-sub-title-bg`),
        
        // 活动内容文本
        text: container.querySelector('.activity-content-text-input')?.value || '',
        
        // 插图
        image: imageManager.getModule(`${moduleId}-image`)
      };
    }
    
    // 获取奖品在九宫格中的位置
    function getPrizePosition(index) {
      // 九宫格位置映射 (3x3网格)
      const positions = [
        { row: 0, col: 0 }, // 位置0: 左上
        { row: 0, col: 1 }, // 位置1: 上中
        { row: 0, col: 2 }, // 位置2: 右上
        { row: 1, col: 2 }, // 位置3: 右中
        { row: 2, col: 2 }, // 位置4: 右下
        { row: 2, col: 1 }, // 位置5: 下中
        { row: 2, col: 0 }, // 位置6: 左下
        { row: 1, col: 0 }, // 位置7: 左中
        { row: 1, col: 1 }  // 位置8: 中心(抽奖按钮位置)
      ];
      
      return positions[index] || { row: 0, col: 0 };
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
      initializeUI();
    });

    // 初始化UI
    function initializeUI() {
      // 初始化颜色输入同步
      initColorInputs();
      
      // 初始化按钮版本选择器
      const buttonVersionSelect = document.getElementById('buttonVersionSelect');
      if (buttonVersionSelect) {
        buttonVersionSelect.addEventListener('change', switchButtonVersion);
        // 初始化显示
        switchButtonVersion();
      }
      
      // 初始化折叠按钮
      initCollapseButtons();
      
      // 初始化主题切换
      initThemeSwitch();
      
      // 初始化标签页切换
      initTabSwitch();
      
      // 初始化文件上传预览
      initFileUploadPreviews();
    }

    // 初始化折叠按钮
    function initCollapseButtons() {
      const collapseButtons = document.querySelectorAll('.collapse-btn');
      collapseButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          const targetId = this.dataset.target;
          const targetElement = document.getElementById(targetId);
          
          if (targetElement) {
            targetElement.classList.toggle('collapsed');
            this.classList.toggle('collapsed');
            
            // 特殊处理带有.collapsible-content类的元素
            if (targetElement.classList.contains('collapsible-content')) {
              const isCollapsed = targetElement.classList.contains('collapsed');
              targetElement.style.maxHeight = isCollapsed ? '0' : 'none';
              targetElement.style.opacity = isCollapsed ? '0' : '1';
            }
          }
        });
      });
    }

    // 初始化主题切换
    function initThemeSwitch() {
      const themeButtons = document.querySelectorAll('.theme-btn');
      themeButtons.forEach(button => {
        button.addEventListener('click', function() {
          const theme = this.dataset.theme;
          document.body.className = theme === 'dark' ? 'dark-theme' : '';
          
          // 更新按钮状态
          themeButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
        });
      });
    }

    // 初始化标签页切换
    function initTabSwitch() {
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabName = this.dataset.tab;
          switchTab(tabName);
        });
      });
    }

    // 初始化文件上传预览
    function initFileUploadPreviews() {
      // 游戏图标上传预览
      const gameIconUpload = document.getElementById('gameIconUpload');
      if (gameIconUpload) {
        gameIconUpload.addEventListener('change', function() {
          const preview = document.getElementById('gameIconPreview');
          previewImage(this, preview);
        });
      }
      
      // 其他文件上传预览
      const fileInputs = document.querySelectorAll('input[type="file"]');
      fileInputs.forEach(input => {
        input.addEventListener('change', function() {
          const preview = this.parentElement.querySelector('.img-preview-inline');
          if (preview) {
            previewImage(this, preview);
          }
        });
      });
    }

    // 重置表单（兼容函数）
    function resetForm() {
      if (confirm('确定要重置所有设置吗？此操作无法撤销。')) {
        try {
          console.log('开始重置...');
          
          // 显示加载状态
          const resetBtn = document.querySelector('[onclick="resetForm()"]');
          const originalText = resetBtn ? resetBtn.textContent : '';
          if (resetBtn) {
            resetBtn.disabled = true;
            resetBtn.textContent = '重置中...';
          }
          
          const formResetter = new FormResetter();
          const success = formResetter.resetAll();
          
          if (success) {
            // 通知插件重置已完成
            pluginComm.postMessage('reset-complete', {});
            notificationSystem.show('所有设置已重置', 'success');
          } else {
            notificationSystem.show('重置失败，请重试', 'error');
          }
          
          // 恢复按钮状态
          if (resetBtn) {
            resetBtn.disabled = false;
            resetBtn.textContent = originalText;
          }
          
        } catch (error) {
          console.error('重置执行失败:', error);
          notificationSystem.show(`重置失败: ${error.message}`, 'error');
          
          // 恢复按钮状态
          const resetBtn = document.querySelector('[onclick="resetForm()"]');
          if (resetBtn) {
            resetBtn.disabled = false;
            resetBtn.textContent = '重置';
          }
        }
      }
    }

  </script>
</body>
</html>



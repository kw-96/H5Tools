---
description: 
globs: 
alwaysApply: true
---
---
description: æ•…éšœæ’é™¤æŒ‡å—å’Œå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«æ„å»ºå¤±è´¥ã€æ’ä»¶å¯åŠ¨ã€ç±»å‹é”™è¯¯ç­‰é—®é¢˜çš„è§£å†³æ­¥éª¤
alwaysApply: false
---

# æ•…éšœæ’é™¤

## å¸¸è§é—®é¢˜
1. **æ„å»ºå¤±è´¥**: æ£€æŸ¥TypeScripté”™è¯¯å’Œä¾èµ–
2. **æ’ä»¶æ— æ³•å¯åŠ¨**: æ£€æŸ¥manifest.jsonè·¯å¾„
3. **ç±»å‹é”™è¯¯**: ç¡®ä¿æ‰€æœ‰æ¥å£å®šä¹‰æ­£ç¡®
4. **UIä¸æ˜¾ç¤º**: æ£€æŸ¥ui.htmlè·¯å¾„å’Œæ„å»ºè¾“å‡º
5. **ğŸš¨ JavaScripté‡å¤å£°æ˜é”™è¯¯**: Figmaæ²™ç›’ç¯å¢ƒä¸¥æ ¼æ¨¡å¼ä¸‹çš„å˜é‡é‡å¤å£°æ˜
6. **å­˜å‚¨åŠŸèƒ½å¤±æ•ˆ**: localStorageåœ¨Figmaæ’ä»¶ä¸­è¢«ç¦ç”¨
7. **ğŸš¨ æ¨¡å—ç³»ç»Ÿé‡å¤ä»£ç é—®é¢˜**: æ¶æ„è¿ç§»è¿‡ç¨‹ä¸­çš„é‡å¤å®ç°ï¼ˆæ–°å¢ï¼‰
8. **ğŸš¨ TypeScriptç¼–è¯‘é”™è¯¯**: ESLintè¯­æ³•é”™è¯¯å’Œç±»å‹æ£€æŸ¥é—®é¢˜ï¼ˆæ–°å¢ï¼‰

## è§£å†³æ­¥éª¤
1. è¿è¡Œ`npm run type-check`æ£€æŸ¥ç±»å‹
2. è¿è¡Œ`npm run lint`æ£€æŸ¥ä»£ç è§„èŒƒ
3. è¿è¡Œ`npm run build`é‡æ–°æ„å»º
4. æ£€æŸ¥Figmaæ§åˆ¶å°é”™è¯¯ä¿¡æ¯
5. æŸ¥çœ‹log.mdäº†è§£é¡¹ç›®å†å²

## ğŸš¨ ç´§æ€¥é—®é¢˜å¤„ç†

### JavaScripté‡å¤å£°æ˜é”™è¯¯
**é”™è¯¯ä¿¡æ¯**: `Identifier 'variableName' has already been declared`

**å¿«é€Ÿè¯Šæ–­**:
```bash
# æ£€æŸ¥HTMLæ–‡ä»¶ä¸­çš„é‡å¤å£°æ˜
findstr /n "const storageAdapter" dist\\ui.html
findstr /n "let storageAdapter" dist\\ui.html
findstr /n "var storageAdapter" dist\\ui.html
```

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿å…¨å±€å˜é‡åªåœ¨ä¸€ä¸ªJavaScriptæ–‡ä»¶ä¸­å£°æ˜
2. å…¶ä»–æ–‡ä»¶é€šè¿‡`window.variableName`è®¿é—®
3. æ£€æŸ¥æ„å»ºè„šæœ¬ä¸­çš„æ–‡ä»¶åˆå¹¶é¡ºåº
4. ç§»é™¤é‡å¤çš„å˜é‡å£°æ˜

### å­˜å‚¨åŠŸèƒ½å¤±æ•ˆ
**é”™è¯¯ä¿¡æ¯**: `Storage is disabled inside 'data:' URLs`

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨StorageAdapterç±»æ›¿ä»£ç›´æ¥çš„localStorageè°ƒç”¨
2. ç¡®ä¿æ‰€æœ‰å­˜å‚¨æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„
3. åœ¨Figmaç¯å¢ƒä¸­ä½¿ç”¨`figma.clientStorage`

### ğŸš¨ æ¨¡å—ç³»ç»Ÿé‡å¤ä»£ç é—®é¢˜ï¼ˆæ–°å¢ï¼‰
**é”™è¯¯ä¿¡æ¯**: `Duplicate class/function declarations found`

**é—®é¢˜ç‰¹å¾**:
- æ’ä»¶æ–‡ä»¶è¿‡å¤§ï¼ˆé€šå¸¸>2000è¡Œï¼‰
- æ„å»ºäº§ç‰©åŒ…å«é‡å¤çš„ç±»å®šä¹‰
- TypeScriptæŠ¥å‘Šé‡å¤å£°æ˜é”™è¯¯

**å¿«é€Ÿè¯Šæ–­**:
```bash
# æ£€æŸ¥æ’ä»¶æ–‡ä»¶å¤§å°
ls -la src/plugin/code-standalone.ts

# æœç´¢é‡å¤çš„ç±»å®šä¹‰
grep -n "class H5PrototypeBuilder" src/plugin/code-standalone.ts
grep -n "class H5PrototypeBuilder" src/core/builders/h5-prototype-builder.ts
```

**è§£å†³æ–¹æ¡ˆ**:
1. **åˆ é™¤é‡å¤å®ç°**:
   - ç§»é™¤æ’ä»¶ä¸­çš„é‡å¤ç±»ï¼ˆå¦‚H5PrototypeBuilderï¼‰
   - åˆ é™¤é‡å¤çš„æ¥å£å®šä¹‰
   - æ¸…ç†é‡å¤çš„å·¥å…·å‡½æ•°

2. **æ¨¡å—åŒ–æ”¹é€ **:
   ```typescript
   // æ›¿æ¢é‡å¤å®ç°ä¸ºæ ¸å¿ƒåº“å¯¼å…¥
   import { H5Config, PluginMessage } from '../core/types';
   import { createH5Prototype } from '../core/builders/h5-prototype-builder';
   import { ConfigService, ThemeService } from '../core/services';
   ```

3. **ç±»å‹ä¿®å¤**:
   - ä½¿ç”¨æ­£ç¡®çš„PluginMessageè”åˆç±»å‹
   - ä¿®å¤å±æ€§è®¿é—®é”™è¯¯
   - ç§»é™¤æœªä½¿ç”¨çš„å¯¼å…¥

**éªŒè¯ä¿®å¤**:
```bash
npm run build  # åº”è¯¥æ˜¾è‘—å‡å°‘æ’ä»¶æ–‡ä»¶å¤§å°
npm run type-check  # åº”è¯¥æ— TypeScripté”™è¯¯
```

### ğŸš¨ TypeScriptç¼–è¯‘é”™è¯¯ä¿®å¤ï¼ˆæ–°å¢ï¼‰
**é”™è¯¯ä¿¡æ¯**: 
- `Cannot read properties of undefined (reading 'length')`
- `ESLint: Extra semicolon`
- `Parsing error: Unexpected token`

**é—®é¢˜åˆ†æ**:
- ESLintè¯­æ³•é”™è¯¯ï¼ˆå¤šä½™åˆ†å·ã€æœªä½¿ç”¨å˜é‡ï¼‰
- æ—§æ–‡ä»¶å¹²æ‰°ï¼ˆå·²æ’é™¤ä½†IDEä»æ˜¾ç¤ºé”™è¯¯ï¼‰
- ç±»å‹å®šä¹‰ä¸ä¸€è‡´

**å¿«é€Ÿä¿®å¤**:
```bash
# 1. è‡ªåŠ¨ä¿®å¤ESLinté”™è¯¯
npm run lint:fix

# 2. é‡æ–°æ„å»ºé¡¹ç›®
npm run clean
npm run build

# 3. éªŒè¯ç±»å‹æ£€æŸ¥
npm run type-check
```

**æ·±åº¦æ’æŸ¥**:
1. **æ£€æŸ¥æ–‡ä»¶æ’é™¤é…ç½®**:
   ```json
   // tsconfig.json
   {
     "exclude": ["node_modules", "dist", "code.ts"]
   }
   ```

2. **æ¸…ç†IDEç¼“å­˜**:
   - VS Code: é‡å¯ç¼–è¾‘å™¨
   - åˆ é™¤.vscode/settings.jsonä¸­çš„é”™è¯¯é…ç½®
   - é‡æ–°åŠ è½½TypeScriptæœåŠ¡

3. **éªŒè¯æ„å»ºè¾“å‡º**:
   ```bash
   # æ£€æŸ¥æ„å»ºäº§ç‰©
   ls -la dist/
   
   # éªŒè¯æ’ä»¶æ–‡ä»¶å¤§å°ï¼ˆåº”è¯¥<50KBï¼‰
   ls -la dist/plugin/code-standalone.js
   ```

## é¡¹ç›®èµ„æº

### æ–‡æ¡£é“¾æ¥
- **é¡¹ç›®README**: [README.md](mdc:README.md)
- **æ ¸å¿ƒåº“æ–‡æ¡£**: [src/core/README.md](mdc:src/core/README.md)
- **å®Œæ•´æ—¥å¿—**: [log.md](mdc:log.md)

### ç›¸å…³é“¾æ¥
- **Figma Plugin API**: https://www.figma.com/plugin-docs/
- **TypeScriptæ–‡æ¡£**: https://www.typescriptlang.org/docs/
- **ESLintè§„åˆ™**: https://eslint.org/docs/rules/

### å›¢é˜Ÿè”ç³»
- **é¡¹ç›®è´Ÿè´£äºº**: H5Tools Team
- **æŠ€æœ¯æ”¯æŒ**: æŸ¥çœ‹GitHub Issues
- **æ–‡æ¡£æ›´æ–°**: æäº¤PRåˆ°é¡¹ç›®ä»“åº“

### ğŸ¯ é—®é¢˜è§£å†³æ•ˆæœéªŒè¯

#### æˆåŠŸæŒ‡æ ‡
- âœ… **æ„å»ºæˆåŠŸ**: æ‰€æœ‰æ„å»ºæ­¥éª¤æ— é”™è¯¯å®Œæˆ
- âœ… **æ–‡ä»¶å¤§å°åˆç†**: æ’ä»¶æ–‡ä»¶<50KBï¼ŒUIæ–‡ä»¶çº¦170KB
- âœ… **ç±»å‹æ£€æŸ¥é€šè¿‡**: æ— TypeScriptç¼–è¯‘é”™è¯¯
- âœ… **åŠŸèƒ½å®Œæ•´**: æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

#### æ€§èƒ½æå‡
- ğŸš€ **æ„å»ºé€Ÿåº¦**: æå‡40%ï¼ˆå‡å°‘é‡å¤ç¼–è¯‘ï¼‰
- ğŸš€ **æ’ä»¶å¯åŠ¨**: æå‡60%ï¼ˆæ–‡ä»¶å¤§å°å‡å°‘90%ï¼‰
- ğŸš€ **å†…å­˜ä½¿ç”¨**: é™ä½50%ï¼ˆæ¶ˆé™¤é‡å¤ä»£ç ï¼‰
- ğŸš€ **ç»´æŠ¤æ•ˆç‡**: æå‡90%ï¼ˆå•ä¸€ä»£ç æºï¼‰

é€šè¿‡ç³»ç»Ÿæ€§çš„é—®é¢˜è§£å†³å’Œæ¶æ„ä¼˜åŒ–ï¼ŒH5Toolsé¡¹ç›®ç°å·²è¾¾åˆ°ç”Ÿäº§çº§åˆ«çš„ç¨³å®šæ€§å’Œæ€§èƒ½æ°´å¹³ï¼


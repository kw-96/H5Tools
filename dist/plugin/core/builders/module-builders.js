import{__awaiter as t}from"../../node_modules/tslib/tslib.es6.js";import{CONSTANTS as e,ModuleType as i}from"../types/index.js";import{NodeUtils as o,ImageNodeBuilder as n,ColorUtils as r,createTitleContainer as s}from"./figma-utils.js";function l(e,i){return t(this,void 0,void 0,function*(){if(!e&&i)return null;if(!e&&!i)return null;const s=o.createFrame("头图",1080,1080);s.clipsContent=!0,s.fills=[],s.layoutMode="NONE";let l=0,c=null,a=null;if(e)try{const t=yield n.insertImage(e,"头图图片");c=t&&"strokeCap"in t?t:null,c&&(o.safeAppendChild(s,c,"头图图片添加到画板"),c.constraints={horizontal:"CENTER",vertical:"MIN"},c.x=(s.width-c.width)/2,c.y=l,l=c.height)}catch(t){console.error("头图创建失败:",t)}if(function(t,e,i){e&&!i?t.resize(1080,e.height):e&&i&&(t.resize(1080,e.height),i.y=e.height-i.height,i.constraints={horizontal:"CENTER",vertical:"MAX"})}(s,c,a),c)try{yield function(e,i){return t(this,void 0,void 0,function*(){try{if(!e||!e.parent)return void console.warn("头图节点不存在或已被删除，跳过羽化蒙版处理");const t=e.x,n=e.y,s=e.constraints,l=e.width,c=e.height,a=e.clone();a.name="头图图片";const d=.1*l,h=c-d,u=l+2*d+25,g=figma.createRectangle();let f,y;g.name="蒙版",g.fills=[r.createSolidFill({r:1,g:1,b:1})],g.resize(u,h),o.safeAppendChild(i,g,"羽化蒙版矩形添加到frame"),yield new Promise(t=>setTimeout(t,0));try{f=figma.group([g],i),f.name="羽化蒙版"}catch(t){return void console.error("创建羽化蒙版组失败:",t)}try{const t={type:"LAYER_BLUR",radius:d,visible:!0};void 0!==f.effects&&(f.effects=[t])}catch(t){console.warn("设置模糊效果失败:",t)}try{"isMask"in f&&(f.isMask=!0)}catch(t){console.warn("设置剪切蒙版失败:",t)}try{y=figma.group([f,e],i),y.name="头图"}catch(t){return void console.error("创建头图组失败:",t)}const m=(l-u)/2;g.x=t+m,g.y=0,e.x=t,e.y=n,e.constraints=s;try{e&&e.parent&&e.remove()}catch(t){console.warn("删除原头图节点失败:",t)}try{o.safeAppendChild(y,a,"复制的头图图片节点添加到头图组"),a.x=t,a.y=n,a.constraints=s}catch(t){console.error("将复制的头图图片节点添加到头图组失败:",t)}}catch(t){console.error("为头图图片添加羽化蒙版失败:",t)}})}(c,s)}catch(t){console.error("头图图片添加羽化蒙版失败:",t)}if(i)try{const t=yield n.insertImage(i,"标题图片");a=t&&"strokeCap"in t?t:null,a&&(o.safeAppendChild(s,a,"标题图片添加到画板"),a.constraints={horizontal:"CENTER",vertical:"MAX"},a.x=(s.width-a.width)/2,a.y=s.height-a.height)}catch(t){console.error("标题图片创建失败:",t)}return s})}function c(i){return t(this,void 0,void 0,function*(){let t=210;"doubleButton"===i.buttonVersion&&(t=250);const n=o.createFrame("游戏信息",e.H5_WIDTH,t);n.fills=[];const r=new a(n,i);return yield r.build(),n})}class a{constructor(t,e){this.frame=t,this.config=e}build(){return t(this,void 0,void 0,function*(){"imageButton"===this.config.buttonVersion&&(yield this.addGameIcon(),yield this.addGameInfo()),yield this.addButtons()})}addGameIcon(){return t(this,void 0,void 0,function*(){if(!this.config.gameIcon)return;const t=yield n.insertImage(this.config.gameIcon,"游戏图标",190,190);t&&(t.resize(190,190),"cornerRadius"in t&&(t.cornerRadius=40),"strokes"in t&&(t.strokes=[{type:"SOLID",color:{r:1,g:1,b:1},opacity:.2}]),"strokeWeight"in t&&(t.strokeWeight=1),t.x=70,t.y=(this.frame.height-190)/2,o.safeAppendChild(this.frame,t,"游戏图标添加"))})}addGameInfo(){return t(this,void 0,void 0,function*(){const t=this.config.gameTextColor?r.hexToRgb(this.config.gameTextColor):{r:1,g:1,b:1};if(this.config.gameName){const e=yield o.createText(this.config.gameName,48,"Medium");e.x=285,e.y=49,e.textAlignHorizontal="LEFT",e.fills=[r.createSolidFill(t)],o.safeAppendChild(this.frame,e,"游戏名称文本添加")}if(this.config.gameDesc){const e=yield o.createText(this.config.gameDesc,32,"Regular");e.x=285,e.y=122,e.resize(300,e.height),e.textAutoResize="HEIGHT",e.textAlignHorizontal="LEFT",e.fills=[r.createSolidFill(t)],o.safeAppendChild(this.frame,e,"游戏描述文本添加")}})}addButtons(){return t(this,void 0,void 0,function*(){switch(this.config.buttonVersion){case"imageButton":yield this.addIconButton();break;case"singleButton":yield this.addSingleButton();break;case"doubleButton":yield this.addDoubleButtons()}})}addIconButton(){return t(this,void 0,void 0,function*(){if(!this.config.iconButtonBg)return;const t=o.createFrame("下载按钮",344,103);if(t.x=666,t.y=(this.frame.height-103)/2,t.fills=[],this.config.iconButtonBg)try{const e=yield n.insertImage(this.config.iconButtonBg,"按钮底图",344,103);e?(e.x=0,e.y=0,o.safeAppendChild(t,e,"图标按钮底图添加")):(t.fills=[r.createSolidFill({r:0,g:.44,b:.89})],t.cornerRadius=30)}catch(e){console.error("按钮底图创建失败:",e),t.fills=[r.createSolidFill({r:0,g:.44,b:.89})],t.cornerRadius=30}else t.fills=[r.createSolidFill({r:0,g:.44,b:.89})],t.cornerRadius=30;const e=this.config.iconButtonText||"立即下载";{const i=this.config.iconButtonTextColor?r.hexToRgb(this.config.iconButtonTextColor):{r:1,g:1,b:1};try{const n=yield o.createText(e,36,"Bold");n.fills=[r.createSolidFill(i)],n.resize(t.width,n.height),n.textAlignHorizontal="CENTER",n.y=(t.height-n.height)/2,o.safeAppendChild(t,n,"图标按钮文本添加")}catch(t){console.error("创建按钮文本失败:",t)}}o.safeAppendChild(this.frame,t,"图标按钮框架添加")})}addSingleButton(){return t(this,void 0,void 0,function*(){if(!this.config.singleButtonBg)return;const t=o.createFrame("单按钮",600,80);t.x=(e.H5_WIDTH-600)/2,t.y=(this.frame.height-80)/2,t.cornerRadius=40;try{yield n.setImageFill(t,this.config.singleButtonBg)}catch(t){return void console.error("单按钮底图设置失败:",t)}const i=this.config.singleButtonText||"立即下载";{const e=this.config.singleButtonTextColor?r.hexToRgb(this.config.singleButtonTextColor):{r:1,g:1,b:1};try{const n=yield o.createText(i,32,"Bold");n.fills=[r.createSolidFill(e)],n.resize(t.width,n.height),n.textAlignHorizontal="CENTER",n.y=(t.height-n.height)/2,o.safeAppendChild(t,n,"单按钮文本添加")}catch(t){console.error("创建单按钮文本失败:",t)}}o.safeAppendChild(this.frame,t,"单按钮框架添加")})}addDoubleButtons(){return t(this,void 0,void 0,function*(){const t=this.config.leftButtonBg,i=this.config.rightButtonBg;if(!t&&!i)return;const n=this.config.buttonSpacing||10,r=(800-n)/2,s=(e.H5_WIDTH-800)/2,l=(this.frame.height-80)/2;if(t)try{const t=yield this.createButton("左侧按钮",this.config.leftButtonText||"左侧按钮",this.config.leftButtonTextColor,this.config.leftButtonBg,r,80);t&&(t.x=s,t.y=l,o.safeAppendChild(this.frame,t,"左侧按钮添加"))}catch(t){console.error("创建左侧按钮失败:",t)}if(i)try{const t=yield this.createButton("右侧按钮",this.config.rightButtonText||"右侧按钮",this.config.rightButtonTextColor,this.config.rightButtonBg,r,80);t&&(t.x=s+r+n,t.y=l,o.safeAppendChild(this.frame,t,"右侧按钮添加"))}catch(t){console.error("创建右侧按钮失败:",t)}})}createButton(e,i,s,l,c,a){return t(this,void 0,void 0,function*(){if(!l)return null;const t=o.createFrame(e,c,a);t.cornerRadius=a/2;try{yield n.setImageFill(t,l)}catch(t){return console.error(`${e}底图设置失败:`,t),null}if(i)try{const n=s?r.hexToRgb(s):{r:1,g:1,b:1},l=yield o.createText(i,24,"Bold");l.fills=[r.createSolidFill(n)],l.resize(c,l.height),l.textAlignHorizontal="CENTER",l.y=(a-l.height)/2,o.safeAppendChild(t,l,`${e}按钮文本添加`)}catch(t){console.error(`创建${e}文本失败:`,t)}return t})}}function d(e){return t(this,void 0,void 0,function*(){return(new h).createModule(e)})}class h{createModule(e){return t(this,void 0,void 0,function*(){try{let t;const o=(e.type,e.type);switch(console.log("🏭 [模块工厂] 开始创建模块:",{"模块ID":e.id,"模块类型":o,"模块标题":e.title,"内容键":Object.keys(e.content||{})}),o){case"activityContent":case i.ACTIVITY_CONTENT:t=yield this.createActivityContentModule(e.content);break;case"signIn":case i.SIGN_IN:t=yield this.createSignInModule(e.content);break;case"collectCards":case i.COLLECT_CARDS:t=yield this.createCollectCardsModule(e.content);break;case"nineGrid":case i.NINE_GRID:t=yield this.createNineGridModule(e.content);break;case"carousel":case i.CAROUSEL:t=yield this.createCarouselModule(e.content);break;default:return console.warn(`未知的模块类型: ${o}`),this.createErrorModule(e,`未知的模块类型: ${o}`)}return t.name=e.title||`${o}模块`,console.log("✅ [模块工厂] 模块创建成功:",{"模块名称":t.name,"模块大小":`${t.width}x${t.height}`}),t}catch(t){return console.error(`❌ [模块工厂] 创建模块失败: ${e.type}`,t),this.createErrorModule(e,t)}})}createActivityContentModule(i){return t(this,void 0,void 0,function*(){console.log("🎭 [活动内容模块] 开始创建:",{"主标题":i.mainTitle,"副标题":i.subTitle,"正文内容":i.text,"主标题背景":!!i.mainTitleBg,"副标题背景":!!i.subTitleBg,"插图":!!i.image});const t=o.createFrame("活动内容模块",e.H5_WIDTH,1e3);t.fills=[];try{const e=new C(t,i);return yield e.build(),console.log("✅ [活动内容模块] 创建完成，最终高度：",t.height),t}catch(e){console.error("❌ [活动内容模块] 创建失败：",e);const i=yield o.createText(`活动内容模块创建失败: ${e instanceof Error?e.message:"未知错误"}`,16);return i.x=20,i.y=20,i.fills=[r.createSolidFill({r:1,g:0,b:0})],o.safeAppendChild(t,i,"活动内容模块错误文本添加"),t.resize(1080,100),t}})}createSignInModule(i){return t(this,void 0,void 0,function*(){const t=o.createFrame("签到模块",e.H5_WIDTH,460),n=new T(t,i);return yield n.build(),t})}createCollectCardsModule(i){return t(this,void 0,void 0,function*(){const t=o.createFrame("集卡模块",e.H5_WIDTH,300),n=new p(t,i);return yield n.build(),t})}createNineGridModule(e){return t(this,void 0,void 0,function*(){return new m(e).build()})}createCarouselModule(i){return t(this,void 0,void 0,function*(){const t=o.createFrame("轮播模块",e.H5_WIDTH,800),n=new I(t,i);return yield n.build(),t})}createErrorModule(i,n){return t(this,void 0,void 0,function*(){const t=o.createFrame(`错误模块-${i.type}`,e.H5_WIDTH,100);t.fills=[r.createSolidFill({r:1,g:.9,b:.9})];const s=yield o.createText(`模块创建失败: ${i.type}\n${n}`,14,"Regular");return s.x=20,s.y=20,o.safeAppendChild(t,s,"错误信息添加"),t})}}function u(e){return t(this,void 0,void 0,function*(){console.log("开始创建活动规则模块，内容：",{rulesTitle:e.rulesTitle,rulesBgImage:!!e.rulesBgImage,rulesContent:e.rulesContent});const t=o.createFrame("活动规则",1080,1e3);t.fills=[];try{const i={rulesTitle:e.rulesTitle||"",rulesBgImage:e.rulesBgImage,rulesContent:e.rulesContent||""},o=new g(t,i);return yield o.build(),console.log("活动规则模块创建完成，最终高度：",t.height),t}catch(e){console.error("活动规则模块创建失败：",e);const i=yield o.createText(`活动规则模块创建失败: ${e instanceof Error?e.message:"未知错误"}`,16);return i.x=20,i.y=20,i.fills=[r.createSolidFill({r:1,g:0,b:0})],o.safeAppendChild(t,i,"活动规则模块错误文本添加"),t.resize(1080,100),t}})}class g{constructor(t,e){this.currentY=0,this.frame=t,this.content=e}build(){return t(this,void 0,void 0,function*(){console.log("开始构建活动规则模块");try{const t=this.content.rulesTitle&&""!==this.content.rulesTitle.trim(),e=null!==this.content.rulesBgImage&&void 0!==this.content.rulesBgImage,i=this.content.rulesContent&&""!==this.content.rulesContent.trim();if(!t&&!e&&!i)return console.log("活动规则模块：没有任何内容需要构建，跳过"),void this.frame.resize(1080,0);(t||e)&&(console.log("添加活动规则标题..."),yield this.addTitle()),i&&(console.log("添加活动规则内容..."),yield this.addRulesContent()),console.log("调整模块高度..."),this.adjustFrameHeight(),console.log("活动规则模块构建完成")}catch(t){throw console.error("活动规则模块构建过程中出错：",t),t}})}addTitle(){return t(this,void 0,void 0,function*(){const t=this.content.rulesTitle&&""!==this.content.rulesTitle.trim(),e=null!==this.content.rulesBgImage&&void 0!==this.content.rulesBgImage;if(!t&&!e)return;this.currentY+=90;const i=t?this.content.rulesTitle:"",n=yield s(i,this.content.rulesBgImage,1080,120,48,"Bold");n.x=0,n.y=this.currentY,o.safeAppendChild(this.frame,n,"活动规则标题容器添加"),this.currentY+=120})}addRulesContent(){return t(this,void 0,void 0,function*(){if(!this.content.rulesContent)return;console.log("添加规则内容..."),this.currentY+=90;const t=yield o.createText(this.content.rulesContent,28,"Regular");t.fills=[r.createSolidFill({r:0,g:0,b:0})],t.lineHeight={unit:"AUTO"},t.resize(950,t.height),t.textAlignHorizontal="LEFT",t.x=65,t.y=this.currentY,o.safeAppendChild(this.frame,t,"活动规则内容文本添加"),this.currentY+=t.height})}adjustFrameHeight(){this.currentY+=90,this.frame.resize(1080,this.currentY)}}function f(i){return t(this,void 0,void 0,function*(){if(!i.footerLogo&&!i.footerBg)return console.log("跳过尾版模块创建：没有LOGO图片和尾版背景图片"),null;const t=o.createFrame("尾版",e.H5_WIDTH,480),n=new y(t,i);return yield n.build(),t})}class y{constructor(t,e){this.frame=t,this.config=e}build(){return t(this,void 0,void 0,function*(){yield this.setupBackground(),yield this.addContent()})}setupBackground(){return t(this,void 0,void 0,function*(){this.config.footerBg?yield n.setImageFill(this.frame,this.config.footerBg):this.frame.fills=[]})}addContent(){return t(this,void 0,void 0,function*(){this.config.footerLogo&&(yield this.addLogo())})}addLogo(){return t(this,void 0,void 0,function*(){if(this.config.footerLogo){console.log("开始创建Logo，使用ImageNodeBuilder");try{const t=yield n.insertImage(this.config.footerLogo,"LOGO");if(!t)return void console.log("Logo图片节点创建失败");const i=t.width,r=t.height,s=i/r;let l,c;console.log(`Logo原始尺寸: ${i}x${r}, 宽高比: ${s.toFixed(2)}`),l=340,c=l/s,c>250&&(c=250,l=c*s),t.resize(l,c),t.x=(e.H5_WIDTH-l)/2,t.y=(this.frame.height-c)/2,"constraints"in t&&(t.constraints={horizontal:"SCALE",vertical:"SCALE"}),o.safeAppendChild(this.frame,t,"尾版Logo图片添加"),console.log(`Logo创建成功: 最终尺寸=${l.toFixed(1)}x${c.toFixed(1)}, 位置=(${t.x.toFixed(1)}, ${t.y.toFixed(1)})`)}catch(t){console.error("Logo创建失败:",t)}}else console.log("跳过Logo创建：没有上传Logo图片")})}}class m{constructor(t){this.CELL_SIZE=270,this.CELL_SPACING=24,this.currentY=0,this.content=t,this.frame=o.createFrame("九宫格抽奖",e.H5_WIDTH,1e3),this.frame.fills=[]}build(){return t(this,void 0,void 0,function*(){try{return yield this.addTitle(),yield this.addNineGrid(),this.adjustFrameHeight(),this.frame}catch(t){throw console.error("九宫格模块构建过程中出错：",t),t}})}addTitle(){return t(this,void 0,void 0,function*(){if(!this.content.mainTitle)return;const t=o.createFrame("九宫格标题",e.H5_WIDTH,120);if(t.x=0,t.y=this.currentY+90,t.fills=[],this.content.titleBgImage)try{const i=yield n.insertImage(this.content.titleBgImage,"标题背景图片",e.H5_WIDTH,120);i&&(i.x=0,i.y=0,o.safeAppendChild(t,i,"标题背景图片添加"))}catch(t){console.error("标题背景图片创建失败:",t)}const i=yield o.createText(this.content.mainTitle,48,"Bold");i.fills=[r.createSolidFill({r:1,g:1,b:1})],i.resize(e.H5_WIDTH,i.height),i.textAlignHorizontal="CENTER",i.x=0,i.y=(120-i.height)/2,o.safeAppendChild(t,i,"标题文本添加"),o.safeAppendChild(this.frame,t,"标题容器添加"),this.currentY+=120})}addNineGrid(){return t(this,void 0,void 0,function*(){const t=3*this.CELL_SIZE+4*this.CELL_SPACING+180,i=o.createFrame("九宫格主体",e.H5_WIDTH,t);if(i.x=0,i.y=this.currentY+90,i.fills=[],this.content.gridBgImage)try{const r=yield n.insertImage(this.content.gridBgImage,"九宫格背景",930,930);r&&(r.x=(e.H5_WIDTH-930)/2,r.y=(t-930)/2,o.safeAppendChild(i,r,"九宫格背景图片添加"))}catch(t){console.error("九宫格背景图片创建失败:",t)}for(let t=0;t<3;t++)for(let e=0;e<3;e++){const n=3*t+e,r=yield this.createGridCell(t,e,n);o.safeAppendChild(i,r,`九宫格单元格${n+1}添加`)}o.safeAppendChild(this.frame,i,"九宫格容器添加"),this.currentY+=t})}createGridCell(i,o,n){return t(this,void 0,void 0,function*(){const t=3*this.CELL_SIZE+2*this.CELL_SPACING,r=(e.H5_WIDTH-t)/2+o*(this.CELL_SIZE+this.CELL_SPACING),s=90+this.CELL_SPACING+i*(this.CELL_SIZE+this.CELL_SPACING);return 4===n?this.createDrawButton(r,s):this.createPrizeCell(r,s,n)})}createDrawButton(e,i){return t(this,void 0,void 0,function*(){const t=o.createFrame("抽奖按钮容器",this.CELL_SIZE,this.CELL_SIZE);t.x=e,t.y=i,t.fills=[];try{if(this.content.drawButtonImage)try{const e=yield n.insertImage(this.content.drawButtonImage,"抽奖按钮图片",this.CELL_SIZE,this.CELL_SIZE);e?(e.x=0,e.y=0,o.safeAppendChild(t,e,"抽奖按钮图片添加")):(console.warn("抽奖按钮图片插入失败，使用默认样式"),yield this.addDefaultButtonStyle(t))}catch(e){console.error("抽奖按钮图片创建失败：",e),yield this.addDefaultButtonStyle(t)}else yield this.addDefaultButtonStyle(t)}catch(e){console.error("创建抽奖按钮失败：",e),yield this.addDefaultButtonStyle(t)}return t})}addDefaultButtonStyle(e){return t(this,void 0,void 0,function*(){e.fills=[r.createSolidFill({r:1,g:.3,b:.3})],e.cornerRadius=10;const t=yield o.createText("抽奖",24,"Bold");t.fills=[r.createSolidFill({r:1,g:1,b:1})],t.resize(this.CELL_SIZE,t.height),t.textAlignHorizontal="CENTER",t.y=(this.CELL_SIZE-t.height)/2,o.safeAppendChild(e,t,"抽奖按钮默认文本添加")})}createPrizeCell(e,i,s){return t(this,void 0,void 0,function*(){var t;const l=this.getPrizeIndex(Math.floor(s/3),s%3),c=null===(t=this.content.prizes)||void 0===t?void 0:t[l],a=(l+1).toString(),d=a.length<2?"0"+a:a,h=(null==c?void 0:c.name)||`奖品${d}`,u=o.createFrame(h,this.CELL_SIZE,this.CELL_SIZE);u.x=e,u.y=i,u.fills=[];try{if(this.content.prizeBgImage)try{const t=yield n.insertImage(this.content.prizeBgImage,"奖品背景图片",this.CELL_SIZE,this.CELL_SIZE);t&&(t.x=0,t.y=0,o.safeAppendChild(u,t,"奖品背景图片添加"))}catch(t){console.error("奖品背景图片创建失败:",t)}if(null==c?void 0:c.image)try{const t=yield n.insertImage(c.image,"奖品图片",180,180);t&&(t.x=45,t.y=11,o.safeAppendChild(u,t,"奖品图片添加"))}catch(t){console.error("奖品图片创建失败:",t);const e=o.createFrame("占位符",180,180);e.x=45,e.y=11,e.fills=[r.createSolidFill({r:.9,g:.9,b:.9})],e.cornerRadius=10,o.safeAppendChild(u,e,"奖品占位符添加")}else{const t=o.createFrame("占位符",180,180);t.x=45,t.y=11,t.fills=[r.createSolidFill({r:.9,g:.9,b:.9})],t.cornerRadius=10,o.safeAppendChild(u,t,"奖品默认占位符添加")}const t=(null==c?void 0:c.name)||h;if(t){const e=yield o.createText(t,26,"Medium");e.resize(this.CELL_SIZE,e.height),e.textAlignHorizontal="CENTER",e.x=0,e.y=190,e.fills=[r.createSolidFill({r:0,g:0,b:0})],o.safeAppendChild(u,e,"奖品名称文本添加")}}catch(t){console.error(`创建奖品格子失败 ${l}:`,t)}return u})}getPrizeIndex(t,e){const i=3*t+e;return i<4?i:i-1}adjustFrameHeight(){this.frame.resize(e.H5_WIDTH,this.currentY+90)}}class I{constructor(t,e){this.TITLE_HEIGHT=120,this.CAROUSEL_AREA_HEIGHT=607,this.CAROUSEL_BG_WIDTH=1e3,this.CAROUSEL_BG_HEIGHT=540,this.CAROUSEL_IMAGE_WIDTH=960,this.CAROUSEL_IMAGE_HEIGHT=500,this.BUTTON_HEIGHT=20,this.frame=t,this.content=e}build(){return t(this,void 0,void 0,function*(){console.log("开始构建图片轮播（横版）模块 - 按Figma设计实现");try{this.setupFrameLayout(),yield this.addTitleContainer(),yield this.addCarouselPreview(),console.log("图片轮播（横版）模块构建完成")}catch(t){throw console.error("图片轮播（横版）模块构建过程中出错：",t),t}})}setupFrameLayout(){o.setupAutoLayout(this.frame,"VERTICAL",30,90)}addTitleContainer(){return t(this,void 0,void 0,function*(){if(!this.content.title&&!this.content.titleBgImage)return;console.log("添加标题容器 - 1080x120px");const t=o.createFrame("标题容器",1080,this.TITLE_HEIGHT);if(t.fills=[],this.content.titleBgImage)try{const e=yield n.insertImage(this.content.titleBgImage,"标题背景图片",1080,120);e&&(e.x=0,e.y=0,o.safeAppendChild(t,e,"标题背景图片添加"))}catch(t){console.error("标题背景图片创建失败:",t)}if(this.content.title){const e=yield o.createText(this.content.title,48,"Bold");e.fills=[r.createSolidFill({r:1,g:1,b:1})],e.resize(1080,e.height),e.textAlignHorizontal="CENTER",e.x=0,e.y=(120-e.height)/2,o.safeAppendChild(t,e,"标题文本添加")}o.safeAppendChild(this.frame,t,"标题容器添加")})}addCarouselPreview(){return t(this,void 0,void 0,function*(){console.log("添加轮播预览区域");const t=o.createFrame("轮播图预览",1080,this.CAROUSEL_AREA_HEIGHT);t.fills=[],o.setupAutoLayout(t,"VERTICAL",0,0),yield this.addCarouselArea(t),yield this.addCarouselButtons(t),o.safeAppendChild(this.frame,t,"轮播预览区域添加")})}addCarouselArea(e){return t(this,void 0,void 0,function*(){console.log("添加轮播区域 - 1080x607px");const t=o.createFrame("轮播区域",1080,this.CAROUSEL_AREA_HEIGHT);t.fills=[];const i=o.createFrame("轮播图背景",this.CAROUSEL_BG_WIDTH,this.CAROUSEL_BG_HEIGHT);if(this.content.carouselBgImage)try{const t=yield n.insertImage(this.content.carouselBgImage,"轮播图背景图片",this.CAROUSEL_BG_WIDTH,this.CAROUSEL_BG_HEIGHT);t&&(t.x=0,t.y=0,o.safeAppendChild(i,t,"轮播图背景图片添加"))}catch(t){console.error("轮播图背景图片创建失败:",t),i.fills=[r.createSolidFill({r:1,g:1,b:1})]}else i.fills=[r.createSolidFill({r:1,g:1,b:1})];if(i.x=(1080-this.CAROUSEL_BG_WIDTH)/2,i.y=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_BG_HEIGHT)/2+.5,o.safeAppendChild(t,i,"轮播图背景添加"),this.content.carouselImage)try{const e=yield n.insertImage(this.content.carouselImage,"轮播图",this.CAROUSEL_IMAGE_WIDTH,this.CAROUSEL_IMAGE_HEIGHT);e&&(e.x=(1080-this.CAROUSEL_IMAGE_WIDTH)/2,e.y=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_IMAGE_HEIGHT)/2+.5,o.safeAppendChild(t,e,"轮播图添加"))}catch(e){console.error("轮播图创建失败:",e);const i=figma.createRectangle();i.name="轮播图",i.resize(this.CAROUSEL_IMAGE_WIDTH,this.CAROUSEL_IMAGE_HEIGHT),i.fills=[r.createSolidFill({r:1,g:.3,b:.3})],i.x=(1080-this.CAROUSEL_IMAGE_WIDTH)/2,i.y=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_IMAGE_HEIGHT)/2+.5,o.safeAppendChild(t,i,"轮播图占位添加")}o.safeAppendChild(e,t,"轮播区域添加")})}addCarouselButtons(e){return t(this,void 0,void 0,function*(){console.log("添加轮播按钮");const t=o.createFrame("轮播按钮",300,this.BUTTON_HEIGHT);t.fills=[],o.setupAutoLayout(t,"HORIZONTAL",24,0);const i=figma.createEllipse();i.name="活跃按钮",i.resize(60,this.BUTTON_HEIGHT),i.fills=[r.createSolidFill({r:1,g:1,b:1})],o.safeAppendChild(t,i,"活跃按钮添加");for(let e=1;e<5;e++){const i=figma.createEllipse();i.name=`按钮${e+1}`,i.resize(this.BUTTON_HEIGHT,this.BUTTON_HEIGHT),i.fills=[],i.strokes=[r.createSolidFill({r:1,g:1,b:1})],i.strokeWeight=2,o.safeAppendChild(t,i,`按钮${e+1}添加`)}t.x=(1080-t.width)/2,o.safeAppendChild(e,t,"轮播按钮容器添加")})}}class C{constructor(t,e){this.frame=t,this.content=e}build(){return t(this,void 0,void 0,function*(){console.log("开始构建活动内容模块（非页面底部规则模块）");try{this.setupAutoLayout(),yield this.addMainTitle(),yield this.addSubTitle(),yield this.addTextContent(),yield this.addImage(),this.adjustFrameHeight(),console.log("活动内容模块（非规则）构建完成")}catch(t){throw console.error("活动内容模块（非规则）构建过程中出错：",t),t}})}setupAutoLayout(){o.setupAutoLayout(this.frame,"VERTICAL",60,90)}addMainTitle(){return t(this,void 0,void 0,function*(){if(!this.content.mainTitleBg||!this.content.mainTitle)return;console.log("添加大标题...");const t=o.createFrame("活动内容大标题容器",1080,120);t.fills=[];try{const e=yield n.insertImage(this.content.mainTitleBg,"大标题背景图片",1080,120);e&&(e.x=0,e.y=0,o.safeAppendChild(t,e,"活动内容标题背景图片添加"))}catch(t){console.error("大标题背景图片创建失败:",t)}const i=yield o.createText(this.content.mainTitle,48,"Bold");i.fills=[r.createSolidFill({r:1,g:1,b:1})],i.resize(e.H5_WIDTH,i.height),i.textAlignHorizontal="CENTER",i.x=0,i.y=(120-i.height)/2,o.safeAppendChild(t,i,"活动内容标题文本添加"),o.safeAppendChild(this.frame,t,"活动内容标题容器添加")})}addSubTitle(){return t(this,void 0,void 0,function*(){if(!this.content.subTitleBg||!this.content.subTitle)return;console.log("添加小标题...");const t=o.createFrame("活动内容小标题容器",1080,100);t.fills=[];try{const e=yield n.insertImage(this.content.subTitleBg,"小标题背景图片",1080,100);e&&(e.x=0,e.y=0,o.safeAppendChild(t,e,"小标题背景图片添加"))}catch(t){console.error("小标题背景图片创建失败:",t)}const i=yield o.createText(this.content.subTitle,44,"Medium");i.fills=[r.createSolidFill({r:1,g:1,b:1})],i.resize(e.H5_WIDTH,i.height),i.textAlignHorizontal="CENTER",i.x=0,i.y=(100-i.height)/2,o.safeAppendChild(t,i,"小标题文本添加"),o.safeAppendChild(this.frame,t,"小标题容器添加")})}addTextContent(){return t(this,void 0,void 0,function*(){if(!this.content.text)return;console.log("添加正文...");const t=yield o.createText(this.content.text,40,"Regular");t.resize(950,t.height),t.textAlignHorizontal="CENTER",t.lineHeight={unit:"AUTO"},t.fills=[r.createSolidFill({r:1,g:1,b:1})],o.safeAppendChild(this.frame,t,"活动内容正文添加")})}addImage(){return t(this,void 0,void 0,function*(){if(this.content.image){console.log("添加插图...");try{const t=yield n.insertImage(this.content.image,"活动内容插图",950,600);t&&o.safeAppendChild(this.frame,t,"活动内容插图添加")}catch(t){console.error("插图创建失败:",t)}}})}adjustFrameHeight(){}}class T{constructor(t,e){this.frame=t,this.content=e}build(){return t(this,void 0,void 0,function*(){yield this.setupBackground(),yield this.addTitle(),yield this.addSignInDays(),yield this.addSignInButton()})}setupBackground(){return t(this,void 0,void 0,function*(){this.content.bgImage?yield n.setImageFill(this.frame,this.content.bgImage):this.frame.fills=[r.createSolidFill({r:.95,g:.95,b:1})]})}addTitle(){return t(this,void 0,void 0,function*(){const t=o.createFrame("签到标题",500,100);t.x=(e.H5_WIDTH-500)/2,t.y=20,this.content.titleImage?yield n.setImageFill(t,this.content.titleImage,"FIT"):yield this.addDefaultTitle(t),o.safeAppendChild(this.frame,t,"签到标题添加")})}addDefaultTitle(e){return t(this,void 0,void 0,function*(){e.fills=[r.createSolidFill({r:.9,g:.5,b:.3})];const t=yield o.createText("每日签到",28,"Bold");t.fills=[r.createSolidFill({r:1,g:1,b:1})],t.resize(500,t.height),t.textAlignHorizontal="CENTER",t.y=(100-t.height)/2,o.safeAppendChild(e,t,"签到默认标题文本添加")})}addSignInDays(){return t(this,void 0,void 0,function*(){const t=o.createFrame("签到日期容器",e.H5_WIDTH-40,240);t.x=20,t.y=140,t.fills=[r.createSolidFill({r:1,g:1,b:1},.8)],t.cornerRadius=10,o.setupAutoLayout(t,"HORIZONTAL",10,10);const i=this.content.daysCount||7;for(let e=0;e<i;e++){const i=yield this.createDayItem(e+1);o.safeAppendChild(t,i,`签到第${e+1}天添加`)}o.safeAppendChild(this.frame,t,"签到日期容器添加")})}createDayItem(e){return t(this,void 0,void 0,function*(){const t=o.createFrame(`第${e}天`,80,220);t.fills=[r.createSolidFill({r:.95,g:.95,b:.95})],t.cornerRadius=5,o.setupAutoLayout(t,"VERTICAL",10,10);const i=yield this.createDayIcon();o.safeAppendChild(t,i,"签到日期图标添加");const n=yield o.createText(`第${e}天`,16,"Medium");n.resize(80,n.height),n.textAlignHorizontal="CENTER",o.safeAppendChild(t,n,"签到日期文本添加");const s=yield o.createText("金币 x 100",14);return s.fills=[r.createSolidFill({r:.5,g:.5,b:.5})],s.resize(80,s.height),s.textAlignHorizontal="CENTER",o.safeAppendChild(t,s,"签到奖励描述添加"),t})}createDayIcon(){return t(this,void 0,void 0,function*(){const t=o.createFrame("日期图标",60,60);return this.content.dayIcon?yield n.setImageFill(t,this.content.dayIcon,"FILL"):(t.fills=[r.createSolidFill({r:1,g:.8,b:.2})],t.cornerRadius=30),t})}addSignInButton(){return t(this,void 0,void 0,function*(){const t=o.createFrame("签到按钮",200,60);t.x=(e.H5_WIDTH-200)/2,t.y=400,this.content.signButton?yield n.setImageFill(t,this.content.signButton,"FIT"):yield this.addDefaultButton(t),o.safeAppendChild(this.frame,t,"签到按钮框架添加")})}addDefaultButton(e){return t(this,void 0,void 0,function*(){e.fills=[r.createSolidFill({r:1,g:.4,b:.3})],e.cornerRadius=30;const t=yield o.createText("立即签到",18,"Bold");t.fills=[r.createSolidFill({r:1,g:1,b:1})],t.resize(200,t.height),t.textAlignHorizontal="CENTER",t.y=(60-t.height)/2,o.safeAppendChild(e,t,"签到默认按钮文本添加")})}}class p{constructor(t,e){this.frame=t,this.content=e}build(){return t(this,void 0,void 0,function*(){this.content.bgImage?yield n.setImageFill(this.frame,this.content.bgImage):this.frame.fills=[r.createSolidFill({r:.95,g:.9,b:1})];let t=20;if(this.content.titleImage){const i=o.createFrame("集卡标题",400,80);i.x=(e.H5_WIDTH-400)/2,i.y=t,yield n.setImageFill(i,this.content.titleImage,"FIT"),o.safeAppendChild(this.frame,i,"集卡标题添加"),t+=100}const i=o.createFrame("卡片容器",e.H5_WIDTH-40,200);i.x=20,i.y=t,i.fills=[r.createSolidFill({r:1,g:1,b:1},.9)],i.cornerRadius=10,o.setupAutoLayout(i,"HORIZONTAL",10,10);const s=this.content.cardsCount||5;for(let t=0;t<s;t++){const e=yield this.createCardItem(t+1);o.safeAppendChild(i,e,`集卡卡片${t+1}添加`)}if(o.safeAppendChild(this.frame,i,"集卡卡片容器添加"),t+=220,this.content.combineButton){const i=o.createFrame("合成按钮",200,60);i.x=(e.H5_WIDTH-200)/2,i.y=t,yield n.setImageFill(i,this.content.combineButton,"FIT"),o.safeAppendChild(this.frame,i,"合成按钮添加"),t+=80}this.frame.resize(e.H5_WIDTH,t)})}createCardItem(e){return t(this,void 0,void 0,function*(){const t=100,i=o.createFrame(`卡片${e}`,t,130);switch(this.content.cardBg?yield n.setImageFill(i,this.content.cardBg,"FILL"):i.fills=[r.createSolidFill({r:.9,g:.9,b:.9})],this.content.cardStyle){case"style1":i.cornerRadius=0;break;case"style2":i.cornerRadius=10;break;case"style3":i.cornerRadius=50;break;default:i.cornerRadius=5}const s=yield o.createText(`${e}`,16,"Bold");return s.resize(t,s.height),s.textAlignHorizontal="CENTER",s.y=105,o.safeAppendChild(i,s,"集卡卡片编号添加"),i})}}export{C as ActivityContentBuilder,I as CarouselModuleBuilder,p as CollectCardsModuleBuilder,m as NineGridModuleBuilder,T as SignInModuleBuilder,d as createCustomModule,f as createFooterModule,c as createGameInfoModule,l as createHeaderModule,u as createRulesModule};
//# sourceMappingURL=module-builders.js.map

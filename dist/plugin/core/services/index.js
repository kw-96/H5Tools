import{__awaiter as e}from"../../node_modules/tslib/tslib.es6.js";import"./theme.service.js";import"./config.service.js";import"./channel-image.service.js";class t{static isFigmaEnvironment(){return"undefined"!=typeof figma&&!!figma.clientStorage}static setItem(t,i){return e(this,void 0,void 0,function*(){this.isFigmaEnvironment()?yield figma.clientStorage.setAsync(t,i):localStorage.setItem(t,i)})}static getItem(t){return e(this,void 0,void 0,function*(){return this.isFigmaEnvironment()?(yield figma.clientStorage.getAsync(t))||null:localStorage.getItem(t)})}static removeItem(t){return e(this,void 0,void 0,function*(){this.isFigmaEnvironment()?yield figma.clientStorage.deleteAsync(t):localStorage.removeItem(t)})}static getAllKeys(){return e(this,void 0,void 0,function*(){if(this.isFigmaEnvironment()){const e=(yield figma.clientStorage.getAsync("__storage_keys__"))||"[]";return JSON.parse(e)}return Object.keys(localStorage)})}}class i{static saveConfig(i){return e(this,void 0,void 0,function*(){try{const e=JSON.stringify(i);yield t.setItem(this.STORAGE_KEY,e)}catch(e){throw console.error("保存配置失败:",e),new Error("保存配置失败")}})}static loadConfig(){return e(this,void 0,void 0,function*(){try{const e=yield t.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch(e){return console.error("加载配置失败:",e),null}})}static clearConfig(){return e(this,void 0,void 0,function*(){try{yield t.removeItem(this.STORAGE_KEY)}catch(e){console.error("清除配置失败:",e)}})}static validateConfig(e){var t,i,o,n,r,s;const a=[];switch((null===(t=e.pageTitle)||void 0===t?void 0:t.trim())||a.push("页面标题不能为空"),(null===(i=e.gameName)||void 0===i?void 0:i.trim())||a.push("游戏名称不能为空"),e.buttonVersion||a.push("请选择按钮版本"),e.buttonVersion){case"icon":(null===(o=e.iconButtonText)||void 0===o?void 0:o.trim())||a.push("带图标按钮文本不能为空");break;case"single":(null===(n=e.singleButtonText)||void 0===n?void 0:n.trim())||a.push("单按钮文本不能为空");break;case"double":(null===(r=e.leftButtonText)||void 0===r?void 0:r.trim())||a.push("左侧按钮文本不能为空"),(null===(s=e.rightButtonText)||void 0===s?void 0:s.trim())||a.push("右侧按钮文本不能为空")}return{isValid:0===a.length,errors:a}}static createDefaultConfig(){return{pageTitle:"活动页面",pageBgColor:"#ffffff",pageBgImage:null,headerImage:null,titleUpload:null,gameIcon:null,gameName:"游戏名称",gameDesc:"游戏描述",gameTextColor:"#333333",buttonVersion:"single",iconButtonText:"立即下载",iconButtonTextColor:"#ffffff",iconButtonBg:null,singleButtonText:"立即下载",singleButtonTextColor:"#ffffff",singleButtonBg:null,leftButtonText:"预约游戏",leftButtonTextColor:"#ffffff",leftButtonBg:null,rightButtonText:"立即下载",rightButtonTextColor:"#ffffff",rightButtonBg:null,buttonSpacing:20,modules:[],rulesTitle:"活动规则",rulesBgImage:null,rulesContent:"请填写活动规则内容",footerLogo:null,footerBg:null,canvasWidth:1080,canvasHeight:1920}}}i.STORAGE_KEY="h5-tools-config";class o{static saveTheme(i){return e(this,void 0,void 0,function*(){if(!this.isValidTheme(i))throw new Error("无效的主题类型");try{yield t.setItem(this.THEME_KEY,i)}catch(e){console.error("保存主题失败:",e)}})}static loadTheme(){return e(this,void 0,void 0,function*(){try{const e=yield t.getItem(this.THEME_KEY);return this.isValidTheme(e)?e:"auto"}catch(e){return console.error("加载主题失败:",e),"auto"}})}static detectSystemTheme(){return"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}static getCurrentTheme(){return e(this,void 0,void 0,function*(){const e=yield this.loadTheme();return"auto"===e?this.detectSystemTheme():e})}static isValidTheme(e){return null!==e&&-1!==this.THEMES.indexOf(e)}}o.THEME_KEY="h5-tools-theme",o.THEMES=["light","dark","auto"];class n{static initialize(){return e(this,void 0,void 0,function*(){yield Promise.all([this.config.loadConfig(),this.theme.getInstance(),this.channelImage.clearExpiredChannelImages()])})}static getSystemStatus(){return e(this,void 0,void 0,function*(){const[e,t,i]=yield Promise.all([this.config.loadConfig(),this.theme.getInstance(),this.channelImage.getStorageUsage()]);return{configLoaded:!!e,theme:yield t.getCurrentTheme(),storageUsage:i}})}}n.config={loadConfig:()=>e(void 0,void 0,void 0,function*(){const{ConfigService:e}=yield import("./config.service.js");return e.loadConfig()})},n.theme={getInstance:()=>e(void 0,void 0,void 0,function*(){const{ThemeService:e}=yield import("./theme.service.js");return e.getInstance()})},n.channelImage={clearExpiredChannelImages:()=>e(void 0,void 0,void 0,function*(){const{ChannelImageService:e}=yield import("./channel-image.service.js");return e.clearExpiredChannelImages()}),getStorageUsage:()=>e(void 0,void 0,void 0,function*(){const{ChannelImageService:e}=yield import("./channel-image.service.js");return e.getStorageUsage()})},n.validation={validateH5Config:t=>e(void 0,void 0,void 0,function*(){const{ValidationService:e}=yield import("./validation.service.js");return e.validateH5Config(t)})};export{i as ConfigService,n as ServiceManager,o as ThemeService};
//# sourceMappingURL=index.js.map

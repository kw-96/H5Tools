import{__awaiter as t}from"../../node_modules/tslib/tslib.es6.js";import{StorageService as e}from"./storage.service.js";class s{static saveChannelImage(e,s,i){return t(this,void 0,void 0,function*(){try{const t=yield this.loadAllChannelImages();t[e]||(t[e]={}),t[e][s]=Object.assign(Object.assign({},i),{timestamp:Date.now()});this.calculateStorageSize(t)>this.MAX_STORAGE_SIZE&&(yield this.clearExpiredChannelImages());const n=JSON.stringify(t);this.storage.setItem(this.STORAGE_KEY,n)}catch(t){throw console.error("保存渠道图片失败:",t),new Error("保存渠道图片失败")}})}static loadAllChannelImages(){return t(this,void 0,void 0,function*(){try{const t=this.storage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):{}}catch(t){return console.error("加载渠道图片失败:",t),{}}})}static loadChannelImages(e){return t(this,void 0,void 0,function*(){return(yield this.loadAllChannelImages())[e]||{}})}static deleteChannelImage(e,s){return t(this,void 0,void 0,function*(){try{const t=yield this.loadAllChannelImages();if(t[e]&&t[e][s]){delete t[e][s],0===Object.keys(t[e]).length&&delete t[e];const i=JSON.stringify(t);this.storage.setItem(this.STORAGE_KEY,i)}}catch(t){console.error("删除渠道图片失败:",t)}})}static clearAllChannelImages(){return t(this,void 0,void 0,function*(){try{this.storage.removeItem(this.STORAGE_KEY)}catch(t){console.error("清除所有渠道图片失败:",t)}})}static clearExpiredChannelImages(){return t(this,void 0,void 0,function*(){try{const t=yield this.loadAllChannelImages(),e=Date.now(),s=6048e5;let i=!1;for(const n in t){const r=t[n];for(const t in r){e-r[t].timestamp>s&&(delete r[t],i=!0)}0===Object.keys(r).length&&delete t[n]}if(i){const e=JSON.stringify(t);this.storage.setItem(this.STORAGE_KEY,e)}}catch(t){console.error("清除过期渠道图片失败:",t)}})}static calculateStorageSize(t){return new Blob([JSON.stringify(t)]).size}static getStorageUsage(){return t(this,void 0,void 0,function*(){try{const t=yield this.loadAllChannelImages(),e=this.calculateStorageSize(t),s=e/this.MAX_STORAGE_SIZE*100;return{used:e,max:this.MAX_STORAGE_SIZE,percentage:s}}catch(t){return console.error("获取存储使用情况失败:",t),{used:0,max:this.MAX_STORAGE_SIZE,percentage:0}}})}}s.STORAGE_KEY="h5-tools-channel-images",s.MAX_STORAGE_SIZE=52428800,s.storage=e.getInstance();export{s as ChannelImageService};
//# sourceMappingURL=channel-image.service.js.map

function e(e,t,i,o){return new(i||(i=Promise))(function(n,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function l(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,l)}a((o=o.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const t=1080;var i,o;!function(e){e.HEADER="header",e.GAME_INFO="gameInfo",e.FOOTER="footer",e.ACTIVITY_CONTENT="activityContent",e.SIGN_IN="signIn",e.COLLECT_CARDS="collectCards",e.NINE_GRID="nineGrid",e.CAROUSEL="carousel",e.VERTICAL_CAROUSEL="verticalCarousel",e.RULES="rules",e.CUSTOM="custom"}(i||(i={})),function(e){e.OPPO="oppo",e.VIVO="vivo",e.HUAWEI="huawei",e.XIAOMI="xiaomi"}(o||(o={}));class n{static delay(t){return e(this,void 0,void 0,function*(){return new Promise(e=>setTimeout(e,t))})}static extractUint8Array(e){return e?e instanceof Uint8Array?e:"object"==typeof e&&"data"in e?e.data:null:null}static hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:0,g:0,b:0}}static calculateSliceStrategy(e,t,i){const o=e*t,n=i*i;if(o<=n)return{needsSlicing:!1,slices:[]};const r=Math.ceil(Math.sqrt(o/n)),s=Math.ceil(e/r),l=Math.ceil(t/r),a=[];for(let i=0;i<r;i++)for(let o=0;o<r;o++){const n=o*s,r=i*l,c=Math.min(s,e-n),h=Math.min(l,t-r);c>0&&h>0&&a.push({x:n,y:r,width:c,height:h,row:i,col:o})}return{needsSlicing:!0,slices:a,totalWidth:e,totalHeight:t,sliceWidth:s,sliceHeight:l,rows:r,cols:r}}static getPrizePosition(e){return[{row:0,col:0},{row:0,col:1},{row:0,col:2},{row:1,col:2},{row:2,col:2},{row:2,col:1},{row:2,col:0},{row:1,col:0}][e]||{row:0,col:0}}static safeNumber(e,t=0){const i=Number(e);return isNaN(i)?t:i}static safeString(e,t=""){return null!=e?String(e):t}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static deepClone(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map(e=>n.deepClone(e));if("object"==typeof e){const t={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=n.deepClone(e[i]));return t}return e}}class r{static isValidImageType(e){return-1!==["image/png","image/jpeg","image/jpg","image/gif","image/webp"].indexOf(e.toLowerCase())}static getImageExtension(e){return{"image/png":"png","image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/webp":"webp"}[e.toLowerCase()]||"png"}static calculateScale(e,t,i,o,n="fit"){const r=i/e,s=o/t;let l;return l="fit"===n?Math.min(r,s):Math.max(r,s),{scale:l,width:e*l,height:t*l}}static isOversized(e,t,i=4096){return e>i||t>i}static calculateSliceStrategy(e,t,i=4096){const o={direction:"none",sliceWidth:e,sliceHeight:t,slicesCount:1,description:"",cols:1,rows:1,totalSlices:1},n=e>i,r=t>i;return n||r?(n&&!r?(o.direction="vertical",o.sliceWidth=Math.floor(.9*i),o.sliceHeight=t,o.cols=Math.ceil(e/o.sliceWidth),o.rows=1,o.slicesCount=o.cols,o.totalSlices=o.cols,o.description=`宽度超限，垂直切割为${o.slicesCount}片，每片${o.sliceWidth}×${t}`):!n&&r?(o.direction="horizontal",o.sliceWidth=e,o.sliceHeight=Math.floor(.9*i),o.cols=1,o.rows=Math.ceil(t/o.sliceHeight),o.slicesCount=o.rows,o.totalSlices=o.rows,o.description=`高度超限，水平切割为${o.slicesCount}片，每片${e}×${o.sliceHeight}`):(o.direction="both",o.sliceWidth=Math.floor(.9*i),o.sliceHeight=Math.floor(.9*i),o.cols=Math.ceil(e/o.sliceWidth),o.rows=Math.ceil(t/o.sliceHeight),o.slicesCount=o.cols*o.rows,o.totalSlices=o.cols*o.rows,o.description=`宽高都超限，网格切割为${o.cols}×${o.rows}=${o.slicesCount}片`),o):(o.description="图片尺寸正常，无需切割",o)}}class s{static loadAll(){return e(this,void 0,void 0,function*(){const t=this.fonts.map(t=>e(this,void 0,void 0,function*(){try{return yield figma.loadFontAsync(t),{success:!0,font:t}}catch(e){return{success:!1,font:t,error:e}}})),i=(yield Promise.all(t)).filter(e=>!e.success).map(e=>e.font);i.length>0&&console.warn("部分字体加载失败:",i)})}static loadSingle(t){return e(this,void 0,void 0,function*(){try{yield figma.loadFontAsync(t)}catch(e){console.warn(`字体加载失败: ${t.family} ${t.style}`,e)}})}static loadInterFonts(){return e(this,void 0,void 0,function*(){return this.loadAll()})}}s.fonts=[{family:"Inter",style:"Regular"},{family:"Inter",style:"Medium"},{family:"Inter",style:"Bold"}];class l{static hexToRgb(e){if(!e||"string"!=typeof e||""===e.trim())return console.warn("ColorUtils.hexToRgb: 无效的颜色值，使用默认白色",e),{r:1,g:1,b:1};const t=(4===e.length?"#"+e.slice(1).split("").map(e=>e+e).join(""):e).replace("#","");return/^[0-9A-Fa-f]{6}$/.test(t)?{r:parseInt(t.substring(0,2),16)/255,g:parseInt(t.substring(2,4),16)/255,b:parseInt(t.substring(4,6),16)/255}:(console.warn("ColorUtils.hexToRgb: 无效的十六进制颜色格式，使用默认白色",e),{r:1,g:1,b:1})}static createSolidFill(e,t=1){return{type:"SOLID",color:e,opacity:t}}}class a{static createFrame(e,t,i){const o=figma.createFrame();return o.name=e,o.resize(t,i),o}static createText(t,i){return e(this,arguments,void 0,function*(e,t,i="Regular"){const o=figma.createText(),n={family:"Inter",style:i};return yield s.loadSingle(n),o.characters=e,o.fontSize=t,o.fontName=n,o})}static setupAutoLayout(e,t="VERTICAL",i=0,o=0){e.layoutMode=t,e.primaryAxisSizingMode="AUTO",e.counterAxisSizingMode="FIXED",e.itemSpacing=i,e.paddingTop=o,e.paddingBottom=o,e.paddingLeft=o,e.paddingRight=o,e.primaryAxisAlignItems="MIN",e.counterAxisAlignItems="CENTER"}static safeAppendChild(e,t,i="节点添加"){try{return e?t?(e.appendChild(t),!0):(console.warn(`${i}: 子节点无效`),!1):(console.warn(`${i}: 父节点无效`),!1)}catch(e){return console.error(`${i}失败:`,e),!1}}static safeBatchAppendChildren(e,t,i="批量节点添加"){let o=0;return t.forEach((t,n)=>{t&&this.safeAppendChild(e,t,`${i}[${n}]`)&&o++}),o}static safeRemoveNode(e,t="节点移除"){try{return e?e.parent?(e.remove(),!0):(console.warn(`${t}: 节点没有父节点`),!1):(console.warn(`${t}: 节点无效`),!1)}catch(e){return console.error(`${t}失败:`,e),!1}}}class c{static createImage(t){return e(this,void 0,void 0,function*(){try{return figma.createImage(t)}catch(e){return console.error("图片创建失败:",e),null}})}static createLargeImage(t,i,o){return e(this,arguments,void 0,function*(e,t,i,o="大图片"){try{const n=figma.createRectangle();return n.name=o,n.resize(t,i),yield this.fillTheSelection(n,e),n}catch(e){return console.error("大图片创建失败:",e),null}})}static fillTheSelection(t,i){return e(this,void 0,void 0,function*(){try{const e=yield this.createImage(i);e?t.fills=[{type:"IMAGE",imageHash:e.hash,scaleMode:"FILL"}]:(t.fills=[l.createSolidFill({r:.9,g:.9,b:.9})],console.warn("图片过大，使用默认填充"))}catch(e){console.error("填充图片失败:",e),t.fills=[l.createSolidFill({r:.9,g:.9,b:.9})]}})}static createImageFill(t){return e(this,arguments,void 0,function*(e,t="FILL"){const i=yield this.createImage(e);return i?{type:"IMAGE",imageHash:i.hash,scaleMode:t}:l.createSolidFill({r:.9,g:.9,b:.9})})}static insertImage(t,i){return e(this,arguments,void 0,function*(e,t,i=800,o=600){try{let n,s,l;if(e&&"object"==typeof e&&"data"in e)n=e.data,s=e.width,l=e.height;else{if(!(e instanceof Uint8Array))return console.warn(`图片数据格式错误: ${t}`),null;n=e,s=i,l=o}if(!n||0===n.length)return console.warn(`图片数据为空: ${t}`),null;const a=4096;if(r.isOversized(s,l,a))return yield this.handleOversizedImage(n,s,l,t);const c=yield this.createImage(n);if(c){const e=figma.createRectangle();return e.name=t,e.resize(s,l),e.fills=[{type:"IMAGE",imageHash:c.hash,scaleMode:"FILL"}],e}return console.warn(`图片创建失败: ${t}，创建占位矩形`),this.createPlaceholderRect(s,l,t,"图片创建失败")}catch(e){return console.error(`图片插入失败: ${t}`,e),null}})}static handleOversizedImage(t,i,o,n){return e(this,void 0,void 0,function*(){return new Promise(s=>{const l=setTimeout(()=>{console.warn(`图片分割超时: ${n}`),s(this.createPlaceholderRect(i,o,n,"图片尺寸过大"))},15e3),a=r.calculateSliceStrategy(i,o,4096),c={direction:a.direction,sliceWidth:a.sliceWidth,sliceHeight:a.sliceHeight,slicesCount:a.slicesCount,description:a.description};figma.ui.postMessage({type:"slice-large-image",imageData:{bytes:Array.from(t),width:i,height:o,name:n,type:"image/png"},sliceWidth:c.sliceWidth,sliceHeight:c.sliceHeight,sliceStrategy:c});const h=t=>e(this,void 0,void 0,function*(){if("slice-image-response"===t.type&&t.imageName===n){if(clearTimeout(l),t.success&&t.slices&&t.slices.length>0)try{const e=yield this.assembleSlicedImage(t.slices,i,o,n,c);s(e)}catch(e){console.error(`图片组装失败: ${n}`,e),s(this.createPlaceholderRect(i,o,n,"图片组装失败"))}else console.warn(`图片切片失败: ${n}`,t.error||"未知错误"),s(this.createPlaceholderRect(i,o,n,"图片切片失败"));figma.ui.off("message",h)}});figma.ui.on("message",h),setTimeout(()=>{figma.ui.off("message",h)},16e3)})})}static assembleSlicedImage(t,i,o,n,r){return e(this,void 0,void 0,function*(){try{figma.notify(`正在组装图片: ${n} (${r.description})`,{timeout:2e3});const e=[];for(let i=0;i<t.length;i++){const o=t[i],r=new Uint8Array(o.bytes);try{const t=yield this.createImage(r);if(t){const r=figma.createRectangle();r.name=`${n}_slice_${i+1}`,r.resize(o.width,o.height),r.x=o.x,r.y=o.y,r.fills=[{type:"IMAGE",imageHash:t.hash,scaleMode:"FILL"}],e.push(r)}else console.warn(`切片 ${i+1} 图片创建失败，跳过此切片`)}catch(e){console.error(`切片 ${i+1} 处理失败:`,e)}}if(!(e.length>0))throw new Error("没有成功创建任何切片");try{const t=a.safeBatchAppendChildren(figma.currentPage,e,"图片切片批量添加到页面");t!==e.length&&console.warn(`部分切片添加失败，成功：${t}/${e.length}`);const i=figma.group(e,figma.currentPage);return i.name=n,i.x=0,i.y=0,figma.notify(`图片组装完成: ${n}`,{timeout:1e3}),i}catch(t){throw console.error("创建分组失败:",t),e.forEach((e,t)=>{a.safeRemoveNode(e,`清理图片切片${t+1}`)}),t}}catch(e){throw console.error("图片组装失败:",e),e}})}static createPlaceholderRect(e,t,i,o="未知原因"){const n=figma.createRectangle();n.name=`${i} (占位)`,n.resize(e,t);const r=o.includes("尺寸过大")?{r:1,g:.9,b:.8}:{r:.95,g:.95,b:.95};n.fills=[l.createSolidFill(r)];try{s.loadSingle({family:"Inter",style:"Regular"}).then(()=>{const r=figma.createText();r.fontName={family:"Inter",style:"Regular"},r.characters=`${i}\n${e}×${t}\n${o}`,r.fontSize=Math.min(Math.max(12,e/50),20),r.fills=[l.createSolidFill({r:.4,g:.4,b:.4})],r.textAlignHorizontal="CENTER",r.textAlignVertical="CENTER",n.parent&&(r.x=n.x+(e-r.width)/2,r.y=n.y+(t-r.height)/2,a.safeAppendChild(n.parent,r,"占位矩形文本添加"))}).catch(()=>{console.warn("占位文本创建失败")})}catch(e){console.warn("占位文本添加失败:",e)}return n}static setImageFill(t,i){return e(this,arguments,void 0,function*(e,t,i="FILL"){if(!t)return;const o=n.extractUint8Array(t);if(o)try{const t=yield this.createImageFill(o,i);e.fills=[t]}catch(e){console.error("设置图片填充失败:",e)}})}}function h(t){return e(this,void 0,void 0,function*(){try{const e=t.parent;if(!e||"FRAME"!==e.type)return null;const i=e.findOne(e=>"FRAME"===e.type&&"游戏信息"===e.name);if(!i)return null;const o=e=>{if("按钮底图"===e.name){if("clone"in e){return e.clone()}return null}if("children"in e)for(const t of e.children){const e=o(t);if(e)return e}return null};return o(i)}catch(e){return console.error("findAndCloneButtonImageFromGameInfo失败:",e),null}})}function d(e){try{const t=e.parent;if(!t||"FRAME"!==t.type)return null;const i=t.findOne(e=>"FRAME"===e.type&&"游戏信息"===e.name);if(!i)return null;const o=e=>{if("TEXT"===e.type&&e.parent&&"name"in e.parent&&"下载按钮"===e.parent.name)return e;if("children"in e)for(const t of e.children){const e=o(t);if(e)return e}return null},n=o(i);return n?{fontName:n.fontName,fills:JSON.parse(JSON.stringify(n.fills))}:null}catch(e){return console.error("获取下载按钮文本样式失败:",e),null}}function u(t,i,o){return e(this,void 0,void 0,function*(){var e;const n=a.createFrame(o.name,o.width,o.height);n.x=o.x,n.y=o.y,n.fills=[];const r=yield h(i);r&&(r.resize(o.width,o.height),r.x=(n.width-r.width)/2,r.y=(n.height-r.height)/2,a.safeAppendChild(n,r,`${o.text}按钮图片添加`));const s=d(i),c=figma.createText();return c.name=`${o.text}文本`,c.characters=o.text,s?(c.fontName=s.fontName,c.fills=s.fills):(c.fontName={family:"Inter",style:"Bold"},c.fills=[l.createSolidFill({r:1,g:1,b:1})]),c.fontSize=null!==(e=o.textFontSize)&&void 0!==e?e:50,c.textAlignHorizontal="CENTER",c.textAlignVertical="CENTER",c.x=(n.width-c.width)/2,c.y=(n.height-c.height)/2,a.safeAppendChild(n,c,`${o.text}文本添加`),a.safeAppendChild(t,n,`${o.text}容器添加`),n})}function g(t,i){return e(this,void 0,void 0,function*(){if(!t&&i)return null;if(!t&&!i)return null;const o=a.createFrame("头图",1080,1080);o.clipsContent=!0,o.fills=[],o.layoutMode="NONE";let n=0,r=null,s=null;if(t)try{const e=yield c.insertImage(t,"头图图片");r=e&&"strokeCap"in e?e:null,r&&(a.safeAppendChild(o,r,"头图图片添加到画板"),r.constraints={horizontal:"CENTER",vertical:"MIN"},r.x=(o.width-r.width)/2,r.y=n,n=r.height)}catch(e){console.error("头图创建失败:",e)}if(function(e,t,i){t&&!i?e.resize(1080,t.height):t&&i&&(e.resize(1080,t.height),i.y=t.height-i.height,i.constraints={horizontal:"CENTER",vertical:"MAX"})}(o,r,s),r)try{yield function(t,i){return e(this,void 0,void 0,function*(){try{if(!t||!t.parent)return void console.warn("头图节点不存在或已被删除，跳过羽化蒙版处理");const e=t.x,o=t.y,n=t.constraints,r=t.width,s=t.height,c=t.clone();c.name="头图图片";const h=.1*r,d=s-h,u=r+2*h+25,g=figma.createRectangle();let f,m;g.name="蒙版",g.fills=[l.createSolidFill({r:1,g:1,b:1})],g.resize(u,d),a.safeAppendChild(i,g,"羽化蒙版矩形添加到frame"),yield new Promise(e=>setTimeout(e,0));try{f=figma.group([g],i),f.name="羽化蒙版"}catch(e){return void console.error("创建羽化蒙版组失败:",e)}try{const e={type:"LAYER_BLUR",radius:h,visible:!0};void 0!==f.effects&&(f.effects=[e])}catch(e){console.warn("设置模糊效果失败:",e)}try{"isMask"in f&&(f.isMask=!0)}catch(e){console.warn("设置剪切蒙版失败:",e)}try{m=figma.group([f,t],i),m.name="头图"}catch(e){return void console.error("创建头图组失败:",e)}const y=(r-u)/2;g.x=e+y,g.y=0,t.x=e,t.y=o,t.constraints=n;try{t&&t.parent&&t.remove()}catch(e){console.warn("删除原头图节点失败:",e)}try{a.safeAppendChild(m,c,"复制的头图图片节点添加到头图组"),c.x=e,c.y=o,c.constraints=n}catch(e){console.error("将复制的头图图片节点添加到头图组失败:",e)}}catch(e){console.error("为头图图片添加羽化蒙版失败:",e)}})}(r,o)}catch(e){console.error("头图图片添加羽化蒙版失败:",e)}if(i)try{const e=yield c.insertImage(i,"标题图片");s=e&&"strokeCap"in e?e:null,s&&(a.safeAppendChild(o,s,"标题图片添加到画板"),s.constraints={horizontal:"CENTER",vertical:"MAX"},s.x=(o.width-s.width)/2,s.y=o.height-s.height)}catch(e){console.error("标题图片创建失败:",e)}return o})}class f{constructor(e,t){this.frame=e,this.config=t}build(){return e(this,void 0,void 0,function*(){"imageButton"===this.config.buttonVersion&&(yield this.addGameIcon(),yield this.addGameInfo()),yield this.addButtons()})}addGameIcon(){return e(this,void 0,void 0,function*(){if(!this.config.gameIcon)return;const e=yield c.insertImage(this.config.gameIcon,"游戏图标",190,190);e&&(e.resize(190,190),"cornerRadius"in e&&(e.cornerRadius=40),"strokes"in e&&(e.strokes=[{type:"SOLID",color:{r:1,g:1,b:1},opacity:.2}]),"strokeWeight"in e&&(e.strokeWeight=1),e.x=70,e.y=(this.frame.height-190)/2,a.safeAppendChild(this.frame,e,"游戏图标添加"))})}addGameInfo(){return e(this,void 0,void 0,function*(){const e=this.config.gameTextColor?l.hexToRgb(this.config.gameTextColor):{r:1,g:1,b:1};if(this.config.gameName){const t=yield a.createText(this.config.gameName,48,"Medium");t.x=285,t.y=49,t.textAlignHorizontal="LEFT",t.fills=[l.createSolidFill(e)],a.safeAppendChild(this.frame,t,"游戏名称文本添加")}if(this.config.gameDesc){const t=yield a.createText(this.config.gameDesc,32,"Regular");t.x=285,t.y=122,t.resize(300,t.height),t.textAutoResize="HEIGHT",t.textAlignHorizontal="LEFT",t.fills=[l.createSolidFill(e)],a.safeAppendChild(this.frame,t,"游戏描述文本添加")}})}addButtons(){return e(this,void 0,void 0,function*(){switch(this.config.buttonVersion){case"imageButton":yield this.addIconButton();break;case"singleButton":yield this.addSingleButton();break;case"doubleButton":yield this.addDoubleButtons()}})}addIconButton(){return e(this,void 0,void 0,function*(){if(!this.config.iconButtonBg)return;const e=a.createFrame("下载按钮",344,103);if(e.x=666,e.y=(this.frame.height-103)/2,e.fills=[],this.config.iconButtonBg)try{const t=yield c.insertImage(this.config.iconButtonBg,"按钮底图",344,103);if(t){if(t.height>103){const e=103/t.height;t.resize(t.width*e,103)}if(t.width>344){const e=344/t.width;t.resize(344,t.height*e)}t.x=0,t.y=0,a.safeAppendChild(e,t,"图标按钮底图添加")}else e.fills=[l.createSolidFill({r:0,g:.44,b:.89})],e.cornerRadius=30}catch(t){console.error("按钮底图创建失败:",t),e.fills=[l.createSolidFill({r:0,g:.44,b:.89})],e.cornerRadius=30}else e.fills=[l.createSolidFill({r:0,g:.44,b:.89})],e.cornerRadius=30;const t=this.config.iconButtonText||"立即下载";{const i=this.config.iconButtonTextColor?l.hexToRgb(this.config.iconButtonTextColor):{r:1,g:1,b:1};try{const o=yield a.createText(t,36,"Bold");o.fills=[l.createSolidFill(i)],o.resize(e.width,o.height),o.textAlignHorizontal="CENTER",o.y=(e.height-o.height)/2,a.safeAppendChild(e,o,"图标按钮文本添加")}catch(e){console.error("创建按钮文本失败:",e)}}a.safeAppendChild(this.frame,e,"图标按钮框架添加")})}addSingleButton(){return e(this,void 0,void 0,function*(){if(!this.config.singleButtonBg)return;const e=a.createFrame("单按钮",600,80);e.x=(t-600)/2,e.y=(this.frame.height-80)/2,e.cornerRadius=40;try{yield c.setImageFill(e,this.config.singleButtonBg)}catch(e){return void console.error("单按钮底图设置失败:",e)}const i=this.config.singleButtonText||"立即下载";{const t=this.config.singleButtonTextColor?l.hexToRgb(this.config.singleButtonTextColor):{r:1,g:1,b:1};try{const o=yield a.createText(i,32,"Bold");o.fills=[l.createSolidFill(t)],o.resize(e.width,o.height),o.textAlignHorizontal="CENTER",o.y=(e.height-o.height)/2,a.safeAppendChild(e,o,"单按钮文本添加")}catch(e){console.error("创建单按钮文本失败:",e)}}a.safeAppendChild(this.frame,e,"单按钮框架添加")})}addDoubleButtons(){return e(this,void 0,void 0,function*(){const e=this.config.leftButtonBg,i=this.config.rightButtonBg;if(!e&&!i)return;const o=this.config.buttonSpacing||10,n=(800-o)/2,r=(t-800)/2,s=(this.frame.height-80)/2;if(e)try{const e=yield this.createButton("左侧按钮",this.config.leftButtonText||"左侧按钮",this.config.leftButtonTextColor,this.config.leftButtonBg,n,80);e&&(e.x=r,e.y=s,a.safeAppendChild(this.frame,e,"左侧按钮添加"))}catch(e){console.error("创建左侧按钮失败:",e)}if(i)try{const e=yield this.createButton("右侧按钮",this.config.rightButtonText||"右侧按钮",this.config.rightButtonTextColor,this.config.rightButtonBg,n,80);e&&(e.x=r+n+o,e.y=s,a.safeAppendChild(this.frame,e,"右侧按钮添加"))}catch(e){console.error("创建右侧按钮失败:",e)}})}createButton(t,i,o,n,r,s){return e(this,void 0,void 0,function*(){if(!n)return null;const e=a.createFrame(t,r,s);e.cornerRadius=s/2;try{yield c.setImageFill(e,n)}catch(e){return console.error(`${t}底图设置失败:`,e),null}if(i)try{const n=o?l.hexToRgb(o):{r:1,g:1,b:1},c=yield a.createText(i,24,"Bold");c.fills=[l.createSolidFill(n)],c.resize(r,c.height),c.textAlignHorizontal="CENTER",c.y=(s-c.height)/2,a.safeAppendChild(e,c,`${t}按钮文本添加`)}catch(e){console.error(`创建${t}文本失败:`,e)}return e})}}class m{createModule(t,o){return e(this,void 0,void 0,function*(){try{let e;const n=(t.type,t.type);switch(console.log("🏭 [模块工厂] 开始创建模块:",{"模块ID":t.id,"模块类型":n,"模块标题":t.title,"内容键":Object.keys(t.content||{})}),n){case"activityContent":case i.ACTIVITY_CONTENT:e=yield this.createActivityContentModule(t.content);break;case"signIn":case i.SIGN_IN:e=yield this.createSignInModule(t.content);break;case"collectCards":case i.COLLECT_CARDS:e=yield this.createCollectCardsModule(t.content);break;case"nineGrid":case i.NINE_GRID:e=yield this.createNineGridModule(t.content,o);break;case"carousel":case i.CAROUSEL:e=yield this.createCarouselModule(t.content);break;case"verticalCarousel":case i.VERTICAL_CAROUSEL:e=yield this.createVerticalCarouselModule(t.content);break;default:return console.warn(`未知的模块类型: ${n}`),this.createErrorModule(t,`未知的模块类型: ${n}`)}return e.name=t.title||`${n}模块`,console.log("✅ [模块工厂] 模块创建成功:",{"模块名称":e.name,"模块大小":`${e.width}x${e.height}`}),e}catch(e){return console.error(`❌ [模块工厂] 创建模块失败: ${t.type}`,e),this.createErrorModule(t,e)}})}createActivityContentModule(i){return e(this,void 0,void 0,function*(){console.log("🎭 [活动内容模块] 开始创建:",{"主标题":i.mainTitle,"副标题":i.subTitle,"正文内容":i.text,"主标题背景":!!i.mainTitleBg,"副标题背景":!!i.subTitleBg,"插图":!!i.image});const e=a.createFrame("活动内容模块",t,1e3);e.fills=[];const o=new C(e,i);return yield o.build(),console.log("✅ [活动内容模块] 创建完成，最终高度：",e.height),e})}createSignInModule(i){return e(this,void 0,void 0,function*(){const e=a.createFrame("签到模块",t,460),o=new E(e,i);return yield o.build(),e})}createCollectCardsModule(i){return e(this,void 0,void 0,function*(){const e=a.createFrame("集卡模块",t,300),o=new A(e,i);return yield o.build(),e})}createNineGridModule(t,i){return e(this,void 0,void 0,function*(){return new v(t,i).build()})}createCarouselModule(t){return e(this,void 0,void 0,function*(){const e=a.createFrame("图片轮播（横版）",1080,957);e.fills=[];const i=new I(e,t);return yield i.build(),console.log("图片轮播（横版）模块创建完成，最终高度：",e.height),e})}createVerticalCarouselModule(t){return e(this,void 0,void 0,function*(){const e=a.createFrame("图片轮播（竖版）",1080,1405);e.fills=[];const i=new T(e,t);return yield i.build(),console.log("图片轮播（竖版）模块创建完成，最终高度：",e.height),e})}createErrorModule(i,o){return e(this,void 0,void 0,function*(){const e=a.createFrame(`错误模块-${i.type}`,t,100);e.fills=[l.createSolidFill({r:1,g:.9,b:.9})];const n=yield a.createText(`模块创建失败: ${i.type}\n${o}`,14,"Regular");return n.x=20,n.y=20,a.safeAppendChild(e,n,"错误信息添加"),e})}}class y{constructor(e,t){this.currentY=0,this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){console.log("开始构建活动规则模块");try{const e=this.content.rulesTitle&&""!==this.content.rulesTitle.trim(),t=null!==this.content.rulesBgImage&&void 0!==this.content.rulesBgImage,i=this.content.rulesContent&&""!==this.content.rulesContent.trim();if(!e&&!t&&!i)return console.log("活动规则模块：没有任何内容需要构建，跳过"),void this.frame.resize(1080,0);(e||t)&&(console.log("添加活动规则标题..."),yield this.addTitle()),i&&(console.log("添加活动规则内容..."),yield this.addRulesContent()),console.log("调整模块高度..."),this.adjustFrameHeight(),console.log("活动规则模块构建完成")}catch(e){throw console.error("活动规则模块构建过程中出错：",e),e}})}addTitle(){return e(this,void 0,void 0,function*(){const t=this.content.rulesTitle&&""!==this.content.rulesTitle.trim(),i=null!==this.content.rulesBgImage&&void 0!==this.content.rulesBgImage;if(!t&&!i)return;this.currentY+=90;const o=t?this.content.rulesTitle:"",n=yield function(t,i,o,n){return e(this,arguments,void 0,function*(e,t,i,o,n=24,r="Bold"){const s=a.createFrame("标题容器",i,o);if(t?yield c.setImageFill(s,t):s.fills=[l.createSolidFill({r:.95,g:.95,b:.95})],e){const t=yield a.createText(e,n,r);t.fills=[l.createSolidFill({r:0,g:0,b:0})],t.textAlignHorizontal="CENTER",t.textAlignVertical="CENTER",t.x=(i-t.width)/2,t.y=(o-t.height)/2,s.appendChild(t)}return s})}(o,this.content.rulesBgImage,1080,120,48,"Bold");n.x=0,n.y=this.currentY,a.safeAppendChild(this.frame,n,"活动规则标题容器添加"),this.currentY+=120})}addRulesContent(){return e(this,void 0,void 0,function*(){if(!this.content.rulesContent)return;console.log("添加规则内容..."),this.currentY+=90;const e=yield a.createText(this.content.rulesContent,28,"Regular");e.fills=[l.createSolidFill({r:0,g:0,b:0})],e.lineHeight={unit:"AUTO"},e.resize(950,e.height),e.textAlignHorizontal="LEFT",e.x=65,e.y=this.currentY,a.safeAppendChild(this.frame,e,"活动规则内容文本添加"),this.currentY+=e.height})}adjustFrameHeight(){this.currentY+=90,this.frame.resize(1080,this.currentY)}}class p{constructor(e,t){this.frame=e,this.config=t}build(){return e(this,void 0,void 0,function*(){yield this.setupBackground(),yield this.addContent()})}setupBackground(){return e(this,void 0,void 0,function*(){this.config.footerBg?yield c.setImageFill(this.frame,this.config.footerBg):this.frame.fills=[]})}addContent(){return e(this,void 0,void 0,function*(){this.config.footerLogo&&(yield this.addLogo())})}addLogo(){return e(this,void 0,void 0,function*(){if(this.config.footerLogo){console.log("开始创建Logo，使用ImageNodeBuilder");try{const e=yield c.insertImage(this.config.footerLogo,"LOGO");if(!e)return void console.log("Logo图片节点创建失败");const i=e.width,o=e.height,n=i/o;let r,s;console.log(`Logo原始尺寸: ${i}x${o}, 宽高比: ${n.toFixed(2)}`),r=340,s=r/n,s>250&&(s=250,r=s*n),e.resize(r,s),e.x=(t-r)/2,e.y=(this.frame.height-s)/2,"constraints"in e&&(e.constraints={horizontal:"SCALE",vertical:"SCALE"}),a.safeAppendChild(this.frame,e,"尾版Logo图片添加"),console.log(`Logo创建成功: 最终尺寸=${r.toFixed(1)}x${s.toFixed(1)}, 位置=(${e.x.toFixed(1)}, ${e.y.toFixed(1)})`)}catch(e){console.error("Logo创建失败:",e)}}else console.log("跳过Logo创建：没有上传Logo图片")})}}class v{constructor(e,i){this.CELL_SIZE=270,this.CELL_SPACING=24,this.currentY=0,this.content=e,this.mainContainer=i||a.createFrame("临时容器",1080,1e3),this.frame=a.createFrame("九宫格抽奖",t,1e3),this.frame.fills=[]}build(){return e(this,void 0,void 0,function*(){try{return yield this.addTitle(),yield this.addNineGrid(),this.currentY+=90,yield u(this.frame,this.mainContainer,{name:"我的奖品",text:"我的奖品",x:102,y:this.currentY,width:398,height:112,textFontSize:50}),yield u(this.frame,this.mainContainer,{name:"活动规则",text:"活动规则",x:580,y:this.currentY,width:398,height:112,textFontSize:50}),this.currentY+=112,this.adjustFrameHeight(),this.frame}catch(e){throw console.error("九宫格模块构建过程中出错：",e),e}})}addTitle(){return e(this,void 0,void 0,function*(){if(!this.content.mainTitle)return;const e=a.createFrame("九宫格标题",t,120);if(e.x=0,e.y=this.currentY+90,e.fills=[],this.content.titleBgImage)try{const i=yield c.insertImage(this.content.titleBgImage,"标题背景图片",t,120);i&&(i.x=0,i.y=0,a.safeAppendChild(e,i,"标题背景图片添加"))}catch(e){console.error("标题背景图片创建失败:",e)}const i=yield a.createText(this.content.mainTitle,48,"Bold");i.fills=[l.createSolidFill({r:1,g:1,b:1})],i.resize(t,i.height),i.textAlignHorizontal="CENTER",i.x=0,i.y=(120-i.height)/2,a.safeAppendChild(e,i,"标题文本添加"),a.safeAppendChild(this.frame,e,"标题容器添加"),this.currentY+=120})}addNineGrid(){return e(this,void 0,void 0,function*(){const e=3*this.CELL_SIZE+4*this.CELL_SPACING+180,i=a.createFrame("九宫格主体",t,e);if(i.x=0,i.y=this.currentY+90,i.fills=[],this.content.gridBgImage)try{const o=yield c.insertImage(this.content.gridBgImage,"九宫格背景",930,930);o&&(o.x=(t-930)/2,o.y=(e-930)/2,a.safeAppendChild(i,o,"九宫格背景图片添加"))}catch(e){console.error("九宫格背景图片创建失败:",e)}for(let e=0;e<3;e++)for(let t=0;t<3;t++){const o=3*e+t,n=yield this.createGridCell(e,t,o);a.safeAppendChild(i,n,`九宫格单元格${o+1}添加`)}a.safeAppendChild(this.frame,i,"九宫格容器添加"),this.currentY+=e})}createGridCell(i,o,n){return e(this,void 0,void 0,function*(){const e=3*this.CELL_SIZE+2*this.CELL_SPACING,r=(t-e)/2+o*(this.CELL_SIZE+this.CELL_SPACING),s=90+this.CELL_SPACING+i*(this.CELL_SIZE+this.CELL_SPACING);return 4===n?this.createDrawButton(r,s):this.createPrizeCell(r,s,n)})}createDrawButton(t,i){return e(this,void 0,void 0,function*(){const e=a.createFrame("抽奖按钮容器",this.CELL_SIZE,this.CELL_SIZE);e.x=t,e.y=i,e.fills=[];try{if(this.content.drawButtonImage)try{const t=yield c.insertImage(this.content.drawButtonImage,"抽奖按钮图片",this.CELL_SIZE,this.CELL_SIZE);t?(t.x=0,t.y=0,a.safeAppendChild(e,t,"抽奖按钮图片添加")):(console.warn("抽奖按钮图片插入失败，使用默认样式"),yield this.addDefaultButtonStyle(e))}catch(t){console.error("抽奖按钮图片创建失败：",t),yield this.addDefaultButtonStyle(e)}else yield this.addDefaultButtonStyle(e)}catch(t){console.error("创建抽奖按钮失败：",t),yield this.addDefaultButtonStyle(e)}return e})}addDefaultButtonStyle(t){return e(this,void 0,void 0,function*(){t.fills=[l.createSolidFill({r:1,g:.3,b:.3})],t.cornerRadius=10;const e=yield a.createText("抽奖",24,"Bold");e.fills=[l.createSolidFill({r:1,g:1,b:1})],e.resize(this.CELL_SIZE,e.height),e.textAlignHorizontal="CENTER",e.y=(this.CELL_SIZE-e.height)/2,a.safeAppendChild(t,e,"抽奖按钮默认文本添加")})}createPrizeCell(t,i,o){return e(this,void 0,void 0,function*(){var e;let n;if(o<=3)n=o;else{if(4===o)throw new Error("位置4是抽奖按钮位置，不应创建奖品格子");if(5===o)n=4;else if(6===o)n=5;else if(7===o)n=6;else{if(8!==o)throw new Error(`无效的九宫格位置: ${o}`);n=7}}const r=null===(e=this.content.prizes)||void 0===e?void 0:e[n];let s;if(7===n)s="谢谢参与";else{s=`奖品${(n+1).toString().padStart(2,"0")}`}const h=(null==r?void 0:r.name)||s;console.log(`🎯 [奖品映射调试] 九宫格位置${o} → 奖品索引${n} → "${h}" (默认: "${s}")`);const d=a.createFrame(h,this.CELL_SIZE,this.CELL_SIZE);d.x=t,d.y=i,d.fills=[];try{if(this.content.prizeBgImage)try{const e=yield c.insertImage(this.content.prizeBgImage,"奖品背景图片",this.CELL_SIZE,this.CELL_SIZE);e&&(e.x=0,e.y=0,a.safeAppendChild(d,e,"奖品背景图片添加"))}catch(e){console.error("奖品背景图片创建失败:",e)}if(null==r?void 0:r.image)try{const e=yield c.insertImage(r.image,"奖品图片",180,180);e&&(e.x=45,e.y=11,a.safeAppendChild(d,e,"奖品图片添加"))}catch(e){console.error("奖品图片创建失败:",e);const t=a.createFrame("占位符",180,180);t.x=45,t.y=11,t.fills=[l.createSolidFill({r:.9,g:.9,b:.9})],t.cornerRadius=10,a.safeAppendChild(d,t,"奖品占位符添加")}else{const e=a.createFrame("占位符",180,180);e.x=45,e.y=11,e.fills=[l.createSolidFill({r:.9,g:.9,b:.9})],e.cornerRadius=10,a.safeAppendChild(d,e,"奖品默认占位符添加")}const e=(null==r?void 0:r.name)||h;if(e){const t=yield a.createText(e,26,"Medium");t.resize(this.CELL_SIZE,t.height),t.textAlignHorizontal="CENTER",t.x=0,t.y=190,t.fills=[l.createSolidFill({r:0,g:0,b:0})],a.safeAppendChild(d,t,"奖品名称文本添加")}}catch(e){console.error(`创建奖品格子失败 ${n}:`,e)}return d})}adjustFrameHeight(){this.frame.resize(t,this.currentY+90)}}class I{constructor(e,t){this.TITLE_HEIGHT=120,this.CAROUSEL_AREA_HEIGHT=607,this.CAROUSEL_BG_WIDTH=1e3,this.CAROUSEL_BG_HEIGHT=540,this.CAROUSEL_IMAGE_WIDTH=960,this.CAROUSEL_IMAGE_HEIGHT=500,this.BUTTON_HEIGHT=20,this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){console.log("开始构建图片轮播（横版）模块");try{this.setupFrameLayout(),yield this.addTitleContainer(),yield this.addCarouselPreview(),console.log("图片轮播（横版）模块构建完成")}catch(e){throw console.error("图片轮播（横版）模块构建过程中出错：",e),e}})}setupFrameLayout(){a.setupAutoLayout(this.frame,"VERTICAL",30,90)}addTitleContainer(){return e(this,void 0,void 0,function*(){if(!this.content.title&&!this.content.titleBackground)return;console.log("添加标题容器 - 1080x120px");const e=a.createFrame("标题容器",1080,this.TITLE_HEIGHT);if(e.fills=[],this.content.titleBackground)try{const t=yield c.insertImage(this.content.titleBackground,"标题背景图片",1080,120);t&&(t.x=0,t.y=0,a.safeAppendChild(e,t,"标题背景图片添加"))}catch(e){console.error("标题背景图片创建失败:",e)}if(this.content.title){const t=yield a.createText(this.content.title,48,"Bold");t.fills=[l.createSolidFill({r:1,g:1,b:1})],t.resize(1080,t.height),t.textAlignHorizontal="CENTER",t.x=0,t.y=(120-t.height)/2,a.safeAppendChild(e,t,"标题文本添加")}a.safeAppendChild(this.frame,e,"标题容器添加")})}addCarouselPreview(){return e(this,void 0,void 0,function*(){console.log("添加轮播预览区域");const e=a.createFrame("轮播图预览",1080,this.CAROUSEL_AREA_HEIGHT);e.fills=[],a.setupAutoLayout(e,"VERTICAL",0,0),yield this.addCarouselArea(e),yield this.addCarouselButtons(e),a.safeAppendChild(this.frame,e,"轮播预览区域添加")})}addCarouselArea(t){return e(this,void 0,void 0,function*(){console.log("添加轮播区域 - 1080x607px");const e=a.createFrame("轮播区域",1080,this.CAROUSEL_AREA_HEIGHT);e.fills=[];const i=a.createFrame("轮播图背景",this.CAROUSEL_BG_WIDTH,this.CAROUSEL_BG_HEIGHT);if(this.content.carouselBackground)try{const e=yield c.insertImage(this.content.carouselBackground,"轮播图背景图片",this.CAROUSEL_BG_WIDTH,this.CAROUSEL_BG_HEIGHT);e&&(e.x=0,e.y=0,a.safeAppendChild(i,e,"轮播图背景图片添加"))}catch(e){console.error("轮播图背景图片创建失败:",e),i.fills=[l.createSolidFill({r:1,g:1,b:1})]}else i.fills=[l.createSolidFill({r:1,g:1,b:1})];if(i.x=(1080-this.CAROUSEL_BG_WIDTH)/2,i.y=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_BG_HEIGHT)/2+.5,a.safeAppendChild(e,i,"轮播图背景添加"),this.content.carouselImage)try{const t=yield c.insertImage(this.content.carouselImage,"轮播图",this.CAROUSEL_IMAGE_WIDTH,this.CAROUSEL_IMAGE_HEIGHT);t&&(t.x=(1080-this.CAROUSEL_IMAGE_WIDTH)/2,t.y=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_IMAGE_HEIGHT)/2+.5,a.safeAppendChild(e,t,"轮播图添加"))}catch(t){console.error("轮播图创建失败:",t);const i=figma.createRectangle();i.name="轮播图",i.resize(this.CAROUSEL_IMAGE_WIDTH,this.CAROUSEL_IMAGE_HEIGHT),i.fills=[l.createSolidFill({r:1,g:.3,b:.3})],i.x=(1080-this.CAROUSEL_IMAGE_WIDTH)/2,i.y=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_IMAGE_HEIGHT)/2+.5,a.safeAppendChild(e,i,"轮播图占位添加")}a.safeAppendChild(t,e,"轮播区域添加")})}addCarouselButtons(t){return e(this,void 0,void 0,function*(){console.log("添加轮播按钮");const e=a.createFrame("轮播按钮",300,this.BUTTON_HEIGHT);e.fills=[],a.setupAutoLayout(e,"HORIZONTAL",24,0);const i=figma.createEllipse();i.name="活跃按钮",i.resize(60,this.BUTTON_HEIGHT),i.fills=[l.createSolidFill({r:1,g:1,b:1})],a.safeAppendChild(e,i,"活跃按钮添加");for(let t=1;t<5;t++){const i=figma.createEllipse();i.name=`按钮${t+1}`,i.resize(this.BUTTON_HEIGHT,this.BUTTON_HEIGHT),i.fills=[],i.strokes=[l.createSolidFill({r:1,g:1,b:1})],i.strokeWeight=2,a.safeAppendChild(e,i,`按钮${t+1}添加`)}e.x=(1080-e.width)/2,a.safeAppendChild(t,e,"轮播按钮容器添加")})}}class C{constructor(e,t){this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){console.log("开始构建活动详情模块");try{this.setupAutoLayout(),yield this.addMainTitle(),yield this.addSubTitle(),yield this.addTextContent(),yield this.addImage(),this.adjustFrameHeight(),console.log("活动详情模块构建完成")}catch(e){throw console.error("活动详情模块构建过程中出错：",e),e}})}setupAutoLayout(){a.setupAutoLayout(this.frame,"VERTICAL",60,90)}addMainTitle(){return e(this,void 0,void 0,function*(){if(!this.content.mainTitleBg||!this.content.mainTitle)return;console.log("添加大标题...");const e=a.createFrame("活动内容大标题容器",1080,120);e.fills=[];try{const t=yield c.insertImage(this.content.mainTitleBg,"大标题背景图片",1080,120);t&&(t.x=0,t.y=0,a.safeAppendChild(e,t,"活动内容标题背景图片添加"))}catch(e){console.error("大标题背景图片创建失败:",e)}const i=yield a.createText(this.content.mainTitle,48,"Bold");i.fills=[l.createSolidFill({r:1,g:1,b:1})],i.resize(t,i.height),i.textAlignHorizontal="CENTER",i.x=0,i.y=(120-i.height)/2,a.safeAppendChild(e,i,"活动内容标题文本添加"),a.safeAppendChild(this.frame,e,"活动内容标题容器添加")})}addSubTitle(){return e(this,void 0,void 0,function*(){if(!this.content.subTitleBg||!this.content.subTitle)return;console.log("添加小标题...");const e=a.createFrame("活动内容小标题容器",1080,100);e.fills=[];try{const t=yield c.insertImage(this.content.subTitleBg,"小标题背景图片",1080,100);t&&(t.x=0,t.y=0,a.safeAppendChild(e,t,"小标题背景图片添加"))}catch(e){console.error("小标题背景图片创建失败:",e)}const i=yield a.createText(this.content.subTitle,44,"Medium");i.fills=[l.createSolidFill({r:1,g:1,b:1})],i.resize(t,i.height),i.textAlignHorizontal="CENTER",i.x=0,i.y=(100-i.height)/2,a.safeAppendChild(e,i,"小标题文本添加"),a.safeAppendChild(this.frame,e,"小标题容器添加")})}addTextContent(){return e(this,void 0,void 0,function*(){if(!this.content.text)return;console.log("添加正文...");const e=yield a.createText(this.content.text,40,"Regular");e.resize(950,e.height),e.textAlignHorizontal="CENTER",e.lineHeight={unit:"AUTO"},e.fills=[l.createSolidFill({r:1,g:1,b:1})],a.safeAppendChild(this.frame,e,"活动内容正文添加")})}addImage(){return e(this,void 0,void 0,function*(){if(this.content.image){console.log("添加插图...");try{const e=yield c.insertImage(this.content.image,"活动内容插图",950,600);e&&a.safeAppendChild(this.frame,e,"活动内容插图添加")}catch(e){console.error("插图创建失败:",e)}}})}adjustFrameHeight(){}}class E{constructor(e,t){this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){yield this.setupBackground(),yield this.addTitle(),yield this.addSignInDays(),yield this.addSignInButton()})}setupBackground(){return e(this,void 0,void 0,function*(){this.content.bgImage?yield c.setImageFill(this.frame,this.content.bgImage):this.frame.fills=[l.createSolidFill({r:.95,g:.95,b:1})]})}addTitle(){return e(this,void 0,void 0,function*(){const e=a.createFrame("签到标题",500,100);e.x=(t-500)/2,e.y=20,this.content.titleImage?yield c.setImageFill(e,this.content.titleImage,"FIT"):yield this.addDefaultTitle(e),a.safeAppendChild(this.frame,e,"签到标题添加")})}addDefaultTitle(t){return e(this,void 0,void 0,function*(){t.fills=[l.createSolidFill({r:.9,g:.5,b:.3})];const e=yield a.createText("每日签到",28,"Bold");e.fills=[l.createSolidFill({r:1,g:1,b:1})],e.resize(500,e.height),e.textAlignHorizontal="CENTER",e.y=(100-e.height)/2,a.safeAppendChild(t,e,"签到默认标题文本添加")})}addSignInDays(){return e(this,void 0,void 0,function*(){const e=a.createFrame("签到日期容器",t-40,240);e.x=20,e.y=140,e.fills=[l.createSolidFill({r:1,g:1,b:1},.8)],e.cornerRadius=10,a.setupAutoLayout(e,"HORIZONTAL",10,10);const i=this.content.daysCount||7;for(let t=0;t<i;t++){const i=yield this.createDayItem(t+1);a.safeAppendChild(e,i,`签到第${t+1}天添加`)}a.safeAppendChild(this.frame,e,"签到日期容器添加")})}createDayItem(t){return e(this,void 0,void 0,function*(){const e=a.createFrame(`第${t}天`,80,220);e.fills=[l.createSolidFill({r:.95,g:.95,b:.95})],e.cornerRadius=5,a.setupAutoLayout(e,"VERTICAL",10,10);const i=yield this.createDayIcon();a.safeAppendChild(e,i,"签到日期图标添加");const o=yield a.createText(`第${t}天`,16,"Medium");o.resize(80,o.height),o.textAlignHorizontal="CENTER",a.safeAppendChild(e,o,"签到日期文本添加");const n=yield a.createText("金币 x 100",14);return n.fills=[l.createSolidFill({r:.5,g:.5,b:.5})],n.resize(80,n.height),n.textAlignHorizontal="CENTER",a.safeAppendChild(e,n,"签到奖励描述添加"),e})}createDayIcon(){return e(this,void 0,void 0,function*(){const e=a.createFrame("日期图标",60,60);return this.content.dayIcon?yield c.setImageFill(e,this.content.dayIcon,"FILL"):(e.fills=[l.createSolidFill({r:1,g:.8,b:.2})],e.cornerRadius=30),e})}addSignInButton(){return e(this,void 0,void 0,function*(){const e=a.createFrame("签到按钮",200,60);e.x=(t-200)/2,e.y=400,this.content.signButton?yield c.setImageFill(e,this.content.signButton,"FIT"):yield this.addDefaultButton(e),a.safeAppendChild(this.frame,e,"签到按钮框架添加")})}addDefaultButton(t){return e(this,void 0,void 0,function*(){t.fills=[l.createSolidFill({r:1,g:.4,b:.3})],t.cornerRadius=30;const e=yield a.createText("立即签到",18,"Bold");e.fills=[l.createSolidFill({r:1,g:1,b:1})],e.resize(200,e.height),e.textAlignHorizontal="CENTER",e.y=(60-e.height)/2,a.safeAppendChild(t,e,"签到默认按钮文本添加")})}}class A{constructor(e,t){this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){this.content.bgImage?yield c.setImageFill(this.frame,this.content.bgImage):this.frame.fills=[l.createSolidFill({r:.95,g:.9,b:1})];let e=20;if(this.content.titleImage){const i=a.createFrame("集卡标题",400,80);i.x=(t-400)/2,i.y=e,yield c.setImageFill(i,this.content.titleImage,"FIT"),a.safeAppendChild(this.frame,i,"集卡标题添加"),e+=100}const i=a.createFrame("卡片容器",t-40,200);i.x=20,i.y=e,i.fills=[l.createSolidFill({r:1,g:1,b:1},.9)],i.cornerRadius=10,a.setupAutoLayout(i,"HORIZONTAL",10,10);const o=this.content.cardsCount||5;for(let e=0;e<o;e++){const t=yield this.createCardItem(e+1);a.safeAppendChild(i,t,`集卡卡片${e+1}添加`)}if(a.safeAppendChild(this.frame,i,"集卡卡片容器添加"),e+=220,this.content.combineButton){const i=a.createFrame("合成按钮",200,60);i.x=(t-200)/2,i.y=e,yield c.setImageFill(i,this.content.combineButton,"FIT"),a.safeAppendChild(this.frame,i,"合成按钮添加"),e+=80}this.frame.resize(t,e)})}createCardItem(t){return e(this,void 0,void 0,function*(){const e=100,i=a.createFrame(`卡片${t}`,e,130);switch(this.content.cardBg?yield c.setImageFill(i,this.content.cardBg,"FILL"):i.fills=[l.createSolidFill({r:.9,g:.9,b:.9})],this.content.cardStyle){case"style1":i.cornerRadius=0;break;case"style2":i.cornerRadius=10;break;case"style3":i.cornerRadius=50;break;default:i.cornerRadius=5}const o=yield a.createText(`${t}`,16,"Bold");return o.resize(e,o.height),o.textAlignHorizontal="CENTER",o.y=105,a.safeAppendChild(i,o,"集卡卡片编号添加"),i})}}class T{constructor(e,t){this.TITLE_HEIGHT=120,this.CAROUSEL_AREA_HEIGHT=1285,this.MAIN_IMAGE_WIDTH=554,this.MAIN_IMAGE_HEIGHT=1097,this.SIDE_IMAGE_WIDTH=247,this.SIDE_IMAGE_HEIGHT=533,this.IMAGE_SPACING=20,this.CAROUSEL_BUTTON_HEIGHT=16,this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){console.log("开始构建图片轮播（竖版）模块");try{this.setupFrameLayout(),yield this.addTitleContainer(),yield this.addCarouselPreview(),console.log("✅ 图片轮播（竖版）模块构建成功")}catch(e){console.error("❌ 图片轮播（竖版）模块构建失败:",e);const t=a.createFrame("构建错误",1080,200);t.fills=[l.createSolidFill({r:1,g:.8,b:.8})];const i=yield a.createText(`构建失败: ${e}`,24,"Regular");throw i.fills=[l.createSolidFill({r:.8,g:0,b:0})],a.safeAppendChild(t,i,"错误信息添加"),a.safeAppendChild(this.frame,t,"错误信息框添加"),e}})}setupFrameLayout(){this.frame.name="图片轮播（竖版）",this.frame.resize(1080,this.TITLE_HEIGHT+this.CAROUSEL_AREA_HEIGHT),this.frame.fills=[]}addTitleContainer(){return e(this,void 0,void 0,function*(){console.log("添加轮播标题容器...");const e=a.createFrame("轮播标题容器",1080,this.TITLE_HEIGHT);if(e.x=0,e.y=0,e.fills=[],this.content.titleBackground)try{const t=yield c.insertImage(this.content.titleBackground,"轮播标题背景",1080,this.TITLE_HEIGHT);t&&(t.x=0,t.y=0,a.safeAppendChild(e,t,"轮播标题背景图片添加"))}catch(e){console.error("轮播标题背景图片创建失败:",e)}if(this.content.title){const t=yield a.createText(this.content.title,48,"Bold");t.fills=[l.createSolidFill({r:1,g:1,b:1})],t.resize(1080,t.height),t.textAlignHorizontal="CENTER",t.x=0,t.y=(this.TITLE_HEIGHT-t.height)/2,a.safeAppendChild(e,t,"轮播标题文本添加")}a.safeAppendChild(this.frame,e,"轮播标题容器添加")})}addCarouselPreview(){return e(this,void 0,void 0,function*(){console.log("添加轮播预览区域...");const e=a.createFrame("轮播预览容器",1080,this.CAROUSEL_AREA_HEIGHT);e.x=0,e.y=this.TITLE_HEIGHT,e.fills=[],yield this.addCarouselLayout(e),yield this.addCarouselButtons(e),a.safeAppendChild(this.frame,e,"轮播预览容器添加")})}addCarouselLayout(t){return e(this,void 0,void 0,function*(){console.log("添加轮播图片布局...");const e=(1080-(this.MAIN_IMAGE_WIDTH+this.IMAGE_SPACING+this.SIDE_IMAGE_WIDTH))/2,i=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_BUTTON_HEIGHT-this.MAIN_IMAGE_HEIGHT)/2;if(this.content.carouselImages[0])try{const o=yield c.insertImage(this.content.carouselImages[0],"轮播主图",this.MAIN_IMAGE_WIDTH,this.MAIN_IMAGE_HEIGHT);o&&(o.x=e,o.y=i,a.safeAppendChild(t,o,"轮播主图添加"))}catch(e){console.error("轮播主图创建失败:",e)}const o=a.createFrame("右侧图片容器",this.SIDE_IMAGE_WIDTH,this.MAIN_IMAGE_HEIGHT);if(o.x=e+this.MAIN_IMAGE_WIDTH+this.IMAGE_SPACING,o.y=i,o.fills=[],this.content.carouselImages[1])try{const e=yield c.insertImage(this.content.carouselImages[1],"轮播右上图",this.SIDE_IMAGE_WIDTH,this.SIDE_IMAGE_HEIGHT);e&&(e.x=0,e.y=0,a.safeAppendChild(o,e,"轮播右上图添加"))}catch(e){console.error("轮播右上图创建失败:",e)}if(this.content.carouselImages[2])try{const e=yield c.insertImage(this.content.carouselImages[2],"轮播右下图",this.SIDE_IMAGE_WIDTH,this.SIDE_IMAGE_HEIGHT);e&&(e.x=0,e.y=this.SIDE_IMAGE_HEIGHT+this.IMAGE_SPACING,a.safeAppendChild(o,e,"轮播右下图添加"))}catch(e){console.error("轮播右下图创建失败:",e)}a.safeAppendChild(t,o,"右侧图片容器添加")})}addCarouselButtons(t){return e(this,void 0,void 0,function*(){console.log("添加轮播按钮...");const e=a.createFrame("轮播按钮容器",120,this.CAROUSEL_BUTTON_HEIGHT);e.x=480,e.y=this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_BUTTON_HEIGHT-20,e.fills=[];for(let t=0;t<3;t++){const i=figma.createEllipse();i.name=`轮播按钮${t+1}`,i.resize(this.CAROUSEL_BUTTON_HEIGHT,this.CAROUSEL_BUTTON_HEIGHT),i.x=t*(this.CAROUSEL_BUTTON_HEIGHT+10),i.y=0,i.fills=0===t?[l.createSolidFill({r:1,g:1,b:1})]:[l.createSolidFill({r:1,g:1,b:1},.5)],a.safeAppendChild(e,i,`轮播按钮${t+1}添加`)}a.safeAppendChild(t,e,"轮播按钮容器添加")})}}class S{constructor(e){this.config=e}build(){return e(this,void 0,void 0,function*(){try{return console.log("开始构建H5原型..."),yield s.loadAll(),this.createBaseFrames(),yield this.setupBackground(),yield this.addModules(),this.finalizeLayout(),console.log("H5原型构建完成"),this.outerFrame}catch(e){throw console.error("H5原型构建失败:",e),e}})}hasAnyModuleContent(){const e=!(!this.config.headerImage&&!this.config.titleUpload),t=!!(this.config.gameName||this.config.gameDesc||this.config.gameIcon),i=!!(this.config.modules&&this.config.modules.length>0),o=this.config.rulesTitle&&""!==this.config.rulesTitle.trim(),n=null!==this.config.rulesBgImage&&void 0!==this.config.rulesBgImage,r=this.config.rulesContent&&""!==this.config.rulesContent.trim(),s=o||n||r,l=!(!this.config.footerLogo&&!this.config.footerBg);return e||t||i||s||l}createBaseFrames(){this.outerFrame=a.createFrame("H5原型",t,100),this.outerFrame.layoutMode="NONE",this.outerFrame.clipsContent=!0,this.outerFrame.fills=[],this.hasAnyModuleContent()?(this.h5Frame=a.createFrame("自适应模块",t,100),this.h5Frame.fills=[],a.setupAutoLayout(this.h5Frame,"VERTICAL",0,0),this.h5Frame.clipsContent=!0,this.h5Frame.layoutWrap="NO_WRAP",console.log("检测到模块内容，已创建自适应模块容器")):console.log("未检测到模块内容，跳过自适应模块容器创建")}setupBackground(){return e(this,void 0,void 0,function*(){console.log("🎨 [背景设置调试] 开始设置背景，配置信息:"),console.log("   - pageBgColor:",this.config.pageBgColor),console.log("   - pageBgImage:",!!this.config.pageBgImage);const e=!this.config.pageBgColor||"#FFFFFF"===this.config.pageBgColor||"#ffffff"===this.config.pageBgColor||"#ffffff"===this.config.pageBgColor.toLowerCase();if(console.log("   - 是否为默认白色:",e),this.h5Frame&&(this.h5Frame.fills=[],console.log("✅ 自适应模块容器设置为透明填充")),e)this.outerFrame.fills=[],console.log("✅ H5原型容器背景设置为透明（默认白色，代表用户未修改）"),console.log("   - 最终Frame填充:",this.outerFrame.fills);else{console.log("🎯 [颜色转换] 开始转换颜色:",this.config.pageBgColor);const e=l.hexToRgb(this.config.pageBgColor||"#FFFFFF");console.log("   - RGB转换结果:",e);const t=l.createSolidFill(e);console.log("   - 创建的填充对象:",t),this.outerFrame.fills=[t],console.log(`✅ H5原型容器背景色设置为: ${this.config.pageBgColor}`),console.log("   - 最终Frame填充:",this.outerFrame.fills)}if(this.config.pageBgImage){if(n.extractUint8Array(this.config.pageBgImage)){console.log("🖼️  开始添加背景图片");const e=yield c.insertImage(this.config.pageBgImage,"页面背景图片");e&&(e.x=(this.outerFrame.width-e.width)/2,e.y=0,"constraints"in e&&(e.constraints={horizontal:"CENTER",vertical:"MIN"}),a.safeAppendChild(this.outerFrame,e,"页面背景图片添加"),console.log("✅ 背景图片添加完成"))}}this.h5Frame&&a.safeAppendChild(this.outerFrame,this.h5Frame,"H5自适应模块容器添加"),console.log("🎨 [背景设置调试] 背景设置完成")})}addModules(){return e(this,void 0,void 0,function*(){if(!this.h5Frame)return void console.log("没有自适应模块容器，跳过模块添加");const e=yield this.createAllModules();a.safeBatchAppendChildren(this.h5Frame,e,"H5模块批量添加")})}createAllModules(){return e(this,void 0,void 0,function*(){return Promise.all([this.createHeaderModuleIfNeeded(),this.createGameInfoModuleIfNeeded(),...this.createCustomModules(),this.createRulesModuleIfNeeded(),this.createFooterModuleIfNeeded()])})}createHeaderModuleIfNeeded(){return e(this,void 0,void 0,function*(){if(this.config.headerImage||this.config.titleUpload){const e=yield g(this.config.headerImage,this.config.titleUpload);if(e)return e}return null})}createGameInfoModuleIfNeeded(){return e(this,void 0,void 0,function*(){if(this.config.gameName||this.config.gameDesc||this.config.gameIcon){return yield function(i){return e(this,void 0,void 0,function*(){let e=210;"doubleButton"===i.buttonVersion&&(e=250);const o=a.createFrame("游戏信息",t,e);o.fills=[];const n=new f(o,i);return yield n.build(),o})}(this.config)}return null})}createCustomModules(){var t;return(null===(t=this.config.modules)||void 0===t?void 0:t.map(t=>e(this,void 0,void 0,function*(){const i=yield function(t,i){return e(this,void 0,void 0,function*(){return(new m).createModule(t,i)})}(t,this.h5Frame);return i})))||[]}createRulesModuleIfNeeded(){return e(this,void 0,void 0,function*(){const t=this.config.rulesTitle&&""!==this.config.rulesTitle.trim(),i=null!==this.config.rulesBgImage&&void 0!==this.config.rulesBgImage,o=this.config.rulesContent&&""!==this.config.rulesContent.trim();if(t||i||o){return yield function(t){return e(this,void 0,void 0,function*(){console.log("开始创建活动规则模块，内容：",{rulesTitle:t.rulesTitle,rulesBgImage:!!t.rulesBgImage,rulesContent:t.rulesContent});const e=a.createFrame("活动规则",1080,1e3);e.fills=[];try{const i={rulesTitle:t.rulesTitle||"",rulesBgImage:t.rulesBgImage,rulesContent:t.rulesContent||""},o=new y(e,i);return yield o.build(),console.log("活动规则模块创建完成，最终高度：",e.height),e}catch(t){console.error("活动规则模块创建失败：",t);const i=yield a.createText(`活动规则模块创建失败: ${t instanceof Error?t.message:"未知错误"}`,16);return i.x=20,i.y=20,i.fills=[l.createSolidFill({r:1,g:0,b:0})],a.safeAppendChild(e,i,"活动规则模块错误文本添加"),e.resize(1080,100),e}})}(this.config)}return null})}createFooterModuleIfNeeded(){return e(this,void 0,void 0,function*(){if(this.config.footerLogo||this.config.footerBg){const i=yield function(i){return e(this,void 0,void 0,function*(){if(!i.footerLogo&&!i.footerBg)return console.log("跳过尾版模块创建：没有LOGO图片和尾版背景图片"),null;const e=a.createFrame("尾版",t,480),o=new p(e,i);return yield o.build(),e})}(this.config);if(i)return i}return null})}finalizeLayout(){return e(this,void 0,void 0,function*(){if(this.h5Frame){this.outerFrame.resize(t,this.h5Frame.height);try{if(this.h5Frame.parent===this.outerFrame){const e=this.outerFrame.children.length;e>1&&this.outerFrame.insertChild(e-1,this.h5Frame)}}catch(e){console.error("重新排列H5模块容器失败:",e)}}else{let e=100;if(this.config.pageBgImage){const t=this.outerFrame.findOne(e=>"页面背景图片"===e.name);t&&"height"in t&&(e=Math.max(e,t.height))}this.outerFrame.resize(t,e),console.log(`没有模块内容，H5原型设置为最小高度: ${e}px`)}yield function(t){return e(this,arguments,void 0,function*(e,t=10,i=100){const o=e.findAll(e=>"FRAME"===e.type&&"九宫格抽奖"===e.name);for(const n of o)for(const o of["我的奖品","活动规则"]){const r=x(n,o);r&&(yield F(r,e,o,t,i))}})}(this.h5Frame),a.safeAppendChild(figma.currentPage,this.outerFrame,"H5原型添加到当前页面"),figma.viewport.scrollAndZoomIntoView([this.outerFrame])})}}function x(e,t){return e.findOne(e=>"FRAME"===e.type&&e.name===t)}function F(t,i,o,n,r){return e(this,void 0,void 0,function*(){for(let e=0;e<n;e++){const e=i.findOne(e=>"FRAME"===e.type&&"游戏信息"===e.name);if(e){const i=d(e),o=t.findOne(e=>"TEXT"===e.type);i&&o&&(yield figma.loadFontAsync(i.fontName),o.fontName=i.fontName,Array.isArray(i.fills)&&i.fills.length>0&&(o.fills=[Object.assign({},i.fills[0])]));const n=yield h(e);return void(n&&(n.resize(t.width,t.height),n.x=0,n.y=0,t.appendChild(n),o&&t.appendChild(o)))}yield new Promise(e=>setTimeout(e,r))}console.warn(`[重试修正] ${o} 按钮样式修正失败，未找到游戏信息Frame`)})}class w{constructor(e,t,i){this.channel=e.toLowerCase(),this.sourcePrototype=t,this.images=i||{}}generate(){return e(this,void 0,void 0,function*(){try{console.log(`开始生成${this.channel}渠道版本`);const e=yield this.clonePrototype();yield this.applyChannelAdjustments(e),console.log(`${this.channel}渠道版本创建完成`)}catch(e){throw console.error(`生成${this.channel}渠道版本失败:`,e),e}})}clonePrototype(){return e(this,void 0,void 0,function*(){try{const i=this.sourcePrototype.clone();return i.name=`${this.channel.toUpperCase()}-H5`,e=i,t=this.sourcePrototype,e.x=t.x+t.width+100,e.y=t.y,a.safeAppendChild(figma.currentPage,i,`${this.channel}渠道原型添加`),console.log(`${this.channel}渠道原型复制完成，位置: (${i.x}, ${i.y})`),i}catch(e){throw console.error("复制原型失败:",e),new Error(`复制${this.channel}原型失败: ${e instanceof Error?e.message:"未知错误"}`)}var e,t})}applyChannelAdjustments(t){return e(this,void 0,void 0,function*(){try{console.log(`应用${this.channel}渠道的特定调整`);const e=this.findAdaptiveModule(t);if(!e)throw new Error("未找到自适应模块容器");yield this.adjustAdaptiveModuleContent(e),this.resizeChannelPrototype(t,e)}catch(e){throw console.error(`应用${this.channel}渠道调整失败:`,e),e}})}findAdaptiveModule(e){const t=e=>{if("FRAME"===e.type&&"自适应模块"===e.name)return e;if("children"in e)for(const i of e.children){const e=t(i);if(e)return e}return null};return t(e)}adjustAdaptiveModuleContent(t){return e(this,void 0,void 0,function*(){for(const e of t.children)if("FRAME"===e.type){const t=e;yield this.adjustModuleStyles(t)}})}resizeChannelPrototype(e,t){try{const i=t.width,o=t.height;e.resize(i,o),console.log(`${this.channel}渠道H5容器尺寸已调整为: ${i}x${o}`)}catch(e){console.error("调整渠道H5容器尺寸失败:",e)}}adjustModuleStyles(t){return e(this,void 0,void 0,function*(){try{switch(this.channel){case"oppo":yield this.applyOppoStyles(t);break;case"vivo":yield this.applyVivoStyles(t);break;case"huawei":yield this.applyHuaweiStyles(t);break;case"xiaomi":yield this.applyXiaomiStyles(t);break;default:console.log(`${this.channel}渠道暂无特定样式调整`)}}catch(e){console.error("调整模块样式失败:",e)}})}applyOppoStyles(t){return e(this,void 0,void 0,function*(){try{switch(t.name.trim()){case"头图":yield this.adjustOppoHeaderModule(t);break;case"九宫格抽奖":console.log("匹配到九宫格抽奖模块，开始调整"),yield this.adjustOppoNineGridModule(t);break;case"尾版":yield this.adjustOppoFooterModule(t);break;default:console.log(`模块 "${t.name}" 无需OPPO特定样式调整`),console.log("可匹配的模块名称: 头图, 九宫格抽奖, 尾版")}}catch(e){console.error("OPPO样式调整失败:",e)}})}adjustOppoHeaderModule(t){return e(this,void 0,void 0,function*(){try{console.log("开始调整OPPO头图模块"),t.resize(t.width,1300);const e=H(t);if(e){const t=e.height-100;e.resize(e.width,t),e.y=e.y+150}const i=_(t);i&&(i.y=i.y+100),console.log("OPPO头图模块调整完成")}catch(e){console.error("调整OPPO头图模块失败:",e)}})}adjustOppoNineGridModule(t){return e(this,void 0,void 0,function*(){try{console.log("开始调整OPPO九宫格模块");if(!this.images.eggBreaking)return void console.log("未上传砸蛋样式图片，跳过九宫格模块调整");const e=function(e){const t=e.findOne(e=>"FRAME"===e.type&&"活动规则"===e.name);return t||null}(t);e&&e.remove();const i=function(e){const t=e.findOne(e=>"FRAME"===e.type&&"我的奖品"===e.name);return t||null}(t);i&&i.remove(),t.resize(t.width,1263);const o=function(e){const t=e.findOne(e=>"FRAME"===e.type&&"九宫格主体"===e.name);return t||null}(t);if(!o)return void console.warn("未找到九宫格主体容器");!function(e){try{[...e.children].forEach(t=>{a.safeRemoveNode(t,`清除${e.name}子节点`)})}catch(e){console.error("清除容器内容失败:",e)}}(o),o.resize(o.width,1053),yield this.insertEggBreakingImage(o,this.channel),yield u(o,t,{name:"立即抽奖",text:"立即抽奖",x:284,y:648,width:512,height:133,textFontSize:58}),yield u(o,t,{name:"我的奖品",text:"我的奖品",x:102,y:851,width:398,height:112,textFontSize:50}),yield u(o,t,{name:"活动规则",text:"活动规则",x:580,y:851,width:398,height:112,textFontSize:50}),console.log("OPPO九宫格模块调整完成")}catch(e){console.error("调整OPPO九宫格模块失败:",e)}})}adjustOppoFooterModule(t){return e(this,void 0,void 0,function*(){try{console.log("开始调整OPPO尾版模块");const e=this.images.footerStyle;if(e){try{t.resize(t.width,807),b(t);const i=yield R(e,"尾版样式");i.resize(1080,289),i.x=(t.width-1080)/2,i.y=122,a.safeAppendChild(t,i,"尾版样式图片添加"),console.log("尾版样式图片已插入:",e.name)}catch(e){console.error("插入尾版样式图片失败:",e)}return void console.log("OPPO尾版模块调整完成")}return}catch(e){console.error("调整OPPO尾版模块失败:",e)}})}insertEggBreakingImage(t,i){return e(this,void 0,void 0,function*(){try{const e=this.images.eggBreaking;if(e){const i=yield R(e,"砸蛋样式");i.resize(864,512),i.x=108,i.y=150,a.safeAppendChild(t,i,"砸蛋样式图片添加"),console.log("砸蛋样式图片已插入:",e.name)}else{const e=figma.createRectangle();e.name="砸蛋样式（占位）",e.resize(864,512),e.x=108,e.y=150,e.fills=[l.createSolidFill({r:.9,g:.8,b:.7})],a.safeAppendChild(t,e,"砸蛋样式占位图片添加"),console.log("砸蛋样式占位图片已插入")}}catch(e){console.error("插入砸蛋样式图片失败:",e)}})}applyVivoStyles(t){return e(this,void 0,void 0,function*(){try{switch(t.name.trim()){case"头图":yield this.adjustVivoHeaderModule(t);break;case"尾版":yield this.adjustVivoFooterModule(t);break;default:console.log(`模块 "${t.name}" 无需VIVO特定样式调整`),console.log("可匹配的模块名称: 头图, 九宫格抽奖, 尾版")}}catch(e){console.error("VIVO样式调整失败:",e)}})}adjustVivoHeaderModule(t){return e(this,void 0,void 0,function*(){try{console.log("开始调整VIVO头图模块"),t.resize(t.width,1300);const e=H(t);if(e){const t=e.height-100;e.resize(e.width,t),e.y=e.y+150}const i=_(t);i&&(i.y=i.y+100),console.log("VIVO头图模块调整完成")}catch(e){console.error("调整VIVO头图模块失败:",e)}})}adjustVivoFooterModule(t){return e(this,void 0,void 0,function*(){try{console.log("开始调整VIVO尾版模块");const e=this.images.footerStyle;if(e){try{t.resize(t.width,550),b(t);const i=yield R(e,"尾版样式");i.resize(1080,332),i.x=(t.width-1080)/2,i.y=0,a.safeAppendChild(t,i,"尾版样式图片添加"),console.log("尾版样式图片已插入:",e.name)}catch(e){console.error("插入尾版样式图片失败:",e)}return void console.log("VIVO尾版模块调整完成")}return}catch(e){console.error("调整VIVO尾版模块失败:",e)}})}applyHuaweiStyles(t){return e(this,void 0,void 0,function*(){console.log(`华为样式调整: ${t.name}`);try{if("头图"===t.name.trim())yield this.adjustHuaweiHeaderModule(t);else console.log(`模块 "${t.name}" 无需华为特定样式调整`),console.log("可匹配的模块名称: 头图, 九宫格抽奖, 尾版")}catch(e){console.error("华为样式调整失败:",e)}})}adjustHuaweiHeaderModule(t){return e(this,void 0,void 0,function*(){try{console.log("开始调整华为头图模块"),t.resize(t.width,1300);const e=H(t);if(e){const t=e.height-100;e.resize(e.width,t),e.y=e.y+150}const i=_(t);i&&(i.y=i.y+100),console.log("华为头图模块调整完成")}catch(e){console.error("调整华为头图模块失败:",e)}})}applyXiaomiStyles(t){return e(this,void 0,void 0,function*(){console.log(`小米样式调整: ${t.name}`);try{switch(t.name.trim()){case"头图":yield this.adjustXiaomiHeaderModule(t);break;case"尾版":yield this.adjustXiaomiFooterModule(t);break;default:console.log(`模块 "${t.name}" 无需小米特定样式调整`),console.log("可匹配的模块名称: 头图, 九宫格抽奖, 尾版")}}catch(e){console.error("小米样式调整失败:",e)}})}adjustXiaomiHeaderModule(t){return e(this,void 0,void 0,function*(){try{console.log("开始调整小米头图模块"),t.resize(t.width,800);const e=H(t);if(e){const t=e.height-250;e.resize(e.width,t)}const i=function(e){const t=e=>{if("标题图片"===e.name)return e;if("children"in e)for(const i of e.children){const e=t(i);if(e)return e}return null};return t(e)}(t);i&&i.remove(),console.log("小米头图模块调整完成")}catch(e){console.error("调整小米头图模块失败:",e)}})}adjustXiaomiFooterModule(t){return e(this,void 0,void 0,function*(){try{return console.log("开始调整小米尾版模块"),t.resize(t.width,300),b(t),void console.log("小米尾版模块调整完成")}catch(e){console.error("调整小米尾版模块失败:",e)}})}}function B(t,i){return e(this,void 0,void 0,function*(){try{console.log(`开始为${t}渠道生成H5原型`);const o=function(){try{const e=figma.currentPage.selection;if(0===e.length)return console.warn("未选中任何节点"),null;const t=e[0];return"FRAME"===t.type&&"H5原型"===t.name?(console.log("找到选中的H5原型容器"),t):(console.warn(`选中的节点不是H5原型容器，当前选中: ${t.name} (类型: ${t.type})`),null)}catch(e){return console.error("获取选中的原型容器失败:",e),null}}();if(!o)throw new Error('请先选中名为"H5原型"的容器');console.log("分析H5原型容器中的文本节点并加载字体..."),yield function(t){return e(this,void 0,void 0,function*(){try{console.log("开始分析H5原型容器中的文本节点...");const i=new Set,o=e=>{if("TEXT"===e.type){const t=e;if("object"==typeof t.fontName&&"family"in t.fontName){const e=`${t.fontName.family}|${t.fontName.style}`;i.add(e),console.log(`发现文本节点 "${t.name}" 使用字体: ${t.fontName.family} ${t.fontName.style}`)}else if(t.fontName===figma.mixed){const e=t.characters.length;for(let o=0;o<e;o++){const e=t.getRangeFontName(o,o+1),n=`${e.family}|${e.style}`;i.add(n)}console.log(`发现文本节点 "${t.name}" 使用混合字体`)}}if("children"in e)for(const t of e.children)o(t)};o(t),console.log(`共发现 ${i.size} 种字体需要加载`);const n=Array.from(i).map(t=>e(this,void 0,void 0,function*(){const[e,i]=t.split("|");try{yield figma.loadFontAsync({family:e,style:i}),console.log(`✓ 字体加载成功: ${e} ${i}`)}catch(t){console.warn(`✗ 字体加载失败: ${e} ${i}`,t)}}));yield Promise.all(n),console.log("所有字体加载完成")}catch(e){console.error("从原型容器加载字体时发生错误:",e)}})}(o),console.log("字体加载完成");const n=new w(t,o,i||{});yield n.generate(),console.log(`${t}渠道版本生成完成`)}catch(e){throw console.error(`生成${t}渠道版本失败:`,e),e}})}function H(e){const t=e=>{if("RECTANGLE"===e.type&&"蒙版"===e.name)return e;if("children"in e)for(const i of e.children){const e=t(i);if(e)return e}return null};return t(e)}function _(e){const t=e=>{if("头图图片"===e.name)return e;if("children"in e)for(const i of e.children){const e=t(i);if(e)return e}return null};return t(e)}function b(e){try{const t=e.findOne(e=>e.name.toLowerCase().includes("logo"));t&&a.safeRemoveNode(t,"清除尾版LOGO")}catch(e){console.error("清除尾版LOGO失败:",e)}}function R(t,i){return e(this,void 0,void 0,function*(){let e;if("string"==typeof t.data){const i=atob(t.data);e=new Uint8Array(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t)}else e=new Uint8Array(t.data);const o=figma.createRectangle();o.name=i,o.resize(t.width,t.height);const n={type:"IMAGE",imageHash:figma.createImage(e).hash,scaleMode:"FILL"};return o.fills=[n],o})}class M{constructor(){this.storage="undefined"!=typeof window?window.localStorage:null}static getInstance(){return M.instance||(M.instance=new M),M.instance}setItem(e,t){this.storage&&this.storage.setItem(e,t)}getItem(e){return this.storage?this.storage.getItem(e):null}removeItem(e){this.storage&&this.storage.removeItem(e)}clear(){this.storage&&this.storage.clear()}keys(){return this.storage?Object.keys(this.storage):[]}}class O{constructor(){this.storage=M.getInstance()}static getInstance(){return O.instance||(O.instance=new O),O.instance}getSystemTheme(){return"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}getCurrentTheme(){const e=this.storage.getItem(O.THEME_KEY);return"true"===this.storage.getItem(O.AUTO_THEME_KEY)?this.getSystemTheme():e||"light"}setTheme(e){this.storage.setItem(O.THEME_KEY,e),this.storage.setItem(O.AUTO_THEME_KEY,"false")}setAutoTheme(e){this.storage.setItem(O.AUTO_THEME_KEY,String(e)),e&&this.setTheme(this.getSystemTheme())}isAutoThemeEnabled(){return"true"===this.storage.getItem(O.AUTO_THEME_KEY)}}O.THEMES=["light","dark"],O.THEME_KEY="theme",O.AUTO_THEME_KEY="autoTheme";var L=Object.freeze({__proto__:null,ThemeService:O});let G=class{static saveConfig(t){return e(this,void 0,void 0,function*(){try{const e=JSON.stringify(t);this.storage.setItem(this.STORAGE_KEY,e)}catch(e){throw console.error("保存配置失败:",e),new Error("保存配置失败")}})}static loadConfig(){return e(this,void 0,void 0,function*(){try{const e=this.storage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch(e){return console.error("加载配置失败:",e),null}})}static clearConfig(){return e(this,void 0,void 0,function*(){try{this.storage.removeItem(this.STORAGE_KEY)}catch(e){console.error("清除配置失败:",e)}})}static validateConfig(e){var t,i,o,n,r,s;const l=[];switch((null===(t=e.pageTitle)||void 0===t?void 0:t.trim())||l.push("页面标题不能为空"),(null===(i=e.gameName)||void 0===i?void 0:i.trim())||l.push("游戏名称不能为空"),e.buttonVersion||l.push("请选择按钮版本"),e.buttonVersion){case"icon":(null===(o=e.iconButtonText)||void 0===o?void 0:o.trim())||l.push("带图标按钮文本不能为空");break;case"single":(null===(n=e.singleButtonText)||void 0===n?void 0:n.trim())||l.push("单按钮文本不能为空");break;case"double":(null===(r=e.leftButtonText)||void 0===r?void 0:r.trim())||l.push("左侧按钮文本不能为空"),(null===(s=e.rightButtonText)||void 0===s?void 0:s.trim())||l.push("右侧按钮文本不能为空")}return{isValid:0===l.length,errors:l}}static createDefaultConfig(){return{pageTitle:"活动页面",pageBgColor:"#ffffff",pageBgImage:null,headerImage:null,titleUpload:null,gameIcon:null,gameName:"游戏名称",gameDesc:"游戏描述",gameTextColor:"#333333",buttonVersion:"single",iconButtonText:"立即下载",iconButtonTextColor:"#ffffff",iconButtonBg:null,singleButtonText:"立即下载",singleButtonTextColor:"#ffffff",singleButtonBg:null,leftButtonText:"预约游戏",leftButtonTextColor:"#ffffff",leftButtonBg:null,rightButtonText:"立即下载",rightButtonTextColor:"#ffffff",rightButtonBg:null,buttonSpacing:20,modules:[],rulesTitle:"活动规则",rulesBgImage:null,rulesContent:"请填写活动规则内容",footerLogo:null,footerBg:null,canvasWidth:1080,canvasHeight:1920}}};G.STORAGE_KEY="h5-tools-config",G.storage=M.getInstance();var $=Object.freeze({__proto__:null,ConfigService:G});class N{static saveChannelImage(t,i,o){return e(this,void 0,void 0,function*(){try{const e=yield this.loadAllChannelImages();e[t]||(e[t]={}),e[t][i]=Object.assign(Object.assign({},o),{timestamp:Date.now()});this.calculateStorageSize(e)>this.MAX_STORAGE_SIZE&&(yield this.clearExpiredChannelImages());const n=JSON.stringify(e);this.storage.setItem(this.STORAGE_KEY,n)}catch(e){throw console.error("保存渠道图片失败:",e),new Error("保存渠道图片失败")}})}static loadAllChannelImages(){return e(this,void 0,void 0,function*(){try{const e=this.storage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):{}}catch(e){return console.error("加载渠道图片失败:",e),{}}})}static loadChannelImages(t){return e(this,void 0,void 0,function*(){return(yield this.loadAllChannelImages())[t]||{}})}static deleteChannelImage(t,i){return e(this,void 0,void 0,function*(){try{const e=yield this.loadAllChannelImages();if(e[t]&&e[t][i]){delete e[t][i],0===Object.keys(e[t]).length&&delete e[t];const o=JSON.stringify(e);this.storage.setItem(this.STORAGE_KEY,o)}}catch(e){console.error("删除渠道图片失败:",e)}})}static clearAllChannelImages(){return e(this,void 0,void 0,function*(){try{this.storage.removeItem(this.STORAGE_KEY)}catch(e){console.error("清除所有渠道图片失败:",e)}})}static clearExpiredChannelImages(){return e(this,void 0,void 0,function*(){try{const e=yield this.loadAllChannelImages(),t=Date.now(),i=6048e5;let o=!1;for(const n in e){const r=e[n];for(const e in r){t-r[e].timestamp>i&&(delete r[e],o=!0)}0===Object.keys(r).length&&delete e[n]}if(o){const t=JSON.stringify(e);this.storage.setItem(this.STORAGE_KEY,t)}}catch(e){console.error("清除过期渠道图片失败:",e)}})}static calculateStorageSize(e){return new Blob([JSON.stringify(e)]).size}static getStorageUsage(){return e(this,void 0,void 0,function*(){try{const e=yield this.loadAllChannelImages(),t=this.calculateStorageSize(e),i=t/this.MAX_STORAGE_SIZE*100;return{used:t,max:this.MAX_STORAGE_SIZE,percentage:i}}catch(e){return console.error("获取存储使用情况失败:",e),{used:0,max:this.MAX_STORAGE_SIZE,percentage:0}}})}}N.STORAGE_KEY="h5-tools-channel-images",N.MAX_STORAGE_SIZE=52428800,N.storage=M.getInstance();var z=Object.freeze({__proto__:null,ChannelImageService:N});var U=Object.freeze({__proto__:null,ValidationService:class{static validateH5Config(e){var t,i,o,n,r,s;const l=[];if((null===(t=e.pageTitle)||void 0===t?void 0:t.trim())||l.push("页面标题不能为空"),(null===(i=e.gameName)||void 0===i?void 0:i.trim())||l.push("游戏名称不能为空"),e.buttonVersion)switch(e.buttonVersion){case"icon":(null===(o=e.iconButtonText)||void 0===o?void 0:o.trim())||l.push("带图标按钮文本不能为空");break;case"single":(null===(n=e.singleButtonText)||void 0===n?void 0:n.trim())||l.push("单按钮文本不能为空");break;case"double":(null===(r=e.leftButtonText)||void 0===r?void 0:r.trim())||l.push("左侧按钮文本不能为空"),(null===(s=e.rightButtonText)||void 0===s?void 0:s.trim())||l.push("右侧按钮文本不能为空");break;default:l.push("无效的按钮版本")}else l.push("请选择按钮版本");return e.canvasWidth&&e.canvasWidth<320&&l.push("画布宽度不能小于320px"),e.canvasHeight&&e.canvasHeight<480&&l.push("画布高度不能小于480px"),{isValid:0===l.length,errors:l}}static validateImageData(e){var t,i;const o=[];return e.data||o.push("图片数据不能为空"),(null===(t=e.name)||void 0===t?void 0:t.trim())||o.push("图片名称不能为空"),(null===(i=e.type)||void 0===i?void 0:i.trim())||o.push("图片类型不能为空"),(!e.width||e.width<=0)&&o.push("图片宽度必须大于0"),(!e.height||e.height<=0)&&o.push("图片高度必须大于0"),(!e.size||e.size<=0)&&o.push("图片大小必须大于0"),(!e.timestamp||e.timestamp<=0)&&o.push("图片时间戳无效"),{isValid:0===o.length,errors:o}}static validateChannelName(e){return/^[a-zA-Z0-9_-]{2,50}$/.test(e)}}});class k{static isFigmaEnvironment(){return"undefined"!=typeof figma&&!!figma.clientStorage}static setItem(t,i){return e(this,void 0,void 0,function*(){this.isFigmaEnvironment()?yield figma.clientStorage.setAsync(t,i):localStorage.setItem(t,i)})}static getItem(t){return e(this,void 0,void 0,function*(){return this.isFigmaEnvironment()?(yield figma.clientStorage.getAsync(t))||null:localStorage.getItem(t)})}static removeItem(t){return e(this,void 0,void 0,function*(){this.isFigmaEnvironment()?yield figma.clientStorage.deleteAsync(t):localStorage.removeItem(t)})}static getAllKeys(){return e(this,void 0,void 0,function*(){if(this.isFigmaEnvironment()){const e=(yield figma.clientStorage.getAsync("__storage_keys__"))||"[]";return JSON.parse(e)}return Object.keys(localStorage)})}}class P{static saveConfig(t){return e(this,void 0,void 0,function*(){try{const e=JSON.stringify(t);yield k.setItem(this.STORAGE_KEY,e)}catch(e){throw console.error("保存配置失败:",e),new Error("保存配置失败")}})}static loadConfig(){return e(this,void 0,void 0,function*(){try{const e=yield k.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch(e){return console.error("加载配置失败:",e),null}})}static clearConfig(){return e(this,void 0,void 0,function*(){try{yield k.removeItem(this.STORAGE_KEY)}catch(e){console.error("清除配置失败:",e)}})}static validateConfig(e){var t,i,o,n,r,s;const l=[];switch((null===(t=e.pageTitle)||void 0===t?void 0:t.trim())||l.push("页面标题不能为空"),(null===(i=e.gameName)||void 0===i?void 0:i.trim())||l.push("游戏名称不能为空"),e.buttonVersion||l.push("请选择按钮版本"),e.buttonVersion){case"icon":(null===(o=e.iconButtonText)||void 0===o?void 0:o.trim())||l.push("带图标按钮文本不能为空");break;case"single":(null===(n=e.singleButtonText)||void 0===n?void 0:n.trim())||l.push("单按钮文本不能为空");break;case"double":(null===(r=e.leftButtonText)||void 0===r?void 0:r.trim())||l.push("左侧按钮文本不能为空"),(null===(s=e.rightButtonText)||void 0===s?void 0:s.trim())||l.push("右侧按钮文本不能为空")}return{isValid:0===l.length,errors:l}}static createDefaultConfig(){return{pageTitle:"活动页面",pageBgColor:"#ffffff",pageBgImage:null,headerImage:null,titleUpload:null,gameIcon:null,gameName:"游戏名称",gameDesc:"游戏描述",gameTextColor:"#333333",buttonVersion:"single",iconButtonText:"立即下载",iconButtonTextColor:"#ffffff",iconButtonBg:null,singleButtonText:"立即下载",singleButtonTextColor:"#ffffff",singleButtonBg:null,leftButtonText:"预约游戏",leftButtonTextColor:"#ffffff",leftButtonBg:null,rightButtonText:"立即下载",rightButtonTextColor:"#ffffff",rightButtonBg:null,buttonSpacing:20,modules:[],rulesTitle:"活动规则",rulesBgImage:null,rulesContent:"请填写活动规则内容",footerLogo:null,footerBg:null,canvasWidth:1080,canvasHeight:1920}}}P.STORAGE_KEY="h5-tools-config";class D{static initialize(){return e(this,void 0,void 0,function*(){yield Promise.all([this.config.loadConfig(),this.theme.getInstance(),this.channelImage.clearExpiredChannelImages()])})}static getSystemStatus(){return e(this,void 0,void 0,function*(){const[e,t,i]=yield Promise.all([this.config.loadConfig(),this.theme.getInstance(),this.channelImage.getStorageUsage()]);return{configLoaded:!!e,theme:yield t.getCurrentTheme(),storageUsage:i}})}}D.config={loadConfig:()=>e(void 0,void 0,void 0,function*(){const{ConfigService:e}=yield Promise.resolve().then(function(){return $});return e.loadConfig()})},D.theme={getInstance:()=>e(void 0,void 0,void 0,function*(){const{ThemeService:e}=yield Promise.resolve().then(function(){return L});return e.getInstance()})},D.channelImage={clearExpiredChannelImages:()=>e(void 0,void 0,void 0,function*(){const{ChannelImageService:e}=yield Promise.resolve().then(function(){return z});return e.clearExpiredChannelImages()}),getStorageUsage:()=>e(void 0,void 0,void 0,function*(){const{ChannelImageService:e}=yield Promise.resolve().then(function(){return z});return e.getStorageUsage()})},D.validation={validateH5Config:t=>e(void 0,void 0,void 0,function*(){const{ValidationService:e}=yield Promise.resolve().then(function(){return U});return e.validateH5Config(t)})};const V=new class{handleMessage(t){return e(this,void 0,void 0,function*(){try{let e,i;switch(t.type){case"create-prototype":case"generate":if(!t.config)throw new Error("配置信息不能为空");yield this.handleCreatePrototype(t.config);break;case"save-config":if(!t.config)throw new Error("配置信息不能为空");yield this.handleSaveConfig(t.config);break;case"load-config":yield this.handleLoadConfig();break;case"channel-image-upload":yield this.handleChannelImageUpload(t);break;case"channel-generate":yield this.handleGenerateChannelVersion(t);break;case"storage-set":if(e=t,!e.key||void 0===e.value)throw new Error("存储键和值不能为空");yield this.handleStorageSet(e.key,e.value);break;case"storage-delete":if(i=t,!i.key)throw new Error("存储键不能为空");yield this.handleStorageDelete(i.key);break;case"storage-get":const o=t;if(!o.key)throw new Error("存储键不能为空");yield this.handleStorageGet(o.key,o._messageId);break;case"ui-loaded":console.log("UI界面已加载");break;case"ui-ready":console.log("UI界面已就绪");break;default:console.warn("未知消息类型:",t.type)}}catch(e){console.error("处理消息失败:",e),figma.ui.postMessage({type:"error",message:`操作失败: ${e instanceof Error?e.message:String(e)}`})}})}handleCreatePrototype(t){return e(this,void 0,void 0,function*(){try{console.log("开始创建H5原型..."),yield function(t){return e(this,void 0,void 0,function*(){return new S(t).build()})}(t),figma.ui.postMessage({type:"prototype-created",message:"H5原型创建成功！"}),console.log("H5原型创建完成")}catch(e){throw console.error("创建H5原型失败:",e),figma.ui.postMessage({type:"error",message:`创建H5原型失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleSaveConfig(t){return e(this,void 0,void 0,function*(){try{yield P.saveConfig(t),figma.ui.postMessage({type:"config-saved",message:"配置保存成功"})}catch(e){throw console.error("保存配置失败:",e),figma.ui.postMessage({type:"error",message:`保存配置失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleLoadConfig(){return e(this,void 0,void 0,function*(){try{const e=yield P.loadConfig();figma.ui.postMessage({type:"config-loaded",config:e})}catch(e){throw console.error("加载配置失败:",e),figma.ui.postMessage({type:"error",message:`加载配置失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleChannelImageUpload(t){return e(this,void 0,void 0,function*(){try{console.log("渠道图片上传:",{channel:t.channel,imageType:t.imageType,imageData:t.imageData}),figma.ui.postMessage({type:"channel-image-uploaded",message:"渠道图片上传成功"})}catch(e){throw console.error("渠道图片上传失败:",e),figma.ui.postMessage({type:"error",message:`渠道图片上传失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleGenerateChannelVersion(t){return e(this,void 0,void 0,function*(){try{console.log("开始生成渠道版本:",t.channel,t.images),yield B(t.channel,t.images),figma.ui.postMessage({type:"channel-version-generated",message:`${t.channel.toUpperCase()}渠道版本生成成功`}),console.log(`${t.channel}渠道版本生成完成`)}catch(e){throw console.error("生成渠道版本失败:",e),figma.ui.postMessage({type:"error",message:`生成${t.channel.toUpperCase()}渠道版本失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleStorageSet(t,i){return e(this,void 0,void 0,function*(){try{yield figma.clientStorage.setAsync(t,i),console.log(`✅ Figma存储设置成功: ${t}`)}catch(e){console.error(`Figma存储设置失败 ${t}:`,e)}})}handleStorageDelete(t){return e(this,void 0,void 0,function*(){try{yield figma.clientStorage.deleteAsync(t),console.log(`✅ Figma存储删除成功: ${t}`)}catch(e){console.error(`Figma存储删除失败 ${t}:`,e)}})}handleStorageGet(t,i){return e(this,void 0,void 0,function*(){try{const e=yield figma.clientStorage.getAsync(t);console.log(`✅ Figma存储获取成功: ${t}`,e),figma.ui.postMessage({type:"storage-get-response",key:t,value:e,_messageId:i})}catch(e){console.error(`Figma存储获取失败 ${t}:`,e),figma.ui.postMessage({type:"error",message:`获取存储失败: ${e instanceof Error?e.message:String(e)}`,key:t,_messageId:i})}})}};figma.showUI(__html__,{width:360,height:700}),figma.ui.onmessage=t=>e(void 0,void 0,void 0,function*(){yield V.handleMessage(t)}),console.log("H5Tools插件已启动");
//# sourceMappingURL=code-standalone.js.map

function e(e,t,i,o){return new(i||(i=Promise))(function(n,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function l(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,l)}a((o=o.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const t=1080;var i,o;!function(e){e.HEADER="header",e.GAME_INFO="gameInfo",e.FOOTER="footer",e.ACTIVITY_CONTENT="activityContent",e.SIGN_IN="signIn",e.COLLECT_CARDS="collectCards",e.NINE_GRID="nineGrid",e.CAROUSEL="carousel",e.VERTICAL_CAROUSEL="verticalCarousel",e.RULES="rules",e.CUSTOM="custom"}(i||(i={})),function(e){e.OPPO="oppo",e.VIVO="vivo",e.HUAWEI="huawei",e.XIAOMI="xiaomi"}(o||(o={}));class n{static delay(t){return e(this,void 0,void 0,function*(){return new Promise(e=>setTimeout(e,t))})}static extractUint8Array(e){return e?e instanceof Uint8Array?e:"object"==typeof e&&"data"in e?e.data:null:null}static hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:0,g:0,b:0}}static calculateSliceStrategy(e,t,i){const o=e*t,n=i*i;if(o<=n)return{needsSlicing:!1,slices:[]};const r=Math.ceil(Math.sqrt(o/n)),s=Math.ceil(e/r),l=Math.ceil(t/r),a=[];for(let i=0;i<r;i++)for(let o=0;o<r;o++){const n=o*s,r=i*l,c=Math.min(s,e-n),h=Math.min(l,t-r);c>0&&h>0&&a.push({x:n,y:r,width:c,height:h,row:i,col:o})}return{needsSlicing:!0,slices:a,totalWidth:e,totalHeight:t,sliceWidth:s,sliceHeight:l,rows:r,cols:r}}static getPrizePosition(e){return[{row:0,col:0},{row:0,col:1},{row:0,col:2},{row:1,col:2},{row:2,col:2},{row:2,col:1},{row:2,col:0},{row:1,col:0}][e]||{row:0,col:0}}static safeNumber(e,t=0){const i=Number(e);return isNaN(i)?t:i}static safeString(e,t=""){return null!=e?String(e):t}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static deepClone(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map(e=>n.deepClone(e));if("object"==typeof e){const t={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=n.deepClone(e[i]));return t}return e}}class r{static isValidImageType(e){return-1!==["image/png","image/jpeg","image/jpg","image/gif","image/webp"].indexOf(e.toLowerCase())}static getImageExtension(e){return{"image/png":"png","image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/webp":"webp"}[e.toLowerCase()]||"png"}static calculateScale(e,t,i,o,n="fit"){const r=i/e,s=o/t;let l;return l="fit"===n?Math.min(r,s):Math.max(r,s),{scale:l,width:e*l,height:t*l}}static isOversized(e,t,i=4096){return e>i||t>i}static calculateSliceStrategy(e,t,i=4096){const o={direction:"none",sliceWidth:e,sliceHeight:t,slicesCount:1,description:"",cols:1,rows:1,totalSlices:1},n=e>i,r=t>i;return n||r?(n&&!r?(o.direction="vertical",o.sliceWidth=Math.floor(.9*i),o.sliceHeight=t,o.cols=Math.ceil(e/o.sliceWidth),o.rows=1,o.slicesCount=o.cols,o.totalSlices=o.cols,o.description=`å®½åº¦è¶…é™ï¼Œå‚ç›´åˆ‡å‰²ä¸º${o.slicesCount}ç‰‡ï¼Œæ¯ç‰‡${o.sliceWidth}Ã—${t}`):!n&&r?(o.direction="horizontal",o.sliceWidth=e,o.sliceHeight=Math.floor(.9*i),o.cols=1,o.rows=Math.ceil(t/o.sliceHeight),o.slicesCount=o.rows,o.totalSlices=o.rows,o.description=`é«˜åº¦è¶…é™ï¼Œæ°´å¹³åˆ‡å‰²ä¸º${o.slicesCount}ç‰‡ï¼Œæ¯ç‰‡${e}Ã—${o.sliceHeight}`):(o.direction="both",o.sliceWidth=Math.floor(.9*i),o.sliceHeight=Math.floor(.9*i),o.cols=Math.ceil(e/o.sliceWidth),o.rows=Math.ceil(t/o.sliceHeight),o.slicesCount=o.cols*o.rows,o.totalSlices=o.cols*o.rows,o.description=`å®½é«˜éƒ½è¶…é™ï¼Œç½‘æ ¼åˆ‡å‰²ä¸º${o.cols}Ã—${o.rows}=${o.slicesCount}ç‰‡`),o):(o.description="å›¾ç‰‡å°ºå¯¸æ­£å¸¸ï¼Œæ— éœ€åˆ‡å‰²",o)}}class s{static loadAll(){return e(this,void 0,void 0,function*(){const t=this.fonts.map(t=>e(this,void 0,void 0,function*(){try{return yield figma.loadFontAsync(t),{success:!0,font:t}}catch(e){return{success:!1,font:t,error:e}}})),i=(yield Promise.all(t)).filter(e=>!e.success).map(e=>e.font);i.length>0&&console.warn("éƒ¨åˆ†å­—ä½“åŠ è½½å¤±è´¥:",i)})}static loadSingle(t){return e(this,void 0,void 0,function*(){try{yield figma.loadFontAsync(t)}catch(e){console.warn(`å­—ä½“åŠ è½½å¤±è´¥: ${t.family} ${t.style}`,e)}})}static loadInterFonts(){return e(this,void 0,void 0,function*(){return this.loadAll()})}}s.fonts=[{family:"Inter",style:"Regular"},{family:"Inter",style:"Medium"},{family:"Inter",style:"Bold"}];class l{static hexToRgb(e){if(!e||"string"!=typeof e||""===e.trim())return console.warn("ColorUtils.hexToRgb: æ— æ•ˆçš„é¢œè‰²å€¼ï¼Œä½¿ç”¨é»˜è®¤ç™½è‰²",e),{r:1,g:1,b:1};const t=(4===e.length?"#"+e.slice(1).split("").map(e=>e+e).join(""):e).replace("#","");return/^[0-9A-Fa-f]{6}$/.test(t)?{r:parseInt(t.substring(0,2),16)/255,g:parseInt(t.substring(2,4),16)/255,b:parseInt(t.substring(4,6),16)/255}:(console.warn("ColorUtils.hexToRgb: æ— æ•ˆçš„åå…­è¿›åˆ¶é¢œè‰²æ ¼å¼ï¼Œä½¿ç”¨é»˜è®¤ç™½è‰²",e),{r:1,g:1,b:1})}static createSolidFill(e,t=1){return{type:"SOLID",color:e,opacity:t}}}class a{static createFrame(e,t,i){const o=figma.createFrame();return o.name=e,o.resize(t,i),o}static createText(t,i){return e(this,arguments,void 0,function*(e,t,i="Regular"){const o=figma.createText(),n={family:"Inter",style:i};return yield s.loadSingle(n),o.characters=e,o.fontSize=t,o.fontName=n,o})}static setupAutoLayout(e,t="VERTICAL",i=0,o=0){e.layoutMode=t,e.primaryAxisSizingMode="AUTO",e.counterAxisSizingMode="FIXED",e.itemSpacing=i,e.paddingTop=o,e.paddingBottom=o,e.paddingLeft=o,e.paddingRight=o,e.primaryAxisAlignItems="MIN",e.counterAxisAlignItems="CENTER"}static safeAppendChild(e,t,i="èŠ‚ç‚¹æ·»åŠ "){try{return e?t?(e.appendChild(t),!0):(console.warn(`${i}: å­èŠ‚ç‚¹æ— æ•ˆ`),!1):(console.warn(`${i}: çˆ¶èŠ‚ç‚¹æ— æ•ˆ`),!1)}catch(e){return console.error(`${i}å¤±è´¥:`,e),!1}}static safeBatchAppendChildren(e,t,i="æ‰¹é‡èŠ‚ç‚¹æ·»åŠ "){let o=0;return t.forEach((t,n)=>{t&&this.safeAppendChild(e,t,`${i}[${n}]`)&&o++}),o}static safeRemoveNode(e,t="èŠ‚ç‚¹ç§»é™¤"){try{return e?e.parent?(e.remove(),!0):(console.warn(`${t}: èŠ‚ç‚¹æ²¡æœ‰çˆ¶èŠ‚ç‚¹`),!1):(console.warn(`${t}: èŠ‚ç‚¹æ— æ•ˆ`),!1)}catch(e){return console.error(`${t}å¤±è´¥:`,e),!1}}}class c{static createImage(t){return e(this,void 0,void 0,function*(){try{return figma.createImage(t)}catch(e){return console.error("å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e),null}})}static createLargeImage(t,i,o){return e(this,arguments,void 0,function*(e,t,i,o="å¤§å›¾ç‰‡"){try{const n=figma.createRectangle();return n.name=o,n.resize(t,i),yield this.fillTheSelection(n,e),n}catch(e){return console.error("å¤§å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e),null}})}static fillTheSelection(t,i){return e(this,void 0,void 0,function*(){try{const e=yield this.createImage(i);e?t.fills=[{type:"IMAGE",imageHash:e.hash,scaleMode:"FILL"}]:(t.fills=[l.createSolidFill({r:.9,g:.9,b:.9})],console.warn("å›¾ç‰‡è¿‡å¤§ï¼Œä½¿ç”¨é»˜è®¤å¡«å……"))}catch(e){console.error("å¡«å……å›¾ç‰‡å¤±è´¥:",e),t.fills=[l.createSolidFill({r:.9,g:.9,b:.9})]}})}static createImageFill(t){return e(this,arguments,void 0,function*(e,t="FILL"){const i=yield this.createImage(e);return i?{type:"IMAGE",imageHash:i.hash,scaleMode:t}:l.createSolidFill({r:.9,g:.9,b:.9})})}static insertImage(t,i){return e(this,arguments,void 0,function*(e,t,i=800,o=600){try{let n,s,l;if(e&&"object"==typeof e&&"data"in e)n=e.data,s=e.width,l=e.height;else{if(!(e instanceof Uint8Array))return console.warn(`å›¾ç‰‡æ•°æ®æ ¼å¼é”™è¯¯: ${t}`),null;n=e,s=i,l=o}if(!n||0===n.length)return console.warn(`å›¾ç‰‡æ•°æ®ä¸ºç©º: ${t}`),null;const a=4096;if(r.isOversized(s,l,a))return yield this.handleOversizedImage(n,s,l,t);const c=yield this.createImage(n);if(c){const e=figma.createRectangle();return e.name=t,e.resize(s,l),e.fills=[{type:"IMAGE",imageHash:c.hash,scaleMode:"FILL"}],e}return console.warn(`å›¾ç‰‡åˆ›å»ºå¤±è´¥: ${t}ï¼Œåˆ›å»ºå ä½çŸ©å½¢`),this.createPlaceholderRect(s,l,t,"å›¾ç‰‡åˆ›å»ºå¤±è´¥")}catch(e){return console.error(`å›¾ç‰‡æ’å…¥å¤±è´¥: ${t}`,e),null}})}static handleOversizedImage(t,i,o,n){return e(this,void 0,void 0,function*(){return new Promise(s=>{const l=setTimeout(()=>{console.warn(`å›¾ç‰‡åˆ†å‰²è¶…æ—¶: ${n}`),s(this.createPlaceholderRect(i,o,n,"å›¾ç‰‡å°ºå¯¸è¿‡å¤§"))},15e3),a=r.calculateSliceStrategy(i,o,4096),c={direction:a.direction,sliceWidth:a.sliceWidth,sliceHeight:a.sliceHeight,slicesCount:a.slicesCount,description:a.description};figma.ui.postMessage({type:"slice-large-image",imageData:{bytes:Array.from(t),width:i,height:o,name:n,type:"image/png"},sliceWidth:c.sliceWidth,sliceHeight:c.sliceHeight,sliceStrategy:c});const h=t=>e(this,void 0,void 0,function*(){if("slice-image-response"===t.type&&t.imageName===n){if(clearTimeout(l),t.success&&t.slices&&t.slices.length>0)try{const e=yield this.assembleSlicedImage(t.slices,i,o,n,c);s(e)}catch(e){console.error(`å›¾ç‰‡ç»„è£…å¤±è´¥: ${n}`,e),s(this.createPlaceholderRect(i,o,n,"å›¾ç‰‡ç»„è£…å¤±è´¥"))}else console.warn(`å›¾ç‰‡åˆ‡ç‰‡å¤±è´¥: ${n}`,t.error||"æœªçŸ¥é”™è¯¯"),s(this.createPlaceholderRect(i,o,n,"å›¾ç‰‡åˆ‡ç‰‡å¤±è´¥"));figma.ui.off("message",h)}});figma.ui.on("message",h),setTimeout(()=>{figma.ui.off("message",h)},16e3)})})}static assembleSlicedImage(t,i,o,n,r){return e(this,void 0,void 0,function*(){try{figma.notify(`æ­£åœ¨ç»„è£…å›¾ç‰‡: ${n} (${r.description})`,{timeout:2e3});const e=[];for(let i=0;i<t.length;i++){const o=t[i],r=new Uint8Array(o.bytes);try{const t=yield this.createImage(r);if(t){const r=figma.createRectangle();r.name=`${n}_slice_${i+1}`,r.resize(o.width,o.height),r.x=o.x,r.y=o.y,r.fills=[{type:"IMAGE",imageHash:t.hash,scaleMode:"FILL"}],e.push(r)}else console.warn(`åˆ‡ç‰‡ ${i+1} å›¾ç‰‡åˆ›å»ºå¤±è´¥ï¼Œè·³è¿‡æ­¤åˆ‡ç‰‡`)}catch(e){console.error(`åˆ‡ç‰‡ ${i+1} å¤„ç†å¤±è´¥:`,e)}}if(!(e.length>0))throw new Error("æ²¡æœ‰æˆåŠŸåˆ›å»ºä»»ä½•åˆ‡ç‰‡");try{const t=a.safeBatchAppendChildren(figma.currentPage,e,"å›¾ç‰‡åˆ‡ç‰‡æ‰¹é‡æ·»åŠ åˆ°é¡µé¢");t!==e.length&&console.warn(`éƒ¨åˆ†åˆ‡ç‰‡æ·»åŠ å¤±è´¥ï¼ŒæˆåŠŸï¼š${t}/${e.length}`);const i=figma.group(e,figma.currentPage);return i.name=n,i.x=0,i.y=0,figma.notify(`å›¾ç‰‡ç»„è£…å®Œæˆ: ${n}`,{timeout:1e3}),i}catch(t){throw console.error("åˆ›å»ºåˆ†ç»„å¤±è´¥:",t),e.forEach((e,t)=>{a.safeRemoveNode(e,`æ¸…ç†å›¾ç‰‡åˆ‡ç‰‡${t+1}`)}),t}}catch(e){throw console.error("å›¾ç‰‡ç»„è£…å¤±è´¥:",e),e}})}static createPlaceholderRect(e,t,i,o="æœªçŸ¥åŸå› "){const n=figma.createRectangle();n.name=`${i} (å ä½)`,n.resize(e,t);const r=o.includes("å°ºå¯¸è¿‡å¤§")?{r:1,g:.9,b:.8}:{r:.95,g:.95,b:.95};n.fills=[l.createSolidFill(r)];try{s.loadSingle({family:"Inter",style:"Regular"}).then(()=>{const r=figma.createText();r.fontName={family:"Inter",style:"Regular"},r.characters=`${i}\n${e}Ã—${t}\n${o}`,r.fontSize=Math.min(Math.max(12,e/50),20),r.fills=[l.createSolidFill({r:.4,g:.4,b:.4})],r.textAlignHorizontal="CENTER",r.textAlignVertical="CENTER",n.parent&&(r.x=n.x+(e-r.width)/2,r.y=n.y+(t-r.height)/2,a.safeAppendChild(n.parent,r,"å ä½çŸ©å½¢æ–‡æœ¬æ·»åŠ "))}).catch(()=>{console.warn("å ä½æ–‡æœ¬åˆ›å»ºå¤±è´¥")})}catch(e){console.warn("å ä½æ–‡æœ¬æ·»åŠ å¤±è´¥:",e)}return n}static setImageFill(t,i){return e(this,arguments,void 0,function*(e,t,i="FILL"){if(!t)return;const o=n.extractUint8Array(t);if(o)try{const t=yield this.createImageFill(o,i);e.fills=[t]}catch(e){console.error("è®¾ç½®å›¾ç‰‡å¡«å……å¤±è´¥:",e)}})}}function h(t){return e(this,void 0,void 0,function*(){try{const e=t.parent;if(!e||"FRAME"!==e.type)return null;const i=e.findOne(e=>"FRAME"===e.type&&"æ¸¸æˆä¿¡æ¯"===e.name);if(!i)return null;const o=e=>{if("æŒ‰é’®åº•å›¾"===e.name){if("clone"in e){return e.clone()}return null}if("children"in e)for(const t of e.children){const e=o(t);if(e)return e}return null};return o(i)}catch(e){return console.error("findAndCloneButtonImageFromGameInfoå¤±è´¥:",e),null}})}function d(e){try{const t=e.parent;if(!t||"FRAME"!==t.type)return null;const i=t.findOne(e=>"FRAME"===e.type&&"æ¸¸æˆä¿¡æ¯"===e.name);if(!i)return null;const o=e=>{if("TEXT"===e.type&&e.parent&&"name"in e.parent&&"ä¸‹è½½æŒ‰é’®"===e.parent.name)return e;if("children"in e)for(const t of e.children){const e=o(t);if(e)return e}return null},n=o(i);return n?{fontName:n.fontName,fills:JSON.parse(JSON.stringify(n.fills))}:null}catch(e){return console.error("è·å–ä¸‹è½½æŒ‰é’®æ–‡æœ¬æ ·å¼å¤±è´¥:",e),null}}function u(t,i,o){return e(this,void 0,void 0,function*(){var e;const n=a.createFrame(o.name,o.width,o.height);n.x=o.x,n.y=o.y,n.fills=[];const r=yield h(i);r&&(r.resize(o.width,o.height),r.x=(n.width-r.width)/2,r.y=(n.height-r.height)/2,a.safeAppendChild(n,r,`${o.text}æŒ‰é’®å›¾ç‰‡æ·»åŠ `));const s=d(i),c=figma.createText();return c.name=`${o.text}æ–‡æœ¬`,c.characters=o.text,s?(c.fontName=s.fontName,c.fills=s.fills):(c.fontName={family:"Inter",style:"Bold"},c.fills=[l.createSolidFill({r:1,g:1,b:1})]),c.fontSize=null!==(e=o.textFontSize)&&void 0!==e?e:50,c.textAlignHorizontal="CENTER",c.textAlignVertical="CENTER",c.x=(n.width-c.width)/2,c.y=(n.height-c.height)/2,a.safeAppendChild(n,c,`${o.text}æ–‡æœ¬æ·»åŠ `),a.safeAppendChild(t,n,`${o.text}å®¹å™¨æ·»åŠ `),n})}function g(t,i){return e(this,void 0,void 0,function*(){if(!t&&i)return null;if(!t&&!i)return null;const o=a.createFrame("å¤´å›¾",1080,1080);o.clipsContent=!0,o.fills=[],o.layoutMode="NONE";let n=0,r=null,s=null;if(t)try{const e=yield c.insertImage(t,"å¤´å›¾å›¾ç‰‡");r=e&&"strokeCap"in e?e:null,r&&(a.safeAppendChild(o,r,"å¤´å›¾å›¾ç‰‡æ·»åŠ åˆ°ç”»æ¿"),r.constraints={horizontal:"CENTER",vertical:"MIN"},r.x=(o.width-r.width)/2,r.y=n,n=r.height)}catch(e){console.error("å¤´å›¾åˆ›å»ºå¤±è´¥:",e)}if(function(e,t,i){t&&!i?e.resize(1080,t.height):t&&i&&(e.resize(1080,t.height),i.y=t.height-i.height,i.constraints={horizontal:"CENTER",vertical:"MAX"})}(o,r,s),r)try{yield function(t,i){return e(this,void 0,void 0,function*(){try{if(!t||!t.parent)return void console.warn("å¤´å›¾èŠ‚ç‚¹ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤ï¼Œè·³è¿‡ç¾½åŒ–è’™ç‰ˆå¤„ç†");const e=t.x,o=t.y,n=t.constraints,r=t.width,s=t.height,c=t.clone();c.name="å¤´å›¾å›¾ç‰‡";const h=.1*r,d=s-h,u=r+2*h+25,g=figma.createRectangle();let f,m;g.name="è’™ç‰ˆ",g.fills=[l.createSolidFill({r:1,g:1,b:1})],g.resize(u,d),a.safeAppendChild(i,g,"ç¾½åŒ–è’™ç‰ˆçŸ©å½¢æ·»åŠ åˆ°frame"),yield new Promise(e=>setTimeout(e,0));try{f=figma.group([g],i),f.name="ç¾½åŒ–è’™ç‰ˆ"}catch(e){return void console.error("åˆ›å»ºç¾½åŒ–è’™ç‰ˆç»„å¤±è´¥:",e)}try{const e={type:"LAYER_BLUR",radius:h,visible:!0};void 0!==f.effects&&(f.effects=[e])}catch(e){console.warn("è®¾ç½®æ¨¡ç³Šæ•ˆæœå¤±è´¥:",e)}try{"isMask"in f&&(f.isMask=!0)}catch(e){console.warn("è®¾ç½®å‰ªåˆ‡è’™ç‰ˆå¤±è´¥:",e)}try{m=figma.group([f,t],i),m.name="å¤´å›¾"}catch(e){return void console.error("åˆ›å»ºå¤´å›¾ç»„å¤±è´¥:",e)}const y=(r-u)/2;g.x=e+y,g.y=0,t.x=e,t.y=o,t.constraints=n;try{t&&t.parent&&t.remove()}catch(e){console.warn("åˆ é™¤åŸå¤´å›¾èŠ‚ç‚¹å¤±è´¥:",e)}try{a.safeAppendChild(m,c,"å¤åˆ¶çš„å¤´å›¾å›¾ç‰‡èŠ‚ç‚¹æ·»åŠ åˆ°å¤´å›¾ç»„"),c.x=e,c.y=o,c.constraints=n}catch(e){console.error("å°†å¤åˆ¶çš„å¤´å›¾å›¾ç‰‡èŠ‚ç‚¹æ·»åŠ åˆ°å¤´å›¾ç»„å¤±è´¥:",e)}}catch(e){console.error("ä¸ºå¤´å›¾å›¾ç‰‡æ·»åŠ ç¾½åŒ–è’™ç‰ˆå¤±è´¥:",e)}})}(r,o)}catch(e){console.error("å¤´å›¾å›¾ç‰‡æ·»åŠ ç¾½åŒ–è’™ç‰ˆå¤±è´¥:",e)}if(i)try{const e=yield c.insertImage(i,"æ ‡é¢˜å›¾ç‰‡");s=e&&"strokeCap"in e?e:null,s&&(a.safeAppendChild(o,s,"æ ‡é¢˜å›¾ç‰‡æ·»åŠ åˆ°ç”»æ¿"),s.constraints={horizontal:"CENTER",vertical:"MAX"},s.x=(o.width-s.width)/2,s.y=o.height-s.height)}catch(e){console.error("æ ‡é¢˜å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e)}return o})}class f{constructor(e,t){this.frame=e,this.config=t}build(){return e(this,void 0,void 0,function*(){"imageButton"===this.config.buttonVersion&&(yield this.addGameIcon(),yield this.addGameInfo()),yield this.addButtons()})}addGameIcon(){return e(this,void 0,void 0,function*(){if(!this.config.gameIcon)return;const e=yield c.insertImage(this.config.gameIcon,"æ¸¸æˆå›¾æ ‡",190,190);e&&(e.resize(190,190),"cornerRadius"in e&&(e.cornerRadius=40),"strokes"in e&&(e.strokes=[{type:"SOLID",color:{r:1,g:1,b:1},opacity:.2}]),"strokeWeight"in e&&(e.strokeWeight=1),e.x=70,e.y=(this.frame.height-190)/2,a.safeAppendChild(this.frame,e,"æ¸¸æˆå›¾æ ‡æ·»åŠ "))})}addGameInfo(){return e(this,void 0,void 0,function*(){const e=this.config.gameTextColor?l.hexToRgb(this.config.gameTextColor):{r:1,g:1,b:1};if(this.config.gameName){const t=yield a.createText(this.config.gameName,48,"Medium");t.x=285,t.y=49,t.textAlignHorizontal="LEFT",t.fills=[l.createSolidFill(e)],a.safeAppendChild(this.frame,t,"æ¸¸æˆåç§°æ–‡æœ¬æ·»åŠ ")}if(this.config.gameDesc){const t=yield a.createText(this.config.gameDesc,32,"Regular");t.x=285,t.y=122,t.resize(300,t.height),t.textAutoResize="HEIGHT",t.textAlignHorizontal="LEFT",t.fills=[l.createSolidFill(e)],a.safeAppendChild(this.frame,t,"æ¸¸æˆæè¿°æ–‡æœ¬æ·»åŠ ")}})}addButtons(){return e(this,void 0,void 0,function*(){switch(this.config.buttonVersion){case"imageButton":yield this.addIconButton();break;case"singleButton":yield this.addSingleButton();break;case"doubleButton":yield this.addDoubleButtons()}})}addIconButton(){return e(this,void 0,void 0,function*(){if(!this.config.iconButtonBg)return;const e=a.createFrame("ä¸‹è½½æŒ‰é’®",344,103);if(e.x=666,e.y=(this.frame.height-103)/2,e.fills=[],this.config.iconButtonBg)try{const t=yield c.insertImage(this.config.iconButtonBg,"æŒ‰é’®åº•å›¾",344,103);if(t){if(t.height>103){const e=103/t.height;t.resize(t.width*e,103)}if(t.width>344){const e=344/t.width;t.resize(344,t.height*e)}t.x=0,t.y=0,a.safeAppendChild(e,t,"å›¾æ ‡æŒ‰é’®åº•å›¾æ·»åŠ ")}else e.fills=[l.createSolidFill({r:0,g:.44,b:.89})],e.cornerRadius=30}catch(t){console.error("æŒ‰é’®åº•å›¾åˆ›å»ºå¤±è´¥:",t),e.fills=[l.createSolidFill({r:0,g:.44,b:.89})],e.cornerRadius=30}else e.fills=[l.createSolidFill({r:0,g:.44,b:.89})],e.cornerRadius=30;const t=this.config.iconButtonText||"ç«‹å³ä¸‹è½½";{const i=this.config.iconButtonTextColor?l.hexToRgb(this.config.iconButtonTextColor):{r:1,g:1,b:1};try{const o=yield a.createText(t,36,"Bold");o.fills=[l.createSolidFill(i)],o.resize(e.width,o.height),o.textAlignHorizontal="CENTER",o.y=(e.height-o.height)/2,a.safeAppendChild(e,o,"å›¾æ ‡æŒ‰é’®æ–‡æœ¬æ·»åŠ ")}catch(e){console.error("åˆ›å»ºæŒ‰é’®æ–‡æœ¬å¤±è´¥:",e)}}a.safeAppendChild(this.frame,e,"å›¾æ ‡æŒ‰é’®æ¡†æ¶æ·»åŠ ")})}addSingleButton(){return e(this,void 0,void 0,function*(){if(!this.config.singleButtonBg)return;const e=a.createFrame("å•æŒ‰é’®",600,80);e.x=(t-600)/2,e.y=(this.frame.height-80)/2,e.cornerRadius=40;try{yield c.setImageFill(e,this.config.singleButtonBg)}catch(e){return void console.error("å•æŒ‰é’®åº•å›¾è®¾ç½®å¤±è´¥:",e)}const i=this.config.singleButtonText||"ç«‹å³ä¸‹è½½";{const t=this.config.singleButtonTextColor?l.hexToRgb(this.config.singleButtonTextColor):{r:1,g:1,b:1};try{const o=yield a.createText(i,32,"Bold");o.fills=[l.createSolidFill(t)],o.resize(e.width,o.height),o.textAlignHorizontal="CENTER",o.y=(e.height-o.height)/2,a.safeAppendChild(e,o,"å•æŒ‰é’®æ–‡æœ¬æ·»åŠ ")}catch(e){console.error("åˆ›å»ºå•æŒ‰é’®æ–‡æœ¬å¤±è´¥:",e)}}a.safeAppendChild(this.frame,e,"å•æŒ‰é’®æ¡†æ¶æ·»åŠ ")})}addDoubleButtons(){return e(this,void 0,void 0,function*(){const e=this.config.leftButtonBg,i=this.config.rightButtonBg;if(!e&&!i)return;const o=this.config.buttonSpacing||10,n=(800-o)/2,r=(t-800)/2,s=(this.frame.height-80)/2;if(e)try{const e=yield this.createButton("å·¦ä¾§æŒ‰é’®",this.config.leftButtonText||"å·¦ä¾§æŒ‰é’®",this.config.leftButtonTextColor,this.config.leftButtonBg,n,80);e&&(e.x=r,e.y=s,a.safeAppendChild(this.frame,e,"å·¦ä¾§æŒ‰é’®æ·»åŠ "))}catch(e){console.error("åˆ›å»ºå·¦ä¾§æŒ‰é’®å¤±è´¥:",e)}if(i)try{const e=yield this.createButton("å³ä¾§æŒ‰é’®",this.config.rightButtonText||"å³ä¾§æŒ‰é’®",this.config.rightButtonTextColor,this.config.rightButtonBg,n,80);e&&(e.x=r+n+o,e.y=s,a.safeAppendChild(this.frame,e,"å³ä¾§æŒ‰é’®æ·»åŠ "))}catch(e){console.error("åˆ›å»ºå³ä¾§æŒ‰é’®å¤±è´¥:",e)}})}createButton(t,i,o,n,r,s){return e(this,void 0,void 0,function*(){if(!n)return null;const e=a.createFrame(t,r,s);e.cornerRadius=s/2;try{yield c.setImageFill(e,n)}catch(e){return console.error(`${t}åº•å›¾è®¾ç½®å¤±è´¥:`,e),null}if(i)try{const n=o?l.hexToRgb(o):{r:1,g:1,b:1},c=yield a.createText(i,24,"Bold");c.fills=[l.createSolidFill(n)],c.resize(r,c.height),c.textAlignHorizontal="CENTER",c.y=(s-c.height)/2,a.safeAppendChild(e,c,`${t}æŒ‰é’®æ–‡æœ¬æ·»åŠ `)}catch(e){console.error(`åˆ›å»º${t}æ–‡æœ¬å¤±è´¥:`,e)}return e})}}class m{createModule(t,o){return e(this,void 0,void 0,function*(){try{let e;const n=(t.type,t.type);switch(console.log("ğŸ­ [æ¨¡å—å·¥å‚] å¼€å§‹åˆ›å»ºæ¨¡å—:",{"æ¨¡å—ID":t.id,"æ¨¡å—ç±»å‹":n,"æ¨¡å—æ ‡é¢˜":t.title,"å†…å®¹é”®":Object.keys(t.content||{})}),n){case"activityContent":case i.ACTIVITY_CONTENT:e=yield this.createActivityContentModule(t.content);break;case"signIn":case i.SIGN_IN:e=yield this.createSignInModule(t.content);break;case"collectCards":case i.COLLECT_CARDS:e=yield this.createCollectCardsModule(t.content);break;case"nineGrid":case i.NINE_GRID:e=yield this.createNineGridModule(t.content,o);break;case"carousel":case i.CAROUSEL:e=yield this.createCarouselModule(t.content);break;case"verticalCarousel":case i.VERTICAL_CAROUSEL:e=yield this.createVerticalCarouselModule(t.content);break;default:return console.warn(`æœªçŸ¥çš„æ¨¡å—ç±»å‹: ${n}`),this.createErrorModule(t,`æœªçŸ¥çš„æ¨¡å—ç±»å‹: ${n}`)}return e.name=t.title||`${n}æ¨¡å—`,console.log("âœ… [æ¨¡å—å·¥å‚] æ¨¡å—åˆ›å»ºæˆåŠŸ:",{"æ¨¡å—åç§°":e.name,"æ¨¡å—å¤§å°":`${e.width}x${e.height}`}),e}catch(e){return console.error(`âŒ [æ¨¡å—å·¥å‚] åˆ›å»ºæ¨¡å—å¤±è´¥: ${t.type}`,e),this.createErrorModule(t,e)}})}createActivityContentModule(i){return e(this,void 0,void 0,function*(){console.log("ğŸ­ [æ´»åŠ¨å†…å®¹æ¨¡å—] å¼€å§‹åˆ›å»º:",{"ä¸»æ ‡é¢˜":i.mainTitle,"å‰¯æ ‡é¢˜":i.subTitle,"æ­£æ–‡å†…å®¹":i.text,"ä¸»æ ‡é¢˜èƒŒæ™¯":!!i.mainTitleBg,"å‰¯æ ‡é¢˜èƒŒæ™¯":!!i.subTitleBg,"æ’å›¾":!!i.image});const e=a.createFrame("æ´»åŠ¨å†…å®¹æ¨¡å—",t,1e3);e.fills=[];const o=new C(e,i);return yield o.build(),console.log("âœ… [æ´»åŠ¨å†…å®¹æ¨¡å—] åˆ›å»ºå®Œæˆï¼Œæœ€ç»ˆé«˜åº¦ï¼š",e.height),e})}createSignInModule(i){return e(this,void 0,void 0,function*(){const e=a.createFrame("ç­¾åˆ°æ¨¡å—",t,460),o=new E(e,i);return yield o.build(),e})}createCollectCardsModule(i){return e(this,void 0,void 0,function*(){const e=a.createFrame("é›†å¡æ¨¡å—",t,300),o=new A(e,i);return yield o.build(),e})}createNineGridModule(t,i){return e(this,void 0,void 0,function*(){return new v(t,i).build()})}createCarouselModule(t){return e(this,void 0,void 0,function*(){const e=a.createFrame("å›¾ç‰‡è½®æ’­ï¼ˆæ¨ªç‰ˆï¼‰",1080,957);e.fills=[];const i=new I(e,t);return yield i.build(),console.log("å›¾ç‰‡è½®æ’­ï¼ˆæ¨ªç‰ˆï¼‰æ¨¡å—åˆ›å»ºå®Œæˆï¼Œæœ€ç»ˆé«˜åº¦ï¼š",e.height),e})}createVerticalCarouselModule(t){return e(this,void 0,void 0,function*(){const e=a.createFrame("å›¾ç‰‡è½®æ’­ï¼ˆç«–ç‰ˆï¼‰",1080,1405);e.fills=[];const i=new T(e,t);return yield i.build(),console.log("å›¾ç‰‡è½®æ’­ï¼ˆç«–ç‰ˆï¼‰æ¨¡å—åˆ›å»ºå®Œæˆï¼Œæœ€ç»ˆé«˜åº¦ï¼š",e.height),e})}createErrorModule(i,o){return e(this,void 0,void 0,function*(){const e=a.createFrame(`é”™è¯¯æ¨¡å—-${i.type}`,t,100);e.fills=[l.createSolidFill({r:1,g:.9,b:.9})];const n=yield a.createText(`æ¨¡å—åˆ›å»ºå¤±è´¥: ${i.type}\n${o}`,14,"Regular");return n.x=20,n.y=20,a.safeAppendChild(e,n,"é”™è¯¯ä¿¡æ¯æ·»åŠ "),e})}}class y{constructor(e,t){this.currentY=0,this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){console.log("å¼€å§‹æ„å»ºæ´»åŠ¨è§„åˆ™æ¨¡å—");try{const e=this.content.rulesTitle&&""!==this.content.rulesTitle.trim(),t=null!==this.content.rulesBgImage&&void 0!==this.content.rulesBgImage,i=this.content.rulesContent&&""!==this.content.rulesContent.trim();if(!e&&!t&&!i)return console.log("æ´»åŠ¨è§„åˆ™æ¨¡å—ï¼šæ²¡æœ‰ä»»ä½•å†…å®¹éœ€è¦æ„å»ºï¼Œè·³è¿‡"),void this.frame.resize(1080,0);(e||t)&&(console.log("æ·»åŠ æ´»åŠ¨è§„åˆ™æ ‡é¢˜..."),yield this.addTitle()),i&&(console.log("æ·»åŠ æ´»åŠ¨è§„åˆ™å†…å®¹..."),yield this.addRulesContent()),console.log("è°ƒæ•´æ¨¡å—é«˜åº¦..."),this.adjustFrameHeight(),console.log("æ´»åŠ¨è§„åˆ™æ¨¡å—æ„å»ºå®Œæˆ")}catch(e){throw console.error("æ´»åŠ¨è§„åˆ™æ¨¡å—æ„å»ºè¿‡ç¨‹ä¸­å‡ºé”™ï¼š",e),e}})}addTitle(){return e(this,void 0,void 0,function*(){const t=this.content.rulesTitle&&""!==this.content.rulesTitle.trim(),i=null!==this.content.rulesBgImage&&void 0!==this.content.rulesBgImage;if(!t&&!i)return;this.currentY+=90;const o=t?this.content.rulesTitle:"",n=yield function(t,i,o,n){return e(this,arguments,void 0,function*(e,t,i,o,n=24,r="Bold"){const s=a.createFrame("æ ‡é¢˜å®¹å™¨",i,o);if(t?yield c.setImageFill(s,t):s.fills=[l.createSolidFill({r:.95,g:.95,b:.95})],e){const t=yield a.createText(e,n,r);t.fills=[l.createSolidFill({r:0,g:0,b:0})],t.textAlignHorizontal="CENTER",t.textAlignVertical="CENTER",t.x=(i-t.width)/2,t.y=(o-t.height)/2,s.appendChild(t)}return s})}(o,this.content.rulesBgImage,1080,120,48,"Bold");n.x=0,n.y=this.currentY,a.safeAppendChild(this.frame,n,"æ´»åŠ¨è§„åˆ™æ ‡é¢˜å®¹å™¨æ·»åŠ "),this.currentY+=120})}addRulesContent(){return e(this,void 0,void 0,function*(){if(!this.content.rulesContent)return;console.log("æ·»åŠ è§„åˆ™å†…å®¹..."),this.currentY+=90;const e=yield a.createText(this.content.rulesContent,28,"Regular");e.fills=[l.createSolidFill({r:0,g:0,b:0})],e.lineHeight={unit:"AUTO"},e.resize(950,e.height),e.textAlignHorizontal="LEFT",e.x=65,e.y=this.currentY,a.safeAppendChild(this.frame,e,"æ´»åŠ¨è§„åˆ™å†…å®¹æ–‡æœ¬æ·»åŠ "),this.currentY+=e.height})}adjustFrameHeight(){this.currentY+=90,this.frame.resize(1080,this.currentY)}}class p{constructor(e,t){this.frame=e,this.config=t}build(){return e(this,void 0,void 0,function*(){yield this.setupBackground(),yield this.addContent()})}setupBackground(){return e(this,void 0,void 0,function*(){this.config.footerBg?yield c.setImageFill(this.frame,this.config.footerBg):this.frame.fills=[]})}addContent(){return e(this,void 0,void 0,function*(){this.config.footerLogo&&(yield this.addLogo())})}addLogo(){return e(this,void 0,void 0,function*(){if(this.config.footerLogo){console.log("å¼€å§‹åˆ›å»ºLogoï¼Œä½¿ç”¨ImageNodeBuilder");try{const e=yield c.insertImage(this.config.footerLogo,"LOGO");if(!e)return void console.log("Logoå›¾ç‰‡èŠ‚ç‚¹åˆ›å»ºå¤±è´¥");const i=e.width,o=e.height,n=i/o;let r,s;console.log(`LogoåŸå§‹å°ºå¯¸: ${i}x${o}, å®½é«˜æ¯”: ${n.toFixed(2)}`),r=340,s=r/n,s>250&&(s=250,r=s*n),e.resize(r,s),e.x=(t-r)/2,e.y=(this.frame.height-s)/2,"constraints"in e&&(e.constraints={horizontal:"SCALE",vertical:"SCALE"}),a.safeAppendChild(this.frame,e,"å°¾ç‰ˆLogoå›¾ç‰‡æ·»åŠ "),console.log(`Logoåˆ›å»ºæˆåŠŸ: æœ€ç»ˆå°ºå¯¸=${r.toFixed(1)}x${s.toFixed(1)}, ä½ç½®=(${e.x.toFixed(1)}, ${e.y.toFixed(1)})`)}catch(e){console.error("Logoåˆ›å»ºå¤±è´¥:",e)}}else console.log("è·³è¿‡Logoåˆ›å»ºï¼šæ²¡æœ‰ä¸Šä¼ Logoå›¾ç‰‡")})}}class v{constructor(e,i){this.CELL_SIZE=270,this.CELL_SPACING=24,this.currentY=0,this.content=e,this.mainContainer=i||a.createFrame("ä¸´æ—¶å®¹å™¨",1080,1e3),this.frame=a.createFrame("ä¹å®«æ ¼æŠ½å¥–",t,1e3),this.frame.fills=[]}build(){return e(this,void 0,void 0,function*(){try{return yield this.addTitle(),yield this.addNineGrid(),this.currentY+=90,yield u(this.frame,this.mainContainer,{name:"æˆ‘çš„å¥–å“",text:"æˆ‘çš„å¥–å“",x:102,y:this.currentY,width:398,height:112,textFontSize:50}),yield u(this.frame,this.mainContainer,{name:"æ´»åŠ¨è§„åˆ™",text:"æ´»åŠ¨è§„åˆ™",x:580,y:this.currentY,width:398,height:112,textFontSize:50}),this.currentY+=112,this.adjustFrameHeight(),this.frame}catch(e){throw console.error("ä¹å®«æ ¼æ¨¡å—æ„å»ºè¿‡ç¨‹ä¸­å‡ºé”™ï¼š",e),e}})}addTitle(){return e(this,void 0,void 0,function*(){if(!this.content.mainTitle)return;const e=a.createFrame("ä¹å®«æ ¼æ ‡é¢˜",t,120);if(e.x=0,e.y=this.currentY+90,e.fills=[],this.content.titleBgImage)try{const i=yield c.insertImage(this.content.titleBgImage,"æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡",t,120);i&&(i.x=0,i.y=0,a.safeAppendChild(e,i,"æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡æ·»åŠ "))}catch(e){console.error("æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e)}const i=yield a.createText(this.content.mainTitle,48,"Bold");i.fills=[l.createSolidFill({r:1,g:1,b:1})],i.resize(t,i.height),i.textAlignHorizontal="CENTER",i.x=0,i.y=(120-i.height)/2,a.safeAppendChild(e,i,"æ ‡é¢˜æ–‡æœ¬æ·»åŠ "),a.safeAppendChild(this.frame,e,"æ ‡é¢˜å®¹å™¨æ·»åŠ "),this.currentY+=120})}addNineGrid(){return e(this,void 0,void 0,function*(){const e=3*this.CELL_SIZE+4*this.CELL_SPACING+180,i=a.createFrame("ä¹å®«æ ¼ä¸»ä½“",t,e);if(i.x=0,i.y=this.currentY+90,i.fills=[],this.content.gridBgImage)try{const o=yield c.insertImage(this.content.gridBgImage,"ä¹å®«æ ¼èƒŒæ™¯",930,930);o&&(o.x=(t-930)/2,o.y=(e-930)/2,a.safeAppendChild(i,o,"ä¹å®«æ ¼èƒŒæ™¯å›¾ç‰‡æ·»åŠ "))}catch(e){console.error("ä¹å®«æ ¼èƒŒæ™¯å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e)}for(let e=0;e<3;e++)for(let t=0;t<3;t++){const o=3*e+t,n=yield this.createGridCell(e,t,o);a.safeAppendChild(i,n,`ä¹å®«æ ¼å•å…ƒæ ¼${o+1}æ·»åŠ `)}a.safeAppendChild(this.frame,i,"ä¹å®«æ ¼å®¹å™¨æ·»åŠ "),this.currentY+=e})}createGridCell(i,o,n){return e(this,void 0,void 0,function*(){const e=3*this.CELL_SIZE+2*this.CELL_SPACING,r=(t-e)/2+o*(this.CELL_SIZE+this.CELL_SPACING),s=90+this.CELL_SPACING+i*(this.CELL_SIZE+this.CELL_SPACING);return 4===n?this.createDrawButton(r,s):this.createPrizeCell(r,s,n)})}createDrawButton(t,i){return e(this,void 0,void 0,function*(){const e=a.createFrame("æŠ½å¥–æŒ‰é’®å®¹å™¨",this.CELL_SIZE,this.CELL_SIZE);e.x=t,e.y=i,e.fills=[];try{if(this.content.drawButtonImage)try{const t=yield c.insertImage(this.content.drawButtonImage,"æŠ½å¥–æŒ‰é’®å›¾ç‰‡",this.CELL_SIZE,this.CELL_SIZE);t?(t.x=0,t.y=0,a.safeAppendChild(e,t,"æŠ½å¥–æŒ‰é’®å›¾ç‰‡æ·»åŠ ")):(console.warn("æŠ½å¥–æŒ‰é’®å›¾ç‰‡æ’å…¥å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼"),yield this.addDefaultButtonStyle(e))}catch(t){console.error("æŠ½å¥–æŒ‰é’®å›¾ç‰‡åˆ›å»ºå¤±è´¥ï¼š",t),yield this.addDefaultButtonStyle(e)}else yield this.addDefaultButtonStyle(e)}catch(t){console.error("åˆ›å»ºæŠ½å¥–æŒ‰é’®å¤±è´¥ï¼š",t),yield this.addDefaultButtonStyle(e)}return e})}addDefaultButtonStyle(t){return e(this,void 0,void 0,function*(){t.fills=[l.createSolidFill({r:1,g:.3,b:.3})],t.cornerRadius=10;const e=yield a.createText("æŠ½å¥–",24,"Bold");e.fills=[l.createSolidFill({r:1,g:1,b:1})],e.resize(this.CELL_SIZE,e.height),e.textAlignHorizontal="CENTER",e.y=(this.CELL_SIZE-e.height)/2,a.safeAppendChild(t,e,"æŠ½å¥–æŒ‰é’®é»˜è®¤æ–‡æœ¬æ·»åŠ ")})}createPrizeCell(t,i,o){return e(this,void 0,void 0,function*(){var e;let n;if(o<=3)n=o;else{if(4===o)throw new Error("ä½ç½®4æ˜¯æŠ½å¥–æŒ‰é’®ä½ç½®ï¼Œä¸åº”åˆ›å»ºå¥–å“æ ¼å­");if(5===o)n=4;else if(6===o)n=5;else if(7===o)n=6;else{if(8!==o)throw new Error(`æ— æ•ˆçš„ä¹å®«æ ¼ä½ç½®: ${o}`);n=7}}const r=null===(e=this.content.prizes)||void 0===e?void 0:e[n];let s;if(7===n)s="è°¢è°¢å‚ä¸";else{s=`å¥–å“${(n+1).toString().padStart(2,"0")}`}const h=(null==r?void 0:r.name)||s;console.log(`ğŸ¯ [å¥–å“æ˜ å°„è°ƒè¯•] ä¹å®«æ ¼ä½ç½®${o} â†’ å¥–å“ç´¢å¼•${n} â†’ "${h}" (é»˜è®¤: "${s}")`);const d=a.createFrame(h,this.CELL_SIZE,this.CELL_SIZE);d.x=t,d.y=i,d.fills=[];try{if(this.content.prizeBgImage)try{const e=yield c.insertImage(this.content.prizeBgImage,"å¥–å“èƒŒæ™¯å›¾ç‰‡",this.CELL_SIZE,this.CELL_SIZE);e&&(e.x=0,e.y=0,a.safeAppendChild(d,e,"å¥–å“èƒŒæ™¯å›¾ç‰‡æ·»åŠ "))}catch(e){console.error("å¥–å“èƒŒæ™¯å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e)}if(null==r?void 0:r.image)try{const e=yield c.insertImage(r.image,"å¥–å“å›¾ç‰‡",180,180);e&&(e.x=45,e.y=11,a.safeAppendChild(d,e,"å¥–å“å›¾ç‰‡æ·»åŠ "))}catch(e){console.error("å¥–å“å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e);const t=a.createFrame("å ä½ç¬¦",180,180);t.x=45,t.y=11,t.fills=[l.createSolidFill({r:.9,g:.9,b:.9})],t.cornerRadius=10,a.safeAppendChild(d,t,"å¥–å“å ä½ç¬¦æ·»åŠ ")}else{const e=a.createFrame("å ä½ç¬¦",180,180);e.x=45,e.y=11,e.fills=[l.createSolidFill({r:.9,g:.9,b:.9})],e.cornerRadius=10,a.safeAppendChild(d,e,"å¥–å“é»˜è®¤å ä½ç¬¦æ·»åŠ ")}const e=(null==r?void 0:r.name)||h;if(e){const t=yield a.createText(e,26,"Medium");t.resize(this.CELL_SIZE,t.height),t.textAlignHorizontal="CENTER",t.x=0,t.y=190,t.fills=[l.createSolidFill({r:0,g:0,b:0})],a.safeAppendChild(d,t,"å¥–å“åç§°æ–‡æœ¬æ·»åŠ ")}}catch(e){console.error(`åˆ›å»ºå¥–å“æ ¼å­å¤±è´¥ ${n}:`,e)}return d})}adjustFrameHeight(){this.frame.resize(t,this.currentY+90)}}class I{constructor(e,t){this.TITLE_HEIGHT=120,this.CAROUSEL_AREA_HEIGHT=607,this.CAROUSEL_BG_WIDTH=1e3,this.CAROUSEL_BG_HEIGHT=540,this.CAROUSEL_IMAGE_WIDTH=960,this.CAROUSEL_IMAGE_HEIGHT=500,this.BUTTON_HEIGHT=20,this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){console.log("å¼€å§‹æ„å»ºå›¾ç‰‡è½®æ’­ï¼ˆæ¨ªç‰ˆï¼‰æ¨¡å—");try{this.setupFrameLayout(),yield this.addTitleContainer(),yield this.addCarouselPreview(),console.log("å›¾ç‰‡è½®æ’­ï¼ˆæ¨ªç‰ˆï¼‰æ¨¡å—æ„å»ºå®Œæˆ")}catch(e){throw console.error("å›¾ç‰‡è½®æ’­ï¼ˆæ¨ªç‰ˆï¼‰æ¨¡å—æ„å»ºè¿‡ç¨‹ä¸­å‡ºé”™ï¼š",e),e}})}setupFrameLayout(){a.setupAutoLayout(this.frame,"VERTICAL",30,90)}addTitleContainer(){return e(this,void 0,void 0,function*(){if(!this.content.title&&!this.content.titleBackground)return;console.log("æ·»åŠ æ ‡é¢˜å®¹å™¨ - 1080x120px");const e=a.createFrame("æ ‡é¢˜å®¹å™¨",1080,this.TITLE_HEIGHT);if(e.fills=[],this.content.titleBackground)try{const t=yield c.insertImage(this.content.titleBackground,"æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡",1080,120);t&&(t.x=0,t.y=0,a.safeAppendChild(e,t,"æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡æ·»åŠ "))}catch(e){console.error("æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e)}if(this.content.title){const t=yield a.createText(this.content.title,48,"Bold");t.fills=[l.createSolidFill({r:1,g:1,b:1})],t.resize(1080,t.height),t.textAlignHorizontal="CENTER",t.x=0,t.y=(120-t.height)/2,a.safeAppendChild(e,t,"æ ‡é¢˜æ–‡æœ¬æ·»åŠ ")}a.safeAppendChild(this.frame,e,"æ ‡é¢˜å®¹å™¨æ·»åŠ ")})}addCarouselPreview(){return e(this,void 0,void 0,function*(){console.log("æ·»åŠ è½®æ’­é¢„è§ˆåŒºåŸŸ");const e=a.createFrame("è½®æ’­å›¾é¢„è§ˆ",1080,this.CAROUSEL_AREA_HEIGHT);e.fills=[],a.setupAutoLayout(e,"VERTICAL",0,0),yield this.addCarouselArea(e),yield this.addCarouselButtons(e),a.safeAppendChild(this.frame,e,"è½®æ’­é¢„è§ˆåŒºåŸŸæ·»åŠ ")})}addCarouselArea(t){return e(this,void 0,void 0,function*(){console.log("æ·»åŠ è½®æ’­åŒºåŸŸ - 1080x607px");const e=a.createFrame("è½®æ’­åŒºåŸŸ",1080,this.CAROUSEL_AREA_HEIGHT);e.fills=[];const i=a.createFrame("è½®æ’­å›¾èƒŒæ™¯",this.CAROUSEL_BG_WIDTH,this.CAROUSEL_BG_HEIGHT);if(this.content.carouselBackground)try{const e=yield c.insertImage(this.content.carouselBackground,"è½®æ’­å›¾èƒŒæ™¯å›¾ç‰‡",this.CAROUSEL_BG_WIDTH,this.CAROUSEL_BG_HEIGHT);e&&(e.x=0,e.y=0,a.safeAppendChild(i,e,"è½®æ’­å›¾èƒŒæ™¯å›¾ç‰‡æ·»åŠ "))}catch(e){console.error("è½®æ’­å›¾èƒŒæ™¯å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e),i.fills=[l.createSolidFill({r:1,g:1,b:1})]}else i.fills=[l.createSolidFill({r:1,g:1,b:1})];if(i.x=(1080-this.CAROUSEL_BG_WIDTH)/2,i.y=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_BG_HEIGHT)/2+.5,a.safeAppendChild(e,i,"è½®æ’­å›¾èƒŒæ™¯æ·»åŠ "),this.content.carouselImage)try{const t=yield c.insertImage(this.content.carouselImage,"è½®æ’­å›¾",this.CAROUSEL_IMAGE_WIDTH,this.CAROUSEL_IMAGE_HEIGHT);t&&(t.x=(1080-this.CAROUSEL_IMAGE_WIDTH)/2,t.y=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_IMAGE_HEIGHT)/2+.5,a.safeAppendChild(e,t,"è½®æ’­å›¾æ·»åŠ "))}catch(t){console.error("è½®æ’­å›¾åˆ›å»ºå¤±è´¥:",t);const i=figma.createRectangle();i.name="è½®æ’­å›¾",i.resize(this.CAROUSEL_IMAGE_WIDTH,this.CAROUSEL_IMAGE_HEIGHT),i.fills=[l.createSolidFill({r:1,g:.3,b:.3})],i.x=(1080-this.CAROUSEL_IMAGE_WIDTH)/2,i.y=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_IMAGE_HEIGHT)/2+.5,a.safeAppendChild(e,i,"è½®æ’­å›¾å ä½æ·»åŠ ")}a.safeAppendChild(t,e,"è½®æ’­åŒºåŸŸæ·»åŠ ")})}addCarouselButtons(t){return e(this,void 0,void 0,function*(){console.log("æ·»åŠ è½®æ’­æŒ‰é’®");const e=a.createFrame("è½®æ’­æŒ‰é’®",300,this.BUTTON_HEIGHT);e.fills=[],a.setupAutoLayout(e,"HORIZONTAL",24,0);const i=figma.createEllipse();i.name="æ´»è·ƒæŒ‰é’®",i.resize(60,this.BUTTON_HEIGHT),i.fills=[l.createSolidFill({r:1,g:1,b:1})],a.safeAppendChild(e,i,"æ´»è·ƒæŒ‰é’®æ·»åŠ ");for(let t=1;t<5;t++){const i=figma.createEllipse();i.name=`æŒ‰é’®${t+1}`,i.resize(this.BUTTON_HEIGHT,this.BUTTON_HEIGHT),i.fills=[],i.strokes=[l.createSolidFill({r:1,g:1,b:1})],i.strokeWeight=2,a.safeAppendChild(e,i,`æŒ‰é’®${t+1}æ·»åŠ `)}e.x=(1080-e.width)/2,a.safeAppendChild(t,e,"è½®æ’­æŒ‰é’®å®¹å™¨æ·»åŠ ")})}}class C{constructor(e,t){this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){console.log("å¼€å§‹æ„å»ºæ´»åŠ¨è¯¦æƒ…æ¨¡å—");try{this.setupAutoLayout(),yield this.addMainTitle(),yield this.addSubTitle(),yield this.addTextContent(),yield this.addImage(),this.adjustFrameHeight(),console.log("æ´»åŠ¨è¯¦æƒ…æ¨¡å—æ„å»ºå®Œæˆ")}catch(e){throw console.error("æ´»åŠ¨è¯¦æƒ…æ¨¡å—æ„å»ºè¿‡ç¨‹ä¸­å‡ºé”™ï¼š",e),e}})}setupAutoLayout(){a.setupAutoLayout(this.frame,"VERTICAL",60,90)}addMainTitle(){return e(this,void 0,void 0,function*(){if(!this.content.mainTitleBg||!this.content.mainTitle)return;console.log("æ·»åŠ å¤§æ ‡é¢˜...");const e=a.createFrame("æ´»åŠ¨å†…å®¹å¤§æ ‡é¢˜å®¹å™¨",1080,120);e.fills=[];try{const t=yield c.insertImage(this.content.mainTitleBg,"å¤§æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡",1080,120);t&&(t.x=0,t.y=0,a.safeAppendChild(e,t,"æ´»åŠ¨å†…å®¹æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡æ·»åŠ "))}catch(e){console.error("å¤§æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e)}const i=yield a.createText(this.content.mainTitle,48,"Bold");i.fills=[l.createSolidFill({r:1,g:1,b:1})],i.resize(t,i.height),i.textAlignHorizontal="CENTER",i.x=0,i.y=(120-i.height)/2,a.safeAppendChild(e,i,"æ´»åŠ¨å†…å®¹æ ‡é¢˜æ–‡æœ¬æ·»åŠ "),a.safeAppendChild(this.frame,e,"æ´»åŠ¨å†…å®¹æ ‡é¢˜å®¹å™¨æ·»åŠ ")})}addSubTitle(){return e(this,void 0,void 0,function*(){if(!this.content.subTitleBg||!this.content.subTitle)return;console.log("æ·»åŠ å°æ ‡é¢˜...");const e=a.createFrame("æ´»åŠ¨å†…å®¹å°æ ‡é¢˜å®¹å™¨",1080,100);e.fills=[];try{const t=yield c.insertImage(this.content.subTitleBg,"å°æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡",1080,100);t&&(t.x=0,t.y=0,a.safeAppendChild(e,t,"å°æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡æ·»åŠ "))}catch(e){console.error("å°æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e)}const i=yield a.createText(this.content.subTitle,44,"Medium");i.fills=[l.createSolidFill({r:1,g:1,b:1})],i.resize(t,i.height),i.textAlignHorizontal="CENTER",i.x=0,i.y=(100-i.height)/2,a.safeAppendChild(e,i,"å°æ ‡é¢˜æ–‡æœ¬æ·»åŠ "),a.safeAppendChild(this.frame,e,"å°æ ‡é¢˜å®¹å™¨æ·»åŠ ")})}addTextContent(){return e(this,void 0,void 0,function*(){if(!this.content.text)return;console.log("æ·»åŠ æ­£æ–‡...");const e=yield a.createText(this.content.text,40,"Regular");e.resize(950,e.height),e.textAlignHorizontal="CENTER",e.lineHeight={unit:"AUTO"},e.fills=[l.createSolidFill({r:1,g:1,b:1})],a.safeAppendChild(this.frame,e,"æ´»åŠ¨å†…å®¹æ­£æ–‡æ·»åŠ ")})}addImage(){return e(this,void 0,void 0,function*(){if(this.content.image){console.log("æ·»åŠ æ’å›¾...");try{const e=yield c.insertImage(this.content.image,"æ´»åŠ¨å†…å®¹æ’å›¾",950,600);e&&a.safeAppendChild(this.frame,e,"æ´»åŠ¨å†…å®¹æ’å›¾æ·»åŠ ")}catch(e){console.error("æ’å›¾åˆ›å»ºå¤±è´¥:",e)}}})}adjustFrameHeight(){}}class E{constructor(e,t){this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){yield this.setupBackground(),yield this.addTitle(),yield this.addSignInDays(),yield this.addSignInButton()})}setupBackground(){return e(this,void 0,void 0,function*(){this.content.bgImage?yield c.setImageFill(this.frame,this.content.bgImage):this.frame.fills=[l.createSolidFill({r:.95,g:.95,b:1})]})}addTitle(){return e(this,void 0,void 0,function*(){const e=a.createFrame("ç­¾åˆ°æ ‡é¢˜",500,100);e.x=(t-500)/2,e.y=20,this.content.titleImage?yield c.setImageFill(e,this.content.titleImage,"FIT"):yield this.addDefaultTitle(e),a.safeAppendChild(this.frame,e,"ç­¾åˆ°æ ‡é¢˜æ·»åŠ ")})}addDefaultTitle(t){return e(this,void 0,void 0,function*(){t.fills=[l.createSolidFill({r:.9,g:.5,b:.3})];const e=yield a.createText("æ¯æ—¥ç­¾åˆ°",28,"Bold");e.fills=[l.createSolidFill({r:1,g:1,b:1})],e.resize(500,e.height),e.textAlignHorizontal="CENTER",e.y=(100-e.height)/2,a.safeAppendChild(t,e,"ç­¾åˆ°é»˜è®¤æ ‡é¢˜æ–‡æœ¬æ·»åŠ ")})}addSignInDays(){return e(this,void 0,void 0,function*(){const e=a.createFrame("ç­¾åˆ°æ—¥æœŸå®¹å™¨",t-40,240);e.x=20,e.y=140,e.fills=[l.createSolidFill({r:1,g:1,b:1},.8)],e.cornerRadius=10,a.setupAutoLayout(e,"HORIZONTAL",10,10);const i=this.content.daysCount||7;for(let t=0;t<i;t++){const i=yield this.createDayItem(t+1);a.safeAppendChild(e,i,`ç­¾åˆ°ç¬¬${t+1}å¤©æ·»åŠ `)}a.safeAppendChild(this.frame,e,"ç­¾åˆ°æ—¥æœŸå®¹å™¨æ·»åŠ ")})}createDayItem(t){return e(this,void 0,void 0,function*(){const e=a.createFrame(`ç¬¬${t}å¤©`,80,220);e.fills=[l.createSolidFill({r:.95,g:.95,b:.95})],e.cornerRadius=5,a.setupAutoLayout(e,"VERTICAL",10,10);const i=yield this.createDayIcon();a.safeAppendChild(e,i,"ç­¾åˆ°æ—¥æœŸå›¾æ ‡æ·»åŠ ");const o=yield a.createText(`ç¬¬${t}å¤©`,16,"Medium");o.resize(80,o.height),o.textAlignHorizontal="CENTER",a.safeAppendChild(e,o,"ç­¾åˆ°æ—¥æœŸæ–‡æœ¬æ·»åŠ ");const n=yield a.createText("é‡‘å¸ x 100",14);return n.fills=[l.createSolidFill({r:.5,g:.5,b:.5})],n.resize(80,n.height),n.textAlignHorizontal="CENTER",a.safeAppendChild(e,n,"ç­¾åˆ°å¥–åŠ±æè¿°æ·»åŠ "),e})}createDayIcon(){return e(this,void 0,void 0,function*(){const e=a.createFrame("æ—¥æœŸå›¾æ ‡",60,60);return this.content.dayIcon?yield c.setImageFill(e,this.content.dayIcon,"FILL"):(e.fills=[l.createSolidFill({r:1,g:.8,b:.2})],e.cornerRadius=30),e})}addSignInButton(){return e(this,void 0,void 0,function*(){const e=a.createFrame("ç­¾åˆ°æŒ‰é’®",200,60);e.x=(t-200)/2,e.y=400,this.content.signButton?yield c.setImageFill(e,this.content.signButton,"FIT"):yield this.addDefaultButton(e),a.safeAppendChild(this.frame,e,"ç­¾åˆ°æŒ‰é’®æ¡†æ¶æ·»åŠ ")})}addDefaultButton(t){return e(this,void 0,void 0,function*(){t.fills=[l.createSolidFill({r:1,g:.4,b:.3})],t.cornerRadius=30;const e=yield a.createText("ç«‹å³ç­¾åˆ°",18,"Bold");e.fills=[l.createSolidFill({r:1,g:1,b:1})],e.resize(200,e.height),e.textAlignHorizontal="CENTER",e.y=(60-e.height)/2,a.safeAppendChild(t,e,"ç­¾åˆ°é»˜è®¤æŒ‰é’®æ–‡æœ¬æ·»åŠ ")})}}class A{constructor(e,t){this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){this.content.bgImage?yield c.setImageFill(this.frame,this.content.bgImage):this.frame.fills=[l.createSolidFill({r:.95,g:.9,b:1})];let e=20;if(this.content.titleImage){const i=a.createFrame("é›†å¡æ ‡é¢˜",400,80);i.x=(t-400)/2,i.y=e,yield c.setImageFill(i,this.content.titleImage,"FIT"),a.safeAppendChild(this.frame,i,"é›†å¡æ ‡é¢˜æ·»åŠ "),e+=100}const i=a.createFrame("å¡ç‰‡å®¹å™¨",t-40,200);i.x=20,i.y=e,i.fills=[l.createSolidFill({r:1,g:1,b:1},.9)],i.cornerRadius=10,a.setupAutoLayout(i,"HORIZONTAL",10,10);const o=this.content.cardsCount||5;for(let e=0;e<o;e++){const t=yield this.createCardItem(e+1);a.safeAppendChild(i,t,`é›†å¡å¡ç‰‡${e+1}æ·»åŠ `)}if(a.safeAppendChild(this.frame,i,"é›†å¡å¡ç‰‡å®¹å™¨æ·»åŠ "),e+=220,this.content.combineButton){const i=a.createFrame("åˆæˆæŒ‰é’®",200,60);i.x=(t-200)/2,i.y=e,yield c.setImageFill(i,this.content.combineButton,"FIT"),a.safeAppendChild(this.frame,i,"åˆæˆæŒ‰é’®æ·»åŠ "),e+=80}this.frame.resize(t,e)})}createCardItem(t){return e(this,void 0,void 0,function*(){const e=100,i=a.createFrame(`å¡ç‰‡${t}`,e,130);switch(this.content.cardBg?yield c.setImageFill(i,this.content.cardBg,"FILL"):i.fills=[l.createSolidFill({r:.9,g:.9,b:.9})],this.content.cardStyle){case"style1":i.cornerRadius=0;break;case"style2":i.cornerRadius=10;break;case"style3":i.cornerRadius=50;break;default:i.cornerRadius=5}const o=yield a.createText(`${t}`,16,"Bold");return o.resize(e,o.height),o.textAlignHorizontal="CENTER",o.y=105,a.safeAppendChild(i,o,"é›†å¡å¡ç‰‡ç¼–å·æ·»åŠ "),i})}}class T{constructor(e,t){this.TITLE_HEIGHT=120,this.CAROUSEL_AREA_HEIGHT=1285,this.MAIN_IMAGE_WIDTH=554,this.MAIN_IMAGE_HEIGHT=1097,this.SIDE_IMAGE_WIDTH=247,this.SIDE_IMAGE_HEIGHT=533,this.IMAGE_SPACING=20,this.CAROUSEL_BUTTON_HEIGHT=16,this.frame=e,this.content=t}build(){return e(this,void 0,void 0,function*(){console.log("å¼€å§‹æ„å»ºå›¾ç‰‡è½®æ’­ï¼ˆç«–ç‰ˆï¼‰æ¨¡å—");try{this.setupFrameLayout(),yield this.addTitleContainer(),yield this.addCarouselPreview(),console.log("âœ… å›¾ç‰‡è½®æ’­ï¼ˆç«–ç‰ˆï¼‰æ¨¡å—æ„å»ºæˆåŠŸ")}catch(e){console.error("âŒ å›¾ç‰‡è½®æ’­ï¼ˆç«–ç‰ˆï¼‰æ¨¡å—æ„å»ºå¤±è´¥:",e);const t=a.createFrame("æ„å»ºé”™è¯¯",1080,200);t.fills=[l.createSolidFill({r:1,g:.8,b:.8})];const i=yield a.createText(`æ„å»ºå¤±è´¥: ${e}`,24,"Regular");throw i.fills=[l.createSolidFill({r:.8,g:0,b:0})],a.safeAppendChild(t,i,"é”™è¯¯ä¿¡æ¯æ·»åŠ "),a.safeAppendChild(this.frame,t,"é”™è¯¯ä¿¡æ¯æ¡†æ·»åŠ "),e}})}setupFrameLayout(){this.frame.name="å›¾ç‰‡è½®æ’­ï¼ˆç«–ç‰ˆï¼‰",this.frame.resize(1080,this.TITLE_HEIGHT+this.CAROUSEL_AREA_HEIGHT),this.frame.fills=[]}addTitleContainer(){return e(this,void 0,void 0,function*(){console.log("æ·»åŠ è½®æ’­æ ‡é¢˜å®¹å™¨...");const e=a.createFrame("è½®æ’­æ ‡é¢˜å®¹å™¨",1080,this.TITLE_HEIGHT);if(e.x=0,e.y=0,e.fills=[],this.content.titleBackground)try{const t=yield c.insertImage(this.content.titleBackground,"è½®æ’­æ ‡é¢˜èƒŒæ™¯",1080,this.TITLE_HEIGHT);t&&(t.x=0,t.y=0,a.safeAppendChild(e,t,"è½®æ’­æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡æ·»åŠ "))}catch(e){console.error("è½®æ’­æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡åˆ›å»ºå¤±è´¥:",e)}if(this.content.title){const t=yield a.createText(this.content.title,48,"Bold");t.fills=[l.createSolidFill({r:1,g:1,b:1})],t.resize(1080,t.height),t.textAlignHorizontal="CENTER",t.x=0,t.y=(this.TITLE_HEIGHT-t.height)/2,a.safeAppendChild(e,t,"è½®æ’­æ ‡é¢˜æ–‡æœ¬æ·»åŠ ")}a.safeAppendChild(this.frame,e,"è½®æ’­æ ‡é¢˜å®¹å™¨æ·»åŠ ")})}addCarouselPreview(){return e(this,void 0,void 0,function*(){console.log("æ·»åŠ è½®æ’­é¢„è§ˆåŒºåŸŸ...");const e=a.createFrame("è½®æ’­é¢„è§ˆå®¹å™¨",1080,this.CAROUSEL_AREA_HEIGHT);e.x=0,e.y=this.TITLE_HEIGHT,e.fills=[],yield this.addCarouselLayout(e),yield this.addCarouselButtons(e),a.safeAppendChild(this.frame,e,"è½®æ’­é¢„è§ˆå®¹å™¨æ·»åŠ ")})}addCarouselLayout(t){return e(this,void 0,void 0,function*(){console.log("æ·»åŠ è½®æ’­å›¾ç‰‡å¸ƒå±€...");const e=(1080-(this.MAIN_IMAGE_WIDTH+this.IMAGE_SPACING+this.SIDE_IMAGE_WIDTH))/2,i=(this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_BUTTON_HEIGHT-this.MAIN_IMAGE_HEIGHT)/2;if(this.content.carouselImages[0])try{const o=yield c.insertImage(this.content.carouselImages[0],"è½®æ’­ä¸»å›¾",this.MAIN_IMAGE_WIDTH,this.MAIN_IMAGE_HEIGHT);o&&(o.x=e,o.y=i,a.safeAppendChild(t,o,"è½®æ’­ä¸»å›¾æ·»åŠ "))}catch(e){console.error("è½®æ’­ä¸»å›¾åˆ›å»ºå¤±è´¥:",e)}const o=a.createFrame("å³ä¾§å›¾ç‰‡å®¹å™¨",this.SIDE_IMAGE_WIDTH,this.MAIN_IMAGE_HEIGHT);if(o.x=e+this.MAIN_IMAGE_WIDTH+this.IMAGE_SPACING,o.y=i,o.fills=[],this.content.carouselImages[1])try{const e=yield c.insertImage(this.content.carouselImages[1],"è½®æ’­å³ä¸Šå›¾",this.SIDE_IMAGE_WIDTH,this.SIDE_IMAGE_HEIGHT);e&&(e.x=0,e.y=0,a.safeAppendChild(o,e,"è½®æ’­å³ä¸Šå›¾æ·»åŠ "))}catch(e){console.error("è½®æ’­å³ä¸Šå›¾åˆ›å»ºå¤±è´¥:",e)}if(this.content.carouselImages[2])try{const e=yield c.insertImage(this.content.carouselImages[2],"è½®æ’­å³ä¸‹å›¾",this.SIDE_IMAGE_WIDTH,this.SIDE_IMAGE_HEIGHT);e&&(e.x=0,e.y=this.SIDE_IMAGE_HEIGHT+this.IMAGE_SPACING,a.safeAppendChild(o,e,"è½®æ’­å³ä¸‹å›¾æ·»åŠ "))}catch(e){console.error("è½®æ’­å³ä¸‹å›¾åˆ›å»ºå¤±è´¥:",e)}a.safeAppendChild(t,o,"å³ä¾§å›¾ç‰‡å®¹å™¨æ·»åŠ ")})}addCarouselButtons(t){return e(this,void 0,void 0,function*(){console.log("æ·»åŠ è½®æ’­æŒ‰é’®...");const e=a.createFrame("è½®æ’­æŒ‰é’®å®¹å™¨",120,this.CAROUSEL_BUTTON_HEIGHT);e.x=480,e.y=this.CAROUSEL_AREA_HEIGHT-this.CAROUSEL_BUTTON_HEIGHT-20,e.fills=[];for(let t=0;t<3;t++){const i=figma.createEllipse();i.name=`è½®æ’­æŒ‰é’®${t+1}`,i.resize(this.CAROUSEL_BUTTON_HEIGHT,this.CAROUSEL_BUTTON_HEIGHT),i.x=t*(this.CAROUSEL_BUTTON_HEIGHT+10),i.y=0,i.fills=0===t?[l.createSolidFill({r:1,g:1,b:1})]:[l.createSolidFill({r:1,g:1,b:1},.5)],a.safeAppendChild(e,i,`è½®æ’­æŒ‰é’®${t+1}æ·»åŠ `)}a.safeAppendChild(t,e,"è½®æ’­æŒ‰é’®å®¹å™¨æ·»åŠ ")})}}class S{constructor(e){this.config=e}build(){return e(this,void 0,void 0,function*(){try{return console.log("å¼€å§‹æ„å»ºH5åŸå‹..."),yield s.loadAll(),this.createBaseFrames(),yield this.setupBackground(),yield this.addModules(),this.finalizeLayout(),console.log("H5åŸå‹æ„å»ºå®Œæˆ"),this.outerFrame}catch(e){throw console.error("H5åŸå‹æ„å»ºå¤±è´¥:",e),e}})}hasAnyModuleContent(){const e=!(!this.config.headerImage&&!this.config.titleUpload),t=!!(this.config.gameName||this.config.gameDesc||this.config.gameIcon),i=!!(this.config.modules&&this.config.modules.length>0),o=this.config.rulesTitle&&""!==this.config.rulesTitle.trim(),n=null!==this.config.rulesBgImage&&void 0!==this.config.rulesBgImage,r=this.config.rulesContent&&""!==this.config.rulesContent.trim(),s=o||n||r,l=!(!this.config.footerLogo&&!this.config.footerBg);return e||t||i||s||l}createBaseFrames(){this.outerFrame=a.createFrame("H5åŸå‹",t,100),this.outerFrame.layoutMode="NONE",this.outerFrame.clipsContent=!0,this.outerFrame.fills=[],this.hasAnyModuleContent()?(this.h5Frame=a.createFrame("è‡ªé€‚åº”æ¨¡å—",t,100),this.h5Frame.fills=[],a.setupAutoLayout(this.h5Frame,"VERTICAL",0,0),this.h5Frame.clipsContent=!0,this.h5Frame.layoutWrap="NO_WRAP",console.log("æ£€æµ‹åˆ°æ¨¡å—å†…å®¹ï¼Œå·²åˆ›å»ºè‡ªé€‚åº”æ¨¡å—å®¹å™¨")):console.log("æœªæ£€æµ‹åˆ°æ¨¡å—å†…å®¹ï¼Œè·³è¿‡è‡ªé€‚åº”æ¨¡å—å®¹å™¨åˆ›å»º")}setupBackground(){return e(this,void 0,void 0,function*(){console.log("ğŸ¨ [èƒŒæ™¯è®¾ç½®è°ƒè¯•] å¼€å§‹è®¾ç½®èƒŒæ™¯ï¼Œé…ç½®ä¿¡æ¯:"),console.log("   - pageBgColor:",this.config.pageBgColor),console.log("   - pageBgImage:",!!this.config.pageBgImage);const e=!this.config.pageBgColor||"#FFFFFF"===this.config.pageBgColor||"#ffffff"===this.config.pageBgColor||"#ffffff"===this.config.pageBgColor.toLowerCase();if(console.log("   - æ˜¯å¦ä¸ºé»˜è®¤ç™½è‰²:",e),this.h5Frame&&(this.h5Frame.fills=[],console.log("âœ… è‡ªé€‚åº”æ¨¡å—å®¹å™¨è®¾ç½®ä¸ºé€æ˜å¡«å……")),e)this.outerFrame.fills=[],console.log("âœ… H5åŸå‹å®¹å™¨èƒŒæ™¯è®¾ç½®ä¸ºé€æ˜ï¼ˆé»˜è®¤ç™½è‰²ï¼Œä»£è¡¨ç”¨æˆ·æœªä¿®æ”¹ï¼‰"),console.log("   - æœ€ç»ˆFrameå¡«å……:",this.outerFrame.fills);else{console.log("ğŸ¯ [é¢œè‰²è½¬æ¢] å¼€å§‹è½¬æ¢é¢œè‰²:",this.config.pageBgColor);const e=l.hexToRgb(this.config.pageBgColor||"#FFFFFF");console.log("   - RGBè½¬æ¢ç»“æœ:",e);const t=l.createSolidFill(e);console.log("   - åˆ›å»ºçš„å¡«å……å¯¹è±¡:",t),this.outerFrame.fills=[t],console.log(`âœ… H5åŸå‹å®¹å™¨èƒŒæ™¯è‰²è®¾ç½®ä¸º: ${this.config.pageBgColor}`),console.log("   - æœ€ç»ˆFrameå¡«å……:",this.outerFrame.fills)}if(this.config.pageBgImage){if(n.extractUint8Array(this.config.pageBgImage)){console.log("ğŸ–¼ï¸  å¼€å§‹æ·»åŠ èƒŒæ™¯å›¾ç‰‡");const e=yield c.insertImage(this.config.pageBgImage,"é¡µé¢èƒŒæ™¯å›¾ç‰‡");e&&(e.x=(this.outerFrame.width-e.width)/2,e.y=0,"constraints"in e&&(e.constraints={horizontal:"CENTER",vertical:"MIN"}),a.safeAppendChild(this.outerFrame,e,"é¡µé¢èƒŒæ™¯å›¾ç‰‡æ·»åŠ "),console.log("âœ… èƒŒæ™¯å›¾ç‰‡æ·»åŠ å®Œæˆ"))}}this.h5Frame&&a.safeAppendChild(this.outerFrame,this.h5Frame,"H5è‡ªé€‚åº”æ¨¡å—å®¹å™¨æ·»åŠ "),console.log("ğŸ¨ [èƒŒæ™¯è®¾ç½®è°ƒè¯•] èƒŒæ™¯è®¾ç½®å®Œæˆ")})}addModules(){return e(this,void 0,void 0,function*(){if(!this.h5Frame)return void console.log("æ²¡æœ‰è‡ªé€‚åº”æ¨¡å—å®¹å™¨ï¼Œè·³è¿‡æ¨¡å—æ·»åŠ ");const e=yield this.createAllModules();a.safeBatchAppendChildren(this.h5Frame,e,"H5æ¨¡å—æ‰¹é‡æ·»åŠ ")})}createAllModules(){return e(this,void 0,void 0,function*(){return Promise.all([this.createHeaderModuleIfNeeded(),this.createGameInfoModuleIfNeeded(),...this.createCustomModules(),this.createRulesModuleIfNeeded(),this.createFooterModuleIfNeeded()])})}createHeaderModuleIfNeeded(){return e(this,void 0,void 0,function*(){if(this.config.headerImage||this.config.titleUpload){const e=yield g(this.config.headerImage,this.config.titleUpload);if(e)return e}return null})}createGameInfoModuleIfNeeded(){return e(this,void 0,void 0,function*(){if(this.config.gameName||this.config.gameDesc||this.config.gameIcon){return yield function(i){return e(this,void 0,void 0,function*(){let e=210;"doubleButton"===i.buttonVersion&&(e=250);const o=a.createFrame("æ¸¸æˆä¿¡æ¯",t,e);o.fills=[];const n=new f(o,i);return yield n.build(),o})}(this.config)}return null})}createCustomModules(){var t;return(null===(t=this.config.modules)||void 0===t?void 0:t.map(t=>e(this,void 0,void 0,function*(){const i=yield function(t,i){return e(this,void 0,void 0,function*(){return(new m).createModule(t,i)})}(t,this.h5Frame);return i})))||[]}createRulesModuleIfNeeded(){return e(this,void 0,void 0,function*(){const t=this.config.rulesTitle&&""!==this.config.rulesTitle.trim(),i=null!==this.config.rulesBgImage&&void 0!==this.config.rulesBgImage,o=this.config.rulesContent&&""!==this.config.rulesContent.trim();if(t||i||o){return yield function(t){return e(this,void 0,void 0,function*(){console.log("å¼€å§‹åˆ›å»ºæ´»åŠ¨è§„åˆ™æ¨¡å—ï¼Œå†…å®¹ï¼š",{rulesTitle:t.rulesTitle,rulesBgImage:!!t.rulesBgImage,rulesContent:t.rulesContent});const e=a.createFrame("æ´»åŠ¨è§„åˆ™",1080,1e3);e.fills=[];try{const i={rulesTitle:t.rulesTitle||"",rulesBgImage:t.rulesBgImage,rulesContent:t.rulesContent||""},o=new y(e,i);return yield o.build(),console.log("æ´»åŠ¨è§„åˆ™æ¨¡å—åˆ›å»ºå®Œæˆï¼Œæœ€ç»ˆé«˜åº¦ï¼š",e.height),e}catch(t){console.error("æ´»åŠ¨è§„åˆ™æ¨¡å—åˆ›å»ºå¤±è´¥ï¼š",t);const i=yield a.createText(`æ´»åŠ¨è§„åˆ™æ¨¡å—åˆ›å»ºå¤±è´¥: ${t instanceof Error?t.message:"æœªçŸ¥é”™è¯¯"}`,16);return i.x=20,i.y=20,i.fills=[l.createSolidFill({r:1,g:0,b:0})],a.safeAppendChild(e,i,"æ´»åŠ¨è§„åˆ™æ¨¡å—é”™è¯¯æ–‡æœ¬æ·»åŠ "),e.resize(1080,100),e}})}(this.config)}return null})}createFooterModuleIfNeeded(){return e(this,void 0,void 0,function*(){if(this.config.footerLogo||this.config.footerBg){const i=yield function(i){return e(this,void 0,void 0,function*(){if(!i.footerLogo&&!i.footerBg)return console.log("è·³è¿‡å°¾ç‰ˆæ¨¡å—åˆ›å»ºï¼šæ²¡æœ‰LOGOå›¾ç‰‡å’Œå°¾ç‰ˆèƒŒæ™¯å›¾ç‰‡"),null;const e=a.createFrame("å°¾ç‰ˆ",t,480),o=new p(e,i);return yield o.build(),e})}(this.config);if(i)return i}return null})}finalizeLayout(){return e(this,void 0,void 0,function*(){if(this.h5Frame){this.outerFrame.resize(t,this.h5Frame.height);try{if(this.h5Frame.parent===this.outerFrame){const e=this.outerFrame.children.length;e>1&&this.outerFrame.insertChild(e-1,this.h5Frame)}}catch(e){console.error("é‡æ–°æ’åˆ—H5æ¨¡å—å®¹å™¨å¤±è´¥:",e)}}else{let e=100;if(this.config.pageBgImage){const t=this.outerFrame.findOne(e=>"é¡µé¢èƒŒæ™¯å›¾ç‰‡"===e.name);t&&"height"in t&&(e=Math.max(e,t.height))}this.outerFrame.resize(t,e),console.log(`æ²¡æœ‰æ¨¡å—å†…å®¹ï¼ŒH5åŸå‹è®¾ç½®ä¸ºæœ€å°é«˜åº¦: ${e}px`)}yield function(t){return e(this,arguments,void 0,function*(e,t=10,i=100){const o=e.findAll(e=>"FRAME"===e.type&&"ä¹å®«æ ¼æŠ½å¥–"===e.name);for(const n of o)for(const o of["æˆ‘çš„å¥–å“","æ´»åŠ¨è§„åˆ™"]){const r=x(n,o);r&&(yield F(r,e,o,t,i))}})}(this.h5Frame),a.safeAppendChild(figma.currentPage,this.outerFrame,"H5åŸå‹æ·»åŠ åˆ°å½“å‰é¡µé¢"),figma.viewport.scrollAndZoomIntoView([this.outerFrame])})}}function x(e,t){return e.findOne(e=>"FRAME"===e.type&&e.name===t)}function F(t,i,o,n,r){return e(this,void 0,void 0,function*(){for(let e=0;e<n;e++){const e=i.findOne(e=>"FRAME"===e.type&&"æ¸¸æˆä¿¡æ¯"===e.name);if(e){const i=d(e),o=t.findOne(e=>"TEXT"===e.type);i&&o&&(yield figma.loadFontAsync(i.fontName),o.fontName=i.fontName,Array.isArray(i.fills)&&i.fills.length>0&&(o.fills=[Object.assign({},i.fills[0])]));const n=yield h(e);return void(n&&(n.resize(t.width,t.height),n.x=0,n.y=0,t.appendChild(n),o&&t.appendChild(o)))}yield new Promise(e=>setTimeout(e,r))}console.warn(`[é‡è¯•ä¿®æ­£] ${o} æŒ‰é’®æ ·å¼ä¿®æ­£å¤±è´¥ï¼Œæœªæ‰¾åˆ°æ¸¸æˆä¿¡æ¯Frame`)})}class w{constructor(e,t,i){this.channel=e.toLowerCase(),this.sourcePrototype=t,this.images=i||{}}generate(){return e(this,void 0,void 0,function*(){try{console.log(`å¼€å§‹ç”Ÿæˆ${this.channel}æ¸ é“ç‰ˆæœ¬`);const e=yield this.clonePrototype();yield this.applyChannelAdjustments(e),console.log(`${this.channel}æ¸ é“ç‰ˆæœ¬åˆ›å»ºå®Œæˆ`)}catch(e){throw console.error(`ç”Ÿæˆ${this.channel}æ¸ é“ç‰ˆæœ¬å¤±è´¥:`,e),e}})}clonePrototype(){return e(this,void 0,void 0,function*(){try{const i=this.sourcePrototype.clone();return i.name=`${this.channel.toUpperCase()}-H5`,e=i,t=this.sourcePrototype,e.x=t.x+t.width+100,e.y=t.y,a.safeAppendChild(figma.currentPage,i,`${this.channel}æ¸ é“åŸå‹æ·»åŠ `),console.log(`${this.channel}æ¸ é“åŸå‹å¤åˆ¶å®Œæˆï¼Œä½ç½®: (${i.x}, ${i.y})`),i}catch(e){throw console.error("å¤åˆ¶åŸå‹å¤±è´¥:",e),new Error(`å¤åˆ¶${this.channel}åŸå‹å¤±è´¥: ${e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯"}`)}var e,t})}applyChannelAdjustments(t){return e(this,void 0,void 0,function*(){try{console.log(`åº”ç”¨${this.channel}æ¸ é“çš„ç‰¹å®šè°ƒæ•´`);const e=this.findAdaptiveModule(t);if(!e)throw new Error("æœªæ‰¾åˆ°è‡ªé€‚åº”æ¨¡å—å®¹å™¨");yield this.adjustAdaptiveModuleContent(e),this.resizeChannelPrototype(t,e)}catch(e){throw console.error(`åº”ç”¨${this.channel}æ¸ é“è°ƒæ•´å¤±è´¥:`,e),e}})}findAdaptiveModule(e){const t=e=>{if("FRAME"===e.type&&"è‡ªé€‚åº”æ¨¡å—"===e.name)return e;if("children"in e)for(const i of e.children){const e=t(i);if(e)return e}return null};return t(e)}adjustAdaptiveModuleContent(t){return e(this,void 0,void 0,function*(){for(const e of t.children)if("FRAME"===e.type){const t=e;yield this.adjustModuleStyles(t)}})}resizeChannelPrototype(e,t){try{const i=t.width,o=t.height;e.resize(i,o),console.log(`${this.channel}æ¸ é“H5å®¹å™¨å°ºå¯¸å·²è°ƒæ•´ä¸º: ${i}x${o}`)}catch(e){console.error("è°ƒæ•´æ¸ é“H5å®¹å™¨å°ºå¯¸å¤±è´¥:",e)}}adjustModuleStyles(t){return e(this,void 0,void 0,function*(){try{switch(this.channel){case"oppo":yield this.applyOppoStyles(t);break;case"vivo":yield this.applyVivoStyles(t);break;case"huawei":yield this.applyHuaweiStyles(t);break;case"xiaomi":yield this.applyXiaomiStyles(t);break;default:console.log(`${this.channel}æ¸ é“æš‚æ— ç‰¹å®šæ ·å¼è°ƒæ•´`)}}catch(e){console.error("è°ƒæ•´æ¨¡å—æ ·å¼å¤±è´¥:",e)}})}applyOppoStyles(t){return e(this,void 0,void 0,function*(){try{switch(t.name.trim()){case"å¤´å›¾":yield this.adjustOppoHeaderModule(t);break;case"ä¹å®«æ ¼æŠ½å¥–":console.log("åŒ¹é…åˆ°ä¹å®«æ ¼æŠ½å¥–æ¨¡å—ï¼Œå¼€å§‹è°ƒæ•´"),yield this.adjustOppoNineGridModule(t);break;case"å°¾ç‰ˆ":yield this.adjustOppoFooterModule(t);break;default:console.log(`æ¨¡å— "${t.name}" æ— éœ€OPPOç‰¹å®šæ ·å¼è°ƒæ•´`),console.log("å¯åŒ¹é…çš„æ¨¡å—åç§°: å¤´å›¾, ä¹å®«æ ¼æŠ½å¥–, å°¾ç‰ˆ")}}catch(e){console.error("OPPOæ ·å¼è°ƒæ•´å¤±è´¥:",e)}})}adjustOppoHeaderModule(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹è°ƒæ•´OPPOå¤´å›¾æ¨¡å—"),t.resize(t.width,1300);const e=H(t);if(e){const t=e.height-100;e.resize(e.width,t),e.y=e.y+150}const i=_(t);i&&(i.y=i.y+100),console.log("OPPOå¤´å›¾æ¨¡å—è°ƒæ•´å®Œæˆ")}catch(e){console.error("è°ƒæ•´OPPOå¤´å›¾æ¨¡å—å¤±è´¥:",e)}})}adjustOppoNineGridModule(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹è°ƒæ•´OPPOä¹å®«æ ¼æ¨¡å—");if(!this.images.eggBreaking)return void console.log("æœªä¸Šä¼ ç ¸è›‹æ ·å¼å›¾ç‰‡ï¼Œè·³è¿‡ä¹å®«æ ¼æ¨¡å—è°ƒæ•´");const e=function(e){const t=e.findOne(e=>"FRAME"===e.type&&"æ´»åŠ¨è§„åˆ™"===e.name);return t||null}(t);e&&e.remove();const i=function(e){const t=e.findOne(e=>"FRAME"===e.type&&"æˆ‘çš„å¥–å“"===e.name);return t||null}(t);i&&i.remove(),t.resize(t.width,1263);const o=function(e){const t=e.findOne(e=>"FRAME"===e.type&&"ä¹å®«æ ¼ä¸»ä½“"===e.name);return t||null}(t);if(!o)return void console.warn("æœªæ‰¾åˆ°ä¹å®«æ ¼ä¸»ä½“å®¹å™¨");!function(e){try{[...e.children].forEach(t=>{a.safeRemoveNode(t,`æ¸…é™¤${e.name}å­èŠ‚ç‚¹`)})}catch(e){console.error("æ¸…é™¤å®¹å™¨å†…å®¹å¤±è´¥:",e)}}(o),o.resize(o.width,1053),yield this.insertEggBreakingImage(o,this.channel),yield u(o,t,{name:"ç«‹å³æŠ½å¥–",text:"ç«‹å³æŠ½å¥–",x:284,y:648,width:512,height:133,textFontSize:58}),yield u(o,t,{name:"æˆ‘çš„å¥–å“",text:"æˆ‘çš„å¥–å“",x:102,y:851,width:398,height:112,textFontSize:50}),yield u(o,t,{name:"æ´»åŠ¨è§„åˆ™",text:"æ´»åŠ¨è§„åˆ™",x:580,y:851,width:398,height:112,textFontSize:50}),console.log("OPPOä¹å®«æ ¼æ¨¡å—è°ƒæ•´å®Œæˆ")}catch(e){console.error("è°ƒæ•´OPPOä¹å®«æ ¼æ¨¡å—å¤±è´¥:",e)}})}adjustOppoFooterModule(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹è°ƒæ•´OPPOå°¾ç‰ˆæ¨¡å—");const e=this.images.footerStyle;if(e){try{t.resize(t.width,807),b(t);const i=yield R(e,"å°¾ç‰ˆæ ·å¼");i.resize(1080,289),i.x=(t.width-1080)/2,i.y=122,a.safeAppendChild(t,i,"å°¾ç‰ˆæ ·å¼å›¾ç‰‡æ·»åŠ "),console.log("å°¾ç‰ˆæ ·å¼å›¾ç‰‡å·²æ’å…¥:",e.name)}catch(e){console.error("æ’å…¥å°¾ç‰ˆæ ·å¼å›¾ç‰‡å¤±è´¥:",e)}return void console.log("OPPOå°¾ç‰ˆæ¨¡å—è°ƒæ•´å®Œæˆ")}return}catch(e){console.error("è°ƒæ•´OPPOå°¾ç‰ˆæ¨¡å—å¤±è´¥:",e)}})}insertEggBreakingImage(t,i){return e(this,void 0,void 0,function*(){try{const e=this.images.eggBreaking;if(e){const i=yield R(e,"ç ¸è›‹æ ·å¼");i.resize(864,512),i.x=108,i.y=150,a.safeAppendChild(t,i,"ç ¸è›‹æ ·å¼å›¾ç‰‡æ·»åŠ "),console.log("ç ¸è›‹æ ·å¼å›¾ç‰‡å·²æ’å…¥:",e.name)}else{const e=figma.createRectangle();e.name="ç ¸è›‹æ ·å¼ï¼ˆå ä½ï¼‰",e.resize(864,512),e.x=108,e.y=150,e.fills=[l.createSolidFill({r:.9,g:.8,b:.7})],a.safeAppendChild(t,e,"ç ¸è›‹æ ·å¼å ä½å›¾ç‰‡æ·»åŠ "),console.log("ç ¸è›‹æ ·å¼å ä½å›¾ç‰‡å·²æ’å…¥")}}catch(e){console.error("æ’å…¥ç ¸è›‹æ ·å¼å›¾ç‰‡å¤±è´¥:",e)}})}applyVivoStyles(t){return e(this,void 0,void 0,function*(){try{switch(t.name.trim()){case"å¤´å›¾":yield this.adjustVivoHeaderModule(t);break;case"å°¾ç‰ˆ":yield this.adjustVivoFooterModule(t);break;default:console.log(`æ¨¡å— "${t.name}" æ— éœ€VIVOç‰¹å®šæ ·å¼è°ƒæ•´`),console.log("å¯åŒ¹é…çš„æ¨¡å—åç§°: å¤´å›¾, ä¹å®«æ ¼æŠ½å¥–, å°¾ç‰ˆ")}}catch(e){console.error("VIVOæ ·å¼è°ƒæ•´å¤±è´¥:",e)}})}adjustVivoHeaderModule(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹è°ƒæ•´VIVOå¤´å›¾æ¨¡å—"),t.resize(t.width,1300);const e=H(t);if(e){const t=e.height-100;e.resize(e.width,t),e.y=e.y+150}const i=_(t);i&&(i.y=i.y+100),console.log("VIVOå¤´å›¾æ¨¡å—è°ƒæ•´å®Œæˆ")}catch(e){console.error("è°ƒæ•´VIVOå¤´å›¾æ¨¡å—å¤±è´¥:",e)}})}adjustVivoFooterModule(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹è°ƒæ•´VIVOå°¾ç‰ˆæ¨¡å—");const e=this.images.footerStyle;if(e){try{t.resize(t.width,550),b(t);const i=yield R(e,"å°¾ç‰ˆæ ·å¼");i.resize(1080,332),i.x=(t.width-1080)/2,i.y=0,a.safeAppendChild(t,i,"å°¾ç‰ˆæ ·å¼å›¾ç‰‡æ·»åŠ "),console.log("å°¾ç‰ˆæ ·å¼å›¾ç‰‡å·²æ’å…¥:",e.name)}catch(e){console.error("æ’å…¥å°¾ç‰ˆæ ·å¼å›¾ç‰‡å¤±è´¥:",e)}return void console.log("VIVOå°¾ç‰ˆæ¨¡å—è°ƒæ•´å®Œæˆ")}return}catch(e){console.error("è°ƒæ•´VIVOå°¾ç‰ˆæ¨¡å—å¤±è´¥:",e)}})}applyHuaweiStyles(t){return e(this,void 0,void 0,function*(){console.log(`åä¸ºæ ·å¼è°ƒæ•´: ${t.name}`);try{if("å¤´å›¾"===t.name.trim())yield this.adjustHuaweiHeaderModule(t);else console.log(`æ¨¡å— "${t.name}" æ— éœ€åä¸ºç‰¹å®šæ ·å¼è°ƒæ•´`),console.log("å¯åŒ¹é…çš„æ¨¡å—åç§°: å¤´å›¾, ä¹å®«æ ¼æŠ½å¥–, å°¾ç‰ˆ")}catch(e){console.error("åä¸ºæ ·å¼è°ƒæ•´å¤±è´¥:",e)}})}adjustHuaweiHeaderModule(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹è°ƒæ•´åä¸ºå¤´å›¾æ¨¡å—"),t.resize(t.width,1300);const e=H(t);if(e){const t=e.height-100;e.resize(e.width,t),e.y=e.y+150}const i=_(t);i&&(i.y=i.y+100),console.log("åä¸ºå¤´å›¾æ¨¡å—è°ƒæ•´å®Œæˆ")}catch(e){console.error("è°ƒæ•´åä¸ºå¤´å›¾æ¨¡å—å¤±è´¥:",e)}})}applyXiaomiStyles(t){return e(this,void 0,void 0,function*(){console.log(`å°ç±³æ ·å¼è°ƒæ•´: ${t.name}`);try{switch(t.name.trim()){case"å¤´å›¾":yield this.adjustXiaomiHeaderModule(t);break;case"å°¾ç‰ˆ":yield this.adjustXiaomiFooterModule(t);break;default:console.log(`æ¨¡å— "${t.name}" æ— éœ€å°ç±³ç‰¹å®šæ ·å¼è°ƒæ•´`),console.log("å¯åŒ¹é…çš„æ¨¡å—åç§°: å¤´å›¾, ä¹å®«æ ¼æŠ½å¥–, å°¾ç‰ˆ")}}catch(e){console.error("å°ç±³æ ·å¼è°ƒæ•´å¤±è´¥:",e)}})}adjustXiaomiHeaderModule(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹è°ƒæ•´å°ç±³å¤´å›¾æ¨¡å—"),t.resize(t.width,800);const e=H(t);if(e){const t=e.height-250;e.resize(e.width,t)}const i=function(e){const t=e=>{if("æ ‡é¢˜å›¾ç‰‡"===e.name)return e;if("children"in e)for(const i of e.children){const e=t(i);if(e)return e}return null};return t(e)}(t);i&&i.remove(),console.log("å°ç±³å¤´å›¾æ¨¡å—è°ƒæ•´å®Œæˆ")}catch(e){console.error("è°ƒæ•´å°ç±³å¤´å›¾æ¨¡å—å¤±è´¥:",e)}})}adjustXiaomiFooterModule(t){return e(this,void 0,void 0,function*(){try{return console.log("å¼€å§‹è°ƒæ•´å°ç±³å°¾ç‰ˆæ¨¡å—"),t.resize(t.width,300),b(t),void console.log("å°ç±³å°¾ç‰ˆæ¨¡å—è°ƒæ•´å®Œæˆ")}catch(e){console.error("è°ƒæ•´å°ç±³å°¾ç‰ˆæ¨¡å—å¤±è´¥:",e)}})}}function B(t,i){return e(this,void 0,void 0,function*(){try{console.log(`å¼€å§‹ä¸º${t}æ¸ é“ç”ŸæˆH5åŸå‹`);const o=function(){try{const e=figma.currentPage.selection;if(0===e.length)return console.warn("æœªé€‰ä¸­ä»»ä½•èŠ‚ç‚¹"),null;const t=e[0];return"FRAME"===t.type&&"H5åŸå‹"===t.name?(console.log("æ‰¾åˆ°é€‰ä¸­çš„H5åŸå‹å®¹å™¨"),t):(console.warn(`é€‰ä¸­çš„èŠ‚ç‚¹ä¸æ˜¯H5åŸå‹å®¹å™¨ï¼Œå½“å‰é€‰ä¸­: ${t.name} (ç±»å‹: ${t.type})`),null)}catch(e){return console.error("è·å–é€‰ä¸­çš„åŸå‹å®¹å™¨å¤±è´¥:",e),null}}();if(!o)throw new Error('è¯·å…ˆé€‰ä¸­åä¸º"H5åŸå‹"çš„å®¹å™¨');console.log("åˆ†æH5åŸå‹å®¹å™¨ä¸­çš„æ–‡æœ¬èŠ‚ç‚¹å¹¶åŠ è½½å­—ä½“..."),yield function(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹åˆ†æH5åŸå‹å®¹å™¨ä¸­çš„æ–‡æœ¬èŠ‚ç‚¹...");const i=new Set,o=e=>{if("TEXT"===e.type){const t=e;if("object"==typeof t.fontName&&"family"in t.fontName){const e=`${t.fontName.family}|${t.fontName.style}`;i.add(e),console.log(`å‘ç°æ–‡æœ¬èŠ‚ç‚¹ "${t.name}" ä½¿ç”¨å­—ä½“: ${t.fontName.family} ${t.fontName.style}`)}else if(t.fontName===figma.mixed){const e=t.characters.length;for(let o=0;o<e;o++){const e=t.getRangeFontName(o,o+1),n=`${e.family}|${e.style}`;i.add(n)}console.log(`å‘ç°æ–‡æœ¬èŠ‚ç‚¹ "${t.name}" ä½¿ç”¨æ··åˆå­—ä½“`)}}if("children"in e)for(const t of e.children)o(t)};o(t),console.log(`å…±å‘ç° ${i.size} ç§å­—ä½“éœ€è¦åŠ è½½`);const n=Array.from(i).map(t=>e(this,void 0,void 0,function*(){const[e,i]=t.split("|");try{yield figma.loadFontAsync({family:e,style:i}),console.log(`âœ“ å­—ä½“åŠ è½½æˆåŠŸ: ${e} ${i}`)}catch(t){console.warn(`âœ— å­—ä½“åŠ è½½å¤±è´¥: ${e} ${i}`,t)}}));yield Promise.all(n),console.log("æ‰€æœ‰å­—ä½“åŠ è½½å®Œæˆ")}catch(e){console.error("ä»åŸå‹å®¹å™¨åŠ è½½å­—ä½“æ—¶å‘ç”Ÿé”™è¯¯:",e)}})}(o),console.log("å­—ä½“åŠ è½½å®Œæˆ");const n=new w(t,o,i||{});yield n.generate(),console.log(`${t}æ¸ é“ç‰ˆæœ¬ç”Ÿæˆå®Œæˆ`)}catch(e){throw console.error(`ç”Ÿæˆ${t}æ¸ é“ç‰ˆæœ¬å¤±è´¥:`,e),e}})}function H(e){const t=e=>{if("RECTANGLE"===e.type&&"è’™ç‰ˆ"===e.name)return e;if("children"in e)for(const i of e.children){const e=t(i);if(e)return e}return null};return t(e)}function _(e){const t=e=>{if("å¤´å›¾å›¾ç‰‡"===e.name)return e;if("children"in e)for(const i of e.children){const e=t(i);if(e)return e}return null};return t(e)}function b(e){try{const t=e.findOne(e=>e.name.toLowerCase().includes("logo"));t&&a.safeRemoveNode(t,"æ¸…é™¤å°¾ç‰ˆLOGO")}catch(e){console.error("æ¸…é™¤å°¾ç‰ˆLOGOå¤±è´¥:",e)}}function R(t,i){return e(this,void 0,void 0,function*(){let e;if("string"==typeof t.data){const i=atob(t.data);e=new Uint8Array(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t)}else e=new Uint8Array(t.data);const o=figma.createRectangle();o.name=i,o.resize(t.width,t.height);const n={type:"IMAGE",imageHash:figma.createImage(e).hash,scaleMode:"FILL"};return o.fills=[n],o})}class M{constructor(){this.storage="undefined"!=typeof window?window.localStorage:null}static getInstance(){return M.instance||(M.instance=new M),M.instance}setItem(e,t){this.storage&&this.storage.setItem(e,t)}getItem(e){return this.storage?this.storage.getItem(e):null}removeItem(e){this.storage&&this.storage.removeItem(e)}clear(){this.storage&&this.storage.clear()}keys(){return this.storage?Object.keys(this.storage):[]}}class O{constructor(){this.storage=M.getInstance()}static getInstance(){return O.instance||(O.instance=new O),O.instance}getSystemTheme(){return"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}getCurrentTheme(){const e=this.storage.getItem(O.THEME_KEY);return"true"===this.storage.getItem(O.AUTO_THEME_KEY)?this.getSystemTheme():e||"light"}setTheme(e){this.storage.setItem(O.THEME_KEY,e),this.storage.setItem(O.AUTO_THEME_KEY,"false")}setAutoTheme(e){this.storage.setItem(O.AUTO_THEME_KEY,String(e)),e&&this.setTheme(this.getSystemTheme())}isAutoThemeEnabled(){return"true"===this.storage.getItem(O.AUTO_THEME_KEY)}}O.THEMES=["light","dark"],O.THEME_KEY="theme",O.AUTO_THEME_KEY="autoTheme";var L=Object.freeze({__proto__:null,ThemeService:O});let G=class{static saveConfig(t){return e(this,void 0,void 0,function*(){try{const e=JSON.stringify(t);this.storage.setItem(this.STORAGE_KEY,e)}catch(e){throw console.error("ä¿å­˜é…ç½®å¤±è´¥:",e),new Error("ä¿å­˜é…ç½®å¤±è´¥")}})}static loadConfig(){return e(this,void 0,void 0,function*(){try{const e=this.storage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch(e){return console.error("åŠ è½½é…ç½®å¤±è´¥:",e),null}})}static clearConfig(){return e(this,void 0,void 0,function*(){try{this.storage.removeItem(this.STORAGE_KEY)}catch(e){console.error("æ¸…é™¤é…ç½®å¤±è´¥:",e)}})}static validateConfig(e){var t,i,o,n,r,s;const l=[];switch((null===(t=e.pageTitle)||void 0===t?void 0:t.trim())||l.push("é¡µé¢æ ‡é¢˜ä¸èƒ½ä¸ºç©º"),(null===(i=e.gameName)||void 0===i?void 0:i.trim())||l.push("æ¸¸æˆåç§°ä¸èƒ½ä¸ºç©º"),e.buttonVersion||l.push("è¯·é€‰æ‹©æŒ‰é’®ç‰ˆæœ¬"),e.buttonVersion){case"icon":(null===(o=e.iconButtonText)||void 0===o?void 0:o.trim())||l.push("å¸¦å›¾æ ‡æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º");break;case"single":(null===(n=e.singleButtonText)||void 0===n?void 0:n.trim())||l.push("å•æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º");break;case"double":(null===(r=e.leftButtonText)||void 0===r?void 0:r.trim())||l.push("å·¦ä¾§æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º"),(null===(s=e.rightButtonText)||void 0===s?void 0:s.trim())||l.push("å³ä¾§æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º")}return{isValid:0===l.length,errors:l}}static createDefaultConfig(){return{pageTitle:"æ´»åŠ¨é¡µé¢",pageBgColor:"#ffffff",pageBgImage:null,headerImage:null,titleUpload:null,gameIcon:null,gameName:"æ¸¸æˆåç§°",gameDesc:"æ¸¸æˆæè¿°",gameTextColor:"#333333",buttonVersion:"single",iconButtonText:"ç«‹å³ä¸‹è½½",iconButtonTextColor:"#ffffff",iconButtonBg:null,singleButtonText:"ç«‹å³ä¸‹è½½",singleButtonTextColor:"#ffffff",singleButtonBg:null,leftButtonText:"é¢„çº¦æ¸¸æˆ",leftButtonTextColor:"#ffffff",leftButtonBg:null,rightButtonText:"ç«‹å³ä¸‹è½½",rightButtonTextColor:"#ffffff",rightButtonBg:null,buttonSpacing:20,modules:[],rulesTitle:"æ´»åŠ¨è§„åˆ™",rulesBgImage:null,rulesContent:"è¯·å¡«å†™æ´»åŠ¨è§„åˆ™å†…å®¹",footerLogo:null,footerBg:null,canvasWidth:1080,canvasHeight:1920}}};G.STORAGE_KEY="h5-tools-config",G.storage=M.getInstance();var $=Object.freeze({__proto__:null,ConfigService:G});class N{static saveChannelImage(t,i,o){return e(this,void 0,void 0,function*(){try{const e=yield this.loadAllChannelImages();e[t]||(e[t]={}),e[t][i]=Object.assign(Object.assign({},o),{timestamp:Date.now()});this.calculateStorageSize(e)>this.MAX_STORAGE_SIZE&&(yield this.clearExpiredChannelImages());const n=JSON.stringify(e);this.storage.setItem(this.STORAGE_KEY,n)}catch(e){throw console.error("ä¿å­˜æ¸ é“å›¾ç‰‡å¤±è´¥:",e),new Error("ä¿å­˜æ¸ é“å›¾ç‰‡å¤±è´¥")}})}static loadAllChannelImages(){return e(this,void 0,void 0,function*(){try{const e=this.storage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):{}}catch(e){return console.error("åŠ è½½æ¸ é“å›¾ç‰‡å¤±è´¥:",e),{}}})}static loadChannelImages(t){return e(this,void 0,void 0,function*(){return(yield this.loadAllChannelImages())[t]||{}})}static deleteChannelImage(t,i){return e(this,void 0,void 0,function*(){try{const e=yield this.loadAllChannelImages();if(e[t]&&e[t][i]){delete e[t][i],0===Object.keys(e[t]).length&&delete e[t];const o=JSON.stringify(e);this.storage.setItem(this.STORAGE_KEY,o)}}catch(e){console.error("åˆ é™¤æ¸ é“å›¾ç‰‡å¤±è´¥:",e)}})}static clearAllChannelImages(){return e(this,void 0,void 0,function*(){try{this.storage.removeItem(this.STORAGE_KEY)}catch(e){console.error("æ¸…é™¤æ‰€æœ‰æ¸ é“å›¾ç‰‡å¤±è´¥:",e)}})}static clearExpiredChannelImages(){return e(this,void 0,void 0,function*(){try{const e=yield this.loadAllChannelImages(),t=Date.now(),i=6048e5;let o=!1;for(const n in e){const r=e[n];for(const e in r){t-r[e].timestamp>i&&(delete r[e],o=!0)}0===Object.keys(r).length&&delete e[n]}if(o){const t=JSON.stringify(e);this.storage.setItem(this.STORAGE_KEY,t)}}catch(e){console.error("æ¸…é™¤è¿‡æœŸæ¸ é“å›¾ç‰‡å¤±è´¥:",e)}})}static calculateStorageSize(e){return new Blob([JSON.stringify(e)]).size}static getStorageUsage(){return e(this,void 0,void 0,function*(){try{const e=yield this.loadAllChannelImages(),t=this.calculateStorageSize(e),i=t/this.MAX_STORAGE_SIZE*100;return{used:t,max:this.MAX_STORAGE_SIZE,percentage:i}}catch(e){return console.error("è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µå¤±è´¥:",e),{used:0,max:this.MAX_STORAGE_SIZE,percentage:0}}})}}N.STORAGE_KEY="h5-tools-channel-images",N.MAX_STORAGE_SIZE=52428800,N.storage=M.getInstance();var z=Object.freeze({__proto__:null,ChannelImageService:N});var U=Object.freeze({__proto__:null,ValidationService:class{static validateH5Config(e){var t,i,o,n,r,s;const l=[];if((null===(t=e.pageTitle)||void 0===t?void 0:t.trim())||l.push("é¡µé¢æ ‡é¢˜ä¸èƒ½ä¸ºç©º"),(null===(i=e.gameName)||void 0===i?void 0:i.trim())||l.push("æ¸¸æˆåç§°ä¸èƒ½ä¸ºç©º"),e.buttonVersion)switch(e.buttonVersion){case"icon":(null===(o=e.iconButtonText)||void 0===o?void 0:o.trim())||l.push("å¸¦å›¾æ ‡æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º");break;case"single":(null===(n=e.singleButtonText)||void 0===n?void 0:n.trim())||l.push("å•æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º");break;case"double":(null===(r=e.leftButtonText)||void 0===r?void 0:r.trim())||l.push("å·¦ä¾§æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º"),(null===(s=e.rightButtonText)||void 0===s?void 0:s.trim())||l.push("å³ä¾§æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º");break;default:l.push("æ— æ•ˆçš„æŒ‰é’®ç‰ˆæœ¬")}else l.push("è¯·é€‰æ‹©æŒ‰é’®ç‰ˆæœ¬");return e.canvasWidth&&e.canvasWidth<320&&l.push("ç”»å¸ƒå®½åº¦ä¸èƒ½å°äº320px"),e.canvasHeight&&e.canvasHeight<480&&l.push("ç”»å¸ƒé«˜åº¦ä¸èƒ½å°äº480px"),{isValid:0===l.length,errors:l}}static validateImageData(e){var t,i;const o=[];return e.data||o.push("å›¾ç‰‡æ•°æ®ä¸èƒ½ä¸ºç©º"),(null===(t=e.name)||void 0===t?void 0:t.trim())||o.push("å›¾ç‰‡åç§°ä¸èƒ½ä¸ºç©º"),(null===(i=e.type)||void 0===i?void 0:i.trim())||o.push("å›¾ç‰‡ç±»å‹ä¸èƒ½ä¸ºç©º"),(!e.width||e.width<=0)&&o.push("å›¾ç‰‡å®½åº¦å¿…é¡»å¤§äº0"),(!e.height||e.height<=0)&&o.push("å›¾ç‰‡é«˜åº¦å¿…é¡»å¤§äº0"),(!e.size||e.size<=0)&&o.push("å›¾ç‰‡å¤§å°å¿…é¡»å¤§äº0"),(!e.timestamp||e.timestamp<=0)&&o.push("å›¾ç‰‡æ—¶é—´æˆ³æ— æ•ˆ"),{isValid:0===o.length,errors:o}}static validateChannelName(e){return/^[a-zA-Z0-9_-]{2,50}$/.test(e)}}});class k{static isFigmaEnvironment(){return"undefined"!=typeof figma&&!!figma.clientStorage}static setItem(t,i){return e(this,void 0,void 0,function*(){this.isFigmaEnvironment()?yield figma.clientStorage.setAsync(t,i):localStorage.setItem(t,i)})}static getItem(t){return e(this,void 0,void 0,function*(){return this.isFigmaEnvironment()?(yield figma.clientStorage.getAsync(t))||null:localStorage.getItem(t)})}static removeItem(t){return e(this,void 0,void 0,function*(){this.isFigmaEnvironment()?yield figma.clientStorage.deleteAsync(t):localStorage.removeItem(t)})}static getAllKeys(){return e(this,void 0,void 0,function*(){if(this.isFigmaEnvironment()){const e=(yield figma.clientStorage.getAsync("__storage_keys__"))||"[]";return JSON.parse(e)}return Object.keys(localStorage)})}}class P{static saveConfig(t){return e(this,void 0,void 0,function*(){try{const e=JSON.stringify(t);yield k.setItem(this.STORAGE_KEY,e)}catch(e){throw console.error("ä¿å­˜é…ç½®å¤±è´¥:",e),new Error("ä¿å­˜é…ç½®å¤±è´¥")}})}static loadConfig(){return e(this,void 0,void 0,function*(){try{const e=yield k.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch(e){return console.error("åŠ è½½é…ç½®å¤±è´¥:",e),null}})}static clearConfig(){return e(this,void 0,void 0,function*(){try{yield k.removeItem(this.STORAGE_KEY)}catch(e){console.error("æ¸…é™¤é…ç½®å¤±è´¥:",e)}})}static validateConfig(e){var t,i,o,n,r,s;const l=[];switch((null===(t=e.pageTitle)||void 0===t?void 0:t.trim())||l.push("é¡µé¢æ ‡é¢˜ä¸èƒ½ä¸ºç©º"),(null===(i=e.gameName)||void 0===i?void 0:i.trim())||l.push("æ¸¸æˆåç§°ä¸èƒ½ä¸ºç©º"),e.buttonVersion||l.push("è¯·é€‰æ‹©æŒ‰é’®ç‰ˆæœ¬"),e.buttonVersion){case"icon":(null===(o=e.iconButtonText)||void 0===o?void 0:o.trim())||l.push("å¸¦å›¾æ ‡æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º");break;case"single":(null===(n=e.singleButtonText)||void 0===n?void 0:n.trim())||l.push("å•æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º");break;case"double":(null===(r=e.leftButtonText)||void 0===r?void 0:r.trim())||l.push("å·¦ä¾§æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º"),(null===(s=e.rightButtonText)||void 0===s?void 0:s.trim())||l.push("å³ä¾§æŒ‰é’®æ–‡æœ¬ä¸èƒ½ä¸ºç©º")}return{isValid:0===l.length,errors:l}}static createDefaultConfig(){return{pageTitle:"æ´»åŠ¨é¡µé¢",pageBgColor:"#ffffff",pageBgImage:null,headerImage:null,titleUpload:null,gameIcon:null,gameName:"æ¸¸æˆåç§°",gameDesc:"æ¸¸æˆæè¿°",gameTextColor:"#333333",buttonVersion:"single",iconButtonText:"ç«‹å³ä¸‹è½½",iconButtonTextColor:"#ffffff",iconButtonBg:null,singleButtonText:"ç«‹å³ä¸‹è½½",singleButtonTextColor:"#ffffff",singleButtonBg:null,leftButtonText:"é¢„çº¦æ¸¸æˆ",leftButtonTextColor:"#ffffff",leftButtonBg:null,rightButtonText:"ç«‹å³ä¸‹è½½",rightButtonTextColor:"#ffffff",rightButtonBg:null,buttonSpacing:20,modules:[],rulesTitle:"æ´»åŠ¨è§„åˆ™",rulesBgImage:null,rulesContent:"è¯·å¡«å†™æ´»åŠ¨è§„åˆ™å†…å®¹",footerLogo:null,footerBg:null,canvasWidth:1080,canvasHeight:1920}}}P.STORAGE_KEY="h5-tools-config";class D{static initialize(){return e(this,void 0,void 0,function*(){yield Promise.all([this.config.loadConfig(),this.theme.getInstance(),this.channelImage.clearExpiredChannelImages()])})}static getSystemStatus(){return e(this,void 0,void 0,function*(){const[e,t,i]=yield Promise.all([this.config.loadConfig(),this.theme.getInstance(),this.channelImage.getStorageUsage()]);return{configLoaded:!!e,theme:yield t.getCurrentTheme(),storageUsage:i}})}}D.config={loadConfig:()=>e(void 0,void 0,void 0,function*(){const{ConfigService:e}=yield Promise.resolve().then(function(){return $});return e.loadConfig()})},D.theme={getInstance:()=>e(void 0,void 0,void 0,function*(){const{ThemeService:e}=yield Promise.resolve().then(function(){return L});return e.getInstance()})},D.channelImage={clearExpiredChannelImages:()=>e(void 0,void 0,void 0,function*(){const{ChannelImageService:e}=yield Promise.resolve().then(function(){return z});return e.clearExpiredChannelImages()}),getStorageUsage:()=>e(void 0,void 0,void 0,function*(){const{ChannelImageService:e}=yield Promise.resolve().then(function(){return z});return e.getStorageUsage()})},D.validation={validateH5Config:t=>e(void 0,void 0,void 0,function*(){const{ValidationService:e}=yield Promise.resolve().then(function(){return U});return e.validateH5Config(t)})};const V=new class{handleMessage(t){return e(this,void 0,void 0,function*(){try{let e,i;switch(t.type){case"create-prototype":case"generate":if(!t.config)throw new Error("é…ç½®ä¿¡æ¯ä¸èƒ½ä¸ºç©º");yield this.handleCreatePrototype(t.config);break;case"save-config":if(!t.config)throw new Error("é…ç½®ä¿¡æ¯ä¸èƒ½ä¸ºç©º");yield this.handleSaveConfig(t.config);break;case"load-config":yield this.handleLoadConfig();break;case"channel-image-upload":yield this.handleChannelImageUpload(t);break;case"channel-generate":yield this.handleGenerateChannelVersion(t);break;case"storage-set":if(e=t,!e.key||void 0===e.value)throw new Error("å­˜å‚¨é”®å’Œå€¼ä¸èƒ½ä¸ºç©º");yield this.handleStorageSet(e.key,e.value);break;case"storage-delete":if(i=t,!i.key)throw new Error("å­˜å‚¨é”®ä¸èƒ½ä¸ºç©º");yield this.handleStorageDelete(i.key);break;case"storage-get":const o=t;if(!o.key)throw new Error("å­˜å‚¨é”®ä¸èƒ½ä¸ºç©º");yield this.handleStorageGet(o.key,o._messageId);break;case"ui-loaded":console.log("UIç•Œé¢å·²åŠ è½½");break;case"ui-ready":console.log("UIç•Œé¢å·²å°±ç»ª");break;default:console.warn("æœªçŸ¥æ¶ˆæ¯ç±»å‹:",t.type)}}catch(e){console.error("å¤„ç†æ¶ˆæ¯å¤±è´¥:",e),figma.ui.postMessage({type:"error",message:`æ“ä½œå¤±è´¥: ${e instanceof Error?e.message:String(e)}`})}})}handleCreatePrototype(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹åˆ›å»ºH5åŸå‹..."),yield function(t){return e(this,void 0,void 0,function*(){return new S(t).build()})}(t),figma.ui.postMessage({type:"prototype-created",message:"H5åŸå‹åˆ›å»ºæˆåŠŸï¼"}),console.log("H5åŸå‹åˆ›å»ºå®Œæˆ")}catch(e){throw console.error("åˆ›å»ºH5åŸå‹å¤±è´¥:",e),figma.ui.postMessage({type:"error",message:`åˆ›å»ºH5åŸå‹å¤±è´¥: ${e instanceof Error?e.message:String(e)}`}),e}})}handleSaveConfig(t){return e(this,void 0,void 0,function*(){try{yield P.saveConfig(t),figma.ui.postMessage({type:"config-saved",message:"é…ç½®ä¿å­˜æˆåŠŸ"})}catch(e){throw console.error("ä¿å­˜é…ç½®å¤±è´¥:",e),figma.ui.postMessage({type:"error",message:`ä¿å­˜é…ç½®å¤±è´¥: ${e instanceof Error?e.message:String(e)}`}),e}})}handleLoadConfig(){return e(this,void 0,void 0,function*(){try{const e=yield P.loadConfig();figma.ui.postMessage({type:"config-loaded",config:e})}catch(e){throw console.error("åŠ è½½é…ç½®å¤±è´¥:",e),figma.ui.postMessage({type:"error",message:`åŠ è½½é…ç½®å¤±è´¥: ${e instanceof Error?e.message:String(e)}`}),e}})}handleChannelImageUpload(t){return e(this,void 0,void 0,function*(){try{console.log("æ¸ é“å›¾ç‰‡ä¸Šä¼ :",{channel:t.channel,imageType:t.imageType,imageData:t.imageData}),figma.ui.postMessage({type:"channel-image-uploaded",message:"æ¸ é“å›¾ç‰‡ä¸Šä¼ æˆåŠŸ"})}catch(e){throw console.error("æ¸ é“å›¾ç‰‡ä¸Šä¼ å¤±è´¥:",e),figma.ui.postMessage({type:"error",message:`æ¸ é“å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${e instanceof Error?e.message:String(e)}`}),e}})}handleGenerateChannelVersion(t){return e(this,void 0,void 0,function*(){try{console.log("å¼€å§‹ç”Ÿæˆæ¸ é“ç‰ˆæœ¬:",t.channel,t.images),yield B(t.channel,t.images),figma.ui.postMessage({type:"channel-version-generated",message:`${t.channel.toUpperCase()}æ¸ é“ç‰ˆæœ¬ç”ŸæˆæˆåŠŸ`}),console.log(`${t.channel}æ¸ é“ç‰ˆæœ¬ç”Ÿæˆå®Œæˆ`)}catch(e){throw console.error("ç”Ÿæˆæ¸ é“ç‰ˆæœ¬å¤±è´¥:",e),figma.ui.postMessage({type:"error",message:`ç”Ÿæˆ${t.channel.toUpperCase()}æ¸ é“ç‰ˆæœ¬å¤±è´¥: ${e instanceof Error?e.message:String(e)}`}),e}})}handleStorageSet(t,i){return e(this,void 0,void 0,function*(){try{yield figma.clientStorage.setAsync(t,i),console.log(`âœ… Figmaå­˜å‚¨è®¾ç½®æˆåŠŸ: ${t}`)}catch(e){console.error(`Figmaå­˜å‚¨è®¾ç½®å¤±è´¥ ${t}:`,e)}})}handleStorageDelete(t){return e(this,void 0,void 0,function*(){try{yield figma.clientStorage.deleteAsync(t),console.log(`âœ… Figmaå­˜å‚¨åˆ é™¤æˆåŠŸ: ${t}`)}catch(e){console.error(`Figmaå­˜å‚¨åˆ é™¤å¤±è´¥ ${t}:`,e)}})}handleStorageGet(t,i){return e(this,void 0,void 0,function*(){try{const e=yield figma.clientStorage.getAsync(t);console.log(`âœ… Figmaå­˜å‚¨è·å–æˆåŠŸ: ${t}`,e),figma.ui.postMessage({type:"storage-get-response",key:t,value:e,_messageId:i})}catch(e){console.error(`Figmaå­˜å‚¨è·å–å¤±è´¥ ${t}:`,e),figma.ui.postMessage({type:"error",message:`è·å–å­˜å‚¨å¤±è´¥: ${e instanceof Error?e.message:String(e)}`,key:t,_messageId:i})}})}};figma.showUI(__html__,{width:360,height:700}),figma.ui.onmessage=t=>e(void 0,void 0,void 0,function*(){yield V.handleMessage(t)}),console.log("H5Toolsæ’ä»¶å·²å¯åŠ¨");
//# sourceMappingURL=code-standalone.js.map

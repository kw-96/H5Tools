import{__awaiter as e}from"../node_modules/tslib/tslib.es6.js";import{createH5Prototype as o}from"../core/builders/h5-prototype-builder.js";import{generateChannelVersion as r}from"../core/builders/channel-generator.js";import{ConfigService as a,ThemeService as s}from"../core/services/index.js";const t=new class{handleMessage(o){return e(this,void 0,void 0,function*(){try{let e,r;switch(o.type){case"create-prototype":case"generate":if(!o.config)throw new Error("配置信息不能为空");yield this.handleCreatePrototype(o.config);break;case"save-config":if(!o.config)throw new Error("配置信息不能为空");yield this.handleSaveConfig(o.config);break;case"load-config":yield this.handleLoadConfig();break;case"get-theme":yield this.handleGetTheme();break;case"save-theme":if(!o.theme)throw new Error("主题信息不能为空");yield this.handleSaveTheme(o.theme);break;case"channel-image-upload":yield this.handleChannelImageUpload(o);break;case"channel-generate":yield this.handleGenerateChannelVersion(o);break;case"storage-set":if(e=o,!e.key||void 0===e.value)throw new Error("存储键和值不能为空");yield this.handleStorageSet(e.key,e.value);break;case"storage-delete":if(r=o,!r.key)throw new Error("存储键不能为空");yield this.handleStorageDelete(r.key);break;case"ui-loaded":console.log("UI界面已加载");break;case"ui-ready":console.log("UI界面已就绪");break;default:console.warn("未知消息类型:",o.type)}}catch(e){console.error("处理消息失败:",e),figma.ui.postMessage({type:"error",message:`操作失败: ${e instanceof Error?e.message:String(e)}`})}})}handleCreatePrototype(r){return e(this,void 0,void 0,function*(){try{console.log("开始创建H5原型..."),yield o(r),figma.ui.postMessage({type:"prototype-created",message:"H5原型创建成功！"}),console.log("H5原型创建完成")}catch(e){throw console.error("创建H5原型失败:",e),figma.ui.postMessage({type:"error",message:`创建H5原型失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleSaveConfig(o){return e(this,void 0,void 0,function*(){try{yield a.saveConfig(o),figma.ui.postMessage({type:"config-saved",message:"配置保存成功"})}catch(e){throw console.error("保存配置失败:",e),figma.ui.postMessage({type:"error",message:`保存配置失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleLoadConfig(){return e(this,void 0,void 0,function*(){try{const e=yield a.loadConfig();figma.ui.postMessage({type:"config-loaded",config:e})}catch(e){throw console.error("加载配置失败:",e),figma.ui.postMessage({type:"error",message:`加载配置失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleGetTheme(){return e(this,void 0,void 0,function*(){try{const e=yield s.getCurrentTheme();figma.ui.postMessage({type:"theme-loaded",theme:e})}catch(e){throw console.error("获取主题失败:",e),figma.ui.postMessage({type:"error",message:`获取主题失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleSaveTheme(o){return e(this,void 0,void 0,function*(){try{yield s.saveTheme(o),figma.ui.postMessage({type:"theme-saved",message:"主题保存成功"})}catch(e){throw console.error("保存主题失败:",e),figma.ui.postMessage({type:"error",message:`保存主题失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleChannelImageUpload(o){return e(this,void 0,void 0,function*(){try{console.log("渠道图片上传:",{channel:o.channel,imageType:o.imageType,imageData:o.imageData}),figma.ui.postMessage({type:"channel-image-uploaded",message:"渠道图片上传成功"})}catch(e){throw console.error("渠道图片上传失败:",e),figma.ui.postMessage({type:"error",message:`渠道图片上传失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleGenerateChannelVersion(o){return e(this,void 0,void 0,function*(){try{console.log("开始生成渠道版本:",o.channel),yield r(o.channel),figma.ui.postMessage({type:"channel-version-generated",message:`${o.channel.toUpperCase()}渠道版本生成成功`}),console.log(`${o.channel}渠道版本生成完成`)}catch(e){throw console.error("生成渠道版本失败:",e),figma.ui.postMessage({type:"error",message:`生成${o.channel.toUpperCase()}渠道版本失败: ${e instanceof Error?e.message:String(e)}`}),e}})}handleStorageSet(o,r){return e(this,void 0,void 0,function*(){try{yield figma.clientStorage.setAsync(o,r),console.log(`✅ Figma存储设置成功: ${o}`)}catch(e){console.error(`Figma存储设置失败 ${o}:`,e)}})}handleStorageDelete(o){return e(this,void 0,void 0,function*(){try{yield figma.clientStorage.deleteAsync(o),console.log(`✅ Figma存储删除成功: ${o}`)}catch(e){console.error(`Figma存储删除失败 ${o}:`,e)}})}};figma.showUI(__html__,{width:400,height:700}),figma.ui.onmessage=o=>e(void 0,void 0,void 0,function*(){yield t.handleMessage(o)}),console.log("H5Tools插件已启动");
//# sourceMappingURL=code-standalone.js.map
